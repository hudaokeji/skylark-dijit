/**
 * dijit - A version of dijit.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dijit/
 * @license MIT
 */
define(["require","dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/i18n","dojo/_base/lang","dojo/store/Memory","../../registry","../../_Widget","../../_TemplatedMixin","../../_WidgetsInTemplateMixin","../../form/FilteringSelect","../_Plugin","../range","dojo/i18n!../nls/FontChoice"],function(require,e,t,i,o,n,a,s,r,l,d,c,h,m){var u=t("dijit._editor.plugins._FontDropDown",[r,l,d],{label:"",plainText:!1,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline'><label class='dijitLeft dijitInline' for='${selectId}'>${label}</label><input data-dojo-type='../../form/FilteringSelect' required='false' data-dojo-props='labelType:\"html\", labelAttr:\"label\", searchAttr:\"name\"' class='${comboClass}' tabIndex='-1' id='${selectId}' data-dojo-attach-point='select' value=''/></span>",contextRequire:require,postMixInProperties:function(){this.inherited(arguments),this.strings=o.getLocalization("dijit._editor","FontChoice"),this.label=this.strings[this.command],this.id=s.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.selectId=this.id+"_select",this.inherited(arguments)},postCreate:function(){this.select.set("store",new a({idProperty:"value",data:e.map(this.values,function(e){var t=this.strings[e]||e;return{label:this.getLabel(e,t),name:t,value:e}},this)})),this.select.set("value","",!1),this.disabled=this.select.get("disabled")},_setValueAttr:function(t,i){i=!1!==i,this.select.set("value",e.indexOf(this.values,t)<0?"":t,i),i||(this.select._lastValueReported=null)},_getValueAttr:function(){return this.select.get("value")},focus:function(){this.select.focus()},_setDisabledAttr:function(e){this._set("disabled",e),this.select.set("disabled",e)}}),f=t("dijit._editor.plugins._FontNameDropDown",u,{generic:!1,command:"fontName",comboClass:"dijitFontNameCombo",postMixInProperties:function(){this.values||(this.values=this.generic?["serif","sans-serif","monospace","cursive","fantasy"]:["Arial","Times New Roman","Comic Sans MS","Courier New"]),this.inherited(arguments)},getLabel:function(e,t){return this.plainText?t:"<div style='font-family: "+e+"'>"+t+"</div>"},_setValueAttr:function(e,t){if(t=!1!==t,this.generic){e={Arial:"sans-serif",Helvetica:"sans-serif",Myriad:"sans-serif",Times:"serif","Times New Roman":"serif","Comic Sans MS":"cursive","Apple Chancery":"cursive",Courier:"monospace","Courier New":"monospace",Papyrus:"fantasy","Estrangelo Edessa":"cursive",Gabriola:"fantasy"}[e]||e}this.inherited(arguments,[e,t])}}),p=t("dijit._editor.plugins._FontSizeDropDown",u,{command:"fontSize",comboClass:"dijitFontSizeCombo",values:[1,2,3,4,5,6,7],getLabel:function(e,t){return this.plainText?t:"<font size="+e+"'>"+t+"</font>"},_setValueAttr:function(e,t){(t=!1!==t,e.indexOf&&-1!=e.indexOf("px"))&&(e={10:1,13:2,16:3,18:4,24:5,32:6,48:7}[parseInt(e,10)]||e);this.inherited(arguments,[e,t])}}),g=t("dijit._editor.plugins._FormatBlockDropDown",u,{command:"formatBlock",comboClass:"dijitFormatBlockCombo",values:["noFormat","p","h1","h2","h3","pre"],postCreate:function(){this.inherited(arguments),this.set("value","noFormat",!1)},getLabel:function(e,t){return this.plainText||"noFormat"==e?t:"<"+e+">"+t+"</"+e+">"},_execCommand:function(t,i,o){if("noFormat"===o){var a,s,r=m.getSelection(t.window);if(r&&r.rangeCount>0){var l,d,c=r.getRangeAt(0);if(c){for(a=c.startContainer,s=c.endContainer;a&&a!==t.editNode&&a!==t.document.body&&1!==a.nodeType;)a=a.parentNode;for(;s&&s!==t.editNode&&s!==t.document.body&&1!==s.nodeType;)s=s.parentNode;var h=n.hitch(this,function(i,o){var n;if(i.childNodes&&i.childNodes.length)for(n=0;n<i.childNodes.length;n++){var a=i.childNodes[n];if(1==a.nodeType&&t.selection.inSelection(a)){var s=a.tagName?a.tagName.toLowerCase():"";-1!==e.indexOf(this.values,s)&&o.push(a),h(a,o)}}}),u=n.hitch(this,function(e){if(e&&e.length){for(t.beginEditing();e.length;)this._removeFormat(t,e.pop());t.endEditing()}}),f=[];if(a==s){var p;for(l=a;l&&l!==t.editNode&&l!==t.document.body;){if(1==l.nodeType&&(d=l.tagName?l.tagName.toLowerCase():"",-1!==e.indexOf(this.values,d))){p=l;break}l=l.parentNode}h(a,f),p&&(f=[p].concat(f)),u(f)}else{for(l=a;t.selection.inSelection(l);)1==l.nodeType&&(d=l.tagName?l.tagName.toLowerCase():"",-1!==e.indexOf(this.values,d)&&f.push(l),h(l,f)),l=l.nextSibling;u(f)}t.onDisplayChanged()}}}else t.execCommand(i,o)},_removeFormat:function(e,t){if(e.customUndo){for(;t.firstChild;)i.place(t.firstChild,t,"before");t.parentNode.removeChild(t)}else{e.selection.selectElementChildren(t);var o=e.selection.getSelectedHtml();e.selection.selectElement(t),e.execCommand("inserthtml",o||"")}}}),b=t("dijit._editor.plugins.FontChoice",h,{useDefaultCommand:!1,_initButton:function(){var e={fontName:f,fontSize:p,formatBlock:g}[this.command],t=this.params;this.params.custom&&(t.values=this.params.custom);var i=this.editor;this.button=new e(n.delegate({dir:i.dir,lang:i.lang},t)),this.own(this.button.select.on("change",n.hitch(this,function(e){this.editor.focused&&this.editor.focus(),"fontName"==this.command&&-1!=e.indexOf(" ")&&(e="'"+e+"'"),this.button._execCommand?this.button._execCommand(this.editor,this.command,e):this.editor.execCommand(this.command,e)})))},updateState:function(){var t=this.editor,i=this.command;if(t&&t.isLoaded&&i.length&&this.button){var o,a=this.get("disabled");if(this.button.set("disabled",a),a)return;try{o=t.queryCommandValue(i)||""}catch(e){o=""}var s=n.isString(o)&&(o.match(/'([^']*)'/)||o.match(/"([^"]*)"/));if(s&&(o=s[1]),"formatBlock"===i)if(o&&"p"!=o)e.indexOf(this.button.values,o)<0&&(o="noFormat");else{var r;o=null;var l=m.getSelection(this.editor.window);if(l&&l.rangeCount>0){var d=l.getRangeAt(0);d&&(r=d.endContainer)}for(;r&&r!==t.editNode&&r!==t.document;){var c=r.tagName?r.tagName.toLowerCase():"";if(c&&e.indexOf(this.button.values,c)>-1){o=c;break}r=r.parentNode}o||(o="noFormat")}o!==this.button.get("value")&&this.button.set("value",o,!1)}}});return e.forEach(["fontName","fontSize","formatBlock"],function(e){h.registry[e]=function(t){return new b({command:e,plainText:t.plainText})}}),b._FontDropDown=u,b._FontNameDropDown=f,b._FontSizeDropDown=p,b._FormatBlockDropDown=g,b});
//# sourceMappingURL=../../sourcemaps/_editor/plugins/FontChoice.js.map
