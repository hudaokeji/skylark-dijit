/**
 * dijit - A version of dijit.js framework that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/dijit/
 * @license MIT
 */
define(["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/dnd/common","dojo/dom","dojo/mouse","dojo/on","dojo/touch","../a11yclick","./_dndContainer"],function(e,t,o,s,i,n,r,c,h,d,u){return t("dijit.tree._dndSelector",u,{constructor:function(){this.selection={},this.anchor=null,this.events.push(c(this.tree.domNode,h.press,s.hitch(this,"onMouseDown")),c(this.tree.domNode,h.release,s.hitch(this,"onMouseUp")),c(this.tree.domNode,h.move,s.hitch(this,"onMouseMove")),c(this.tree.domNode,d.press,s.hitch(this,"onClickPress")),c(this.tree.domNode,d.release,s.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var e=[],t=this.selection;for(var o in t)e.push(t[o]);return e},selectNone:function(){return this.setSelection([]),this},destroy:function(){this.inherited(arguments),this.selection=this.anchor=null},addTreeNode:function(e,t){return this.setSelection(this.getSelectedTreeNodes().concat([e])),t&&(this.anchor=e),e},removeTreeNode:function(t){var o=e.filter(this.getSelectedTreeNodes(),function(e){return!n.isDescendant(e.domNode,t.domNode)});return this.setSelection(o),t},isTreeNodeSelected:function(e){return e.id&&!!this.selection[e.id]},setSelection:function(t){var o=this.getSelectedTreeNodes();e.forEach(this._setDifference(o,t),s.hitch(this,function(e){e.setSelected(!1),this.anchor==e&&delete this.anchor,delete this.selection[e.id]})),e.forEach(this._setDifference(t,o),s.hitch(this,function(e){e.setSelected(!0),this.selection[e.id]=e})),this._updateSelectionProperties()},_setDifference:function(t,o){e.forEach(o,function(e){e.__exclude__=!0});var s=e.filter(t,function(e){return!e.__exclude__});return e.forEach(o,function(e){delete e.__exclude__}),s},_updateSelectionProperties:function(){var t=this.getSelectedTreeNodes(),o=[],s=[];e.forEach(t,function(e){var t=e.getTreePath();s.push(e),o.push(t)},this);var i=e.map(s,function(e){return e.item});this.tree._set("paths",o),this.tree._set("path",o[0]||[]),this.tree._set("selectedNodes",s),this.tree._set("selectedNode",s[0]||null),this.tree._set("selectedItems",i),this.tree._set("selectedItem",i[0]||null)},onClickPress:function(e){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(e.target,this.current))){"mousedown"==e.type&&r.isLeft(e)&&e.preventDefault();var t="keydown"==e.type?this.tree.focusedChild:this.current;if(t){var o=i.getCopyKeyState(e),s=t.id;this.singular||e.shiftKey||!this.selection[s]?(this._doDeselect=!1,this.userSelect(t,o,e.shiftKey)):this._doDeselect=!0}}},onClickRelease:function(e){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==e.type?this.tree.focusedChild:this.current,i.getCopyKeyState(e),e.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(e,t){if(e===t)return 0;if("sourceIndex"in document.documentElement)return e.sourceIndex-t.sourceIndex;if("compareDocumentPosition"in document.documentElement)return 2&e.compareDocumentPosition(t)?1:-1;if(document.createRange){var o=doc.createRange();o.setStartBefore(e);var s=doc.createRange();return s.setStartBefore(t),o.compareBoundaryPoints(o.END_TO_END,s)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser")},userSelect:function(e,t,o){if(this.singular)this.anchor==e&&t?this.selectNone():(this.setSelection([e]),this.anchor=e);else if(o&&this.anchor){var s,i,n=this._compareNodes(this.anchor.rowNode,e.rowNode),r=this.anchor;n<0?(s=r,i=e):(s=e,i=r);for(var c=[];s!=i;)c.push(s),s=this.tree._getNext(s);c.push(i),this.setSelection(c)}else this.selection[e.id]&&t?this.removeTreeNode(e):t?this.addTreeNode(e,!0):(this.setSelection([e]),this.anchor=e)},getItem:function(e){return{data:this.selection[e],type:["treeNode"]}},forInSelectedItems:function(e,t){for(var s in t=t||o.global,this.selection)e.call(t,this.getItem(s),s,this)}})});
//# sourceMappingURL=../sourcemaps/tree/_dndSelector.js.map
