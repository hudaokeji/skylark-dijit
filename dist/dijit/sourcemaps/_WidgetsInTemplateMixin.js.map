{"version":3,"sources":["_WidgetsInTemplateMixin.js"],"names":["define","array","aspect","declare","lang","parser","_earlyTemplatedStartup","widgetsInTemplate","contextRequire","_beforeFillContent","this","node","domNode","containerNode","searchContainerNode","stopParser","parse","noStart","template","inherited","dir","textDir","propsThis","scope","then","hitch","widgets","_startupWidgets","i","length","_processTemplateNode","n","p","widget","type","callback","connect","on","Error","declaredClass","baseNode","getAttrFunc","attachFunc","arguments","startup","forEach","w","_started"],"mappings":";;;;;;;AAAAA,QACC,mBACA,cACA,qBACA,kBACA,eACE,SAASC,EAAOC,EAAQC,EAASC,EAAMC,GAKzC,OAAOF,EAAQ,gCAAiC,MAW/CG,wBAAwB,EAKxBC,mBAAmB,EAKnBC,eAAgB,KAEhBC,mBAAoB,WACnB,GAAGC,KAAKH,kBAAkB,CAEzB,IAAII,EAAOD,KAAKE,QA4ChB,GA1CGF,KAAKG,gBAAkBH,KAAKI,sBAE9BJ,KAAKG,cAAcE,YAAa,GAGjCV,EAAOW,MAAML,GACZM,SAAUP,KAAKJ,uBACfY,UAAU,EACVC,WAAYC,IAAKV,KAAKU,IAAKhB,KAAMM,KAAKN,KAAMiB,QAASX,KAAKW,SAC1DC,UAAWZ,KACXF,eAAgBE,KAAKF,eACrBe,MAAO,SACLC,KAAKpB,EAAKqB,MAAMf,KAAM,SAASgB,GACjChB,KAAKiB,gBAAkBD,EAOvB,IAAI,IAAIE,EAAI,EAAGA,EAAIF,EAAQG,OAAQD,IAClClB,KAAKoB,qBAAqBJ,EAAQE,GAAI,SAASG,EAAEC,GAEhD,OAAOD,EAAEC,IACP,SAASC,EAAQC,EAAMC,GAEzB,OAAGD,KAAQD,EAEHA,EAAOG,QAAQH,EAAQC,EAAMC,GAG7BF,EAAOI,GAAGH,EAAMC,GAAU,KAMjCzB,KAAKG,eAAiBH,KAAKG,cAAcE,mBACpCL,KAAKG,cAAcE,eAIxBL,KAAKiB,gBACR,MAAM,IAAIW,MAAM5B,KAAK6B,cAAgB,sLAMxCT,qBAAsB,SAA4BU,EAAUC,EAAaC,GAIxE,SAAGD,EAAYD,EAAU,cAAeC,EAAYD,EAAU,oBAIvD9B,KAAKS,UAAUwB,YAGvBC,QAAS,WACR3C,EAAM4C,QAAQnC,KAAKiB,gBAAiB,SAASmB,GACzCA,IAAMA,EAAEC,UAAYD,EAAEF,SACxBE,EAAEF,YAGJlC,KAAKiB,gBAAkB,KACvBjB,KAAKS,UAAUwB","file":"../_WidgetsInTemplateMixin.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\", // forEach()\r\n\t\"dojo/aspect\", // after()\r\n\t\"dojo/_base/declare\", // declare()\r\n\t\"dojo/_base/lang\",\t// hitch()\r\n\t\"dojo/parser\" // parse()\r\n], function(array, aspect, declare, lang, parser){\r\n\r\n\t// module:\r\n\t//\t\tdijit/_WidgetsInTemplateMixin\r\n\r\n\treturn declare(\"dijit._WidgetsInTemplateMixin\", null, {\r\n\t\t// summary:\r\n\t\t//\t\tMixin to supplement _TemplatedMixin when template contains widgets\r\n\r\n\t\t// _earlyTemplatedStartup: Boolean\r\n\t\t//\t\tA fallback to preserve the 1.0 - 1.3 behavior of children in\r\n\t\t//\t\ttemplates having their startup called before the parent widget\r\n\t\t//\t\tfires postCreate. Defaults to 'false', causing child widgets to\r\n\t\t//\t\thave their .startup() called immediately before a parent widget\r\n\t\t//\t\t.startup(), but always after the parent .postCreate(). Set to\r\n\t\t//\t\t'true' to re-enable to previous, arguably broken, behavior.\r\n\t\t_earlyTemplatedStartup: false,\r\n\r\n\t\t// widgetsInTemplate: [protected] Boolean\r\n\t\t//\t\tShould we parse the template to find widgets that might be\r\n\t\t//\t\tdeclared in markup inside it?  (Remove for 2.0 and assume true)\r\n\t\twidgetsInTemplate: true,\r\n\r\n\t\t// contextRequire: Function\r\n\t\t//\t\tUsed to provide a context require to the dojo/parser in order to be\r\n\t\t//\t\table to use relative MIDs (e.g. `./Widget`) in the widget's template.\r\n\t\tcontextRequire: null,\r\n\r\n\t\t_beforeFillContent: function(){\r\n\t\t\tif(this.widgetsInTemplate){\r\n\t\t\t\t// Before copying over content, instantiate widgets in template\r\n\t\t\t\tvar node = this.domNode;\r\n\r\n\t\t\t\tif(this.containerNode && !this.searchContainerNode){\r\n\t\t\t\t\t// Tell parse call below not to look for widgets inside of this.containerNode\r\n\t\t\t\t\tthis.containerNode.stopParser = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tparser.parse(node, {\r\n\t\t\t\t\tnoStart: !this._earlyTemplatedStartup,\r\n\t\t\t\t\ttemplate: true,\r\n\t\t\t\t\tinherited: {dir: this.dir, lang: this.lang, textDir: this.textDir},\r\n\t\t\t\t\tpropsThis: this,\t// so data-dojo-props of widgets in the template can reference \"this\" to refer to me\r\n\t\t\t\t\tcontextRequire: this.contextRequire,\r\n\t\t\t\t\tscope: \"dojo\"\t// even in multi-version mode templates use dojoType/data-dojo-type\r\n\t\t\t\t}).then(lang.hitch(this, function(widgets){\r\n\t\t\t\t\tthis._startupWidgets = widgets;\r\n\r\n\t\t\t\t\t// _WidgetBase::destroy() will destroy any supporting widgets under this.domNode.\r\n\t\t\t\t\t// If we wanted to, we could call this.own() on anything in this._startupWidgets that was moved outside\r\n\t\t\t\t\t// of this.domNode (like Dialog, which is moved to <body>).\r\n\r\n\t\t\t\t\t// Hook up attach points and events for nodes that were converted to widgets\r\n\t\t\t\t\tfor(var i = 0; i < widgets.length; i++){\r\n\t\t\t\t\t\tthis._processTemplateNode(widgets[i], function(n,p){\r\n\t\t\t\t\t\t\t// callback to get a property of a widget\r\n\t\t\t\t\t\t\treturn n[p];\r\n\t\t\t\t\t\t}, function(widget, type, callback){\r\n\t\t\t\t\t\t\t// callback to do data-dojo-attach-event to a widget\r\n\t\t\t\t\t\t\tif(type in widget){\r\n\t\t\t\t\t\t\t\t// back-compat, remove for 2.0\r\n\t\t\t\t\t\t\t\treturn widget.connect(widget, type, callback);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t// 1.x may never hit this branch, but it's the default for 2.0\r\n\t\t\t\t\t\t\t\treturn widget.on(type, callback, true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Cleanup flag set above, just in case\r\n\t\t\t\t\tif(this.containerNode && this.containerNode.stopParser){\r\n\t\t\t\t\t\tdelete this.containerNode.stopParser;\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\r\n\t\t\t\tif(!this._startupWidgets){\r\n\t\t\t\t\tthrow new Error(this.declaredClass + \": parser returned unfilled promise (probably waiting for module auto-load), \" +\r\n\t\t\t\t\t\t\"unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_processTemplateNode: function(/*DOMNode|Widget*/ baseNode, getAttrFunc, attachFunc){\r\n\t\t\t// Override _AttachMixin._processNode to skip DOMNodes with data-dojo-type set.   They are handled separately\r\n\t\t\t// in the _beforeFillContent() code above.\r\n\r\n\t\t\tif(getAttrFunc(baseNode, \"dojoType\") || getAttrFunc(baseNode, \"data-dojo-type\")){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn this.inherited(arguments);\r\n\t\t},\r\n\r\n\t\tstartup: function(){\r\n\t\t\tarray.forEach(this._startupWidgets, function(w){\r\n\t\t\t\tif(w && !w._started && w.startup){\r\n\t\t\t\t\tw.startup();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis._startupWidgets = null;\r\n\t\t\tthis.inherited(arguments);\r\n\t\t}\r\n\t});\r\n});\r\n"]}