{"version":3,"sources":["popup.js"],"names":["define","array","aspect","declare","dom","domAttr","domConstruct","domGeometry","domStyle","has","keys","lang","on","place","BackgroundIframe","Viewport","dijit","destroyWrapper","this","_popupWrapper","destroy","PopupManager","_stack","_beginZIndex","_idGen","_repositionAll","_firstAroundNode","oldPos","_firstAroundPosition","newPos","position","dx","x","dy","y","i","length","style","wrapper","top","parseFloat","right","left","_aroundMoveListener","setTimeout","hitch","_createWrapper","widget","node","domNode","create","class","display","role","aria-label","label","name","id","ownerDocumentBody","appendChild","s","visibility","after","document","evt","test","target","tagName","preventDefault","moveOffScreen","ltr","isBodyLtr","ownerDocument","set","hide","height","overflow","border","cssText","_originalStyle","getTopPopup","stack","pi","parent","open","args","popup","orient","isLeftToRight","around","isDescendant","close","startup","_started","maxHeight","popupSize","Infinity","viewport","getEffectiveBox","aroundPos","padding","h","Math","floor","max","cs","getComputedStyle","borderStyle","borderLeftWidth","borderLeftStyle","borderLeftColor","overflowY","zIndex","baseClass","split","dijitPopupParent","bgIframe","layoutFunc","best","at","handlers","push","keyCode","ESCAPE","onCancel","stopPropagation","TAB","topPopup","onExecute","onClose","onOpen","some","elem","pop","remove","clearTimeout"],"mappings":"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","file":"../popup.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\", // array.forEach array.some\r\n\t\"dojo/aspect\",\r\n\t\"dojo/_base/declare\", // declare\r\n\t\"dojo/dom\", // dom.isDescendant\r\n\t\"dojo/dom-attr\", // domAttr.set\r\n\t\"dojo/dom-construct\", // domConstruct.create domConstruct.destroy\r\n\t\"dojo/dom-geometry\", // domGeometry.isBodyLtr\r\n\t\"dojo/dom-style\", // domStyle.set\r\n\t\"dojo/has\", // has(\"config-bgIframe\")\r\n\t\"dojo/keys\",\r\n\t\"dojo/_base/lang\", // lang.hitch\r\n\t\"dojo/on\",\r\n\t\"./place\",\r\n\t\"./BackgroundIframe\",\r\n\t\"./Viewport\",\r\n\t\"./_dijit\"    // dijit (defining dijit.popup to match API doc)\r\n], function(array, aspect, declare, dom, domAttr, domConstruct, domGeometry, domStyle, has, keys, lang, on,\r\n\t\t\tplace, BackgroundIframe, Viewport, dijit){\r\n\r\n\t// module:\r\n\t//\t\tdijit/popup\r\n\r\n\t/*=====\r\n\t var __OpenArgs = {\r\n\t\t // popup: Widget\r\n\t\t //\t\twidget to display\r\n\t\t // parent: Widget\r\n\t\t //\t\tthe button etc. that is displaying this popup\r\n\t\t // around: DomNode\r\n\t\t //\t\tDOM node (typically a button); place popup relative to this node.  (Specify this *or* \"x\" and \"y\" parameters.)\r\n\t\t // x: Integer\r\n\t\t //\t\tAbsolute horizontal position (in pixels) to place node at.  (Specify this *or* \"around\" parameter.)\r\n\t\t // y: Integer\r\n\t\t //\t\tAbsolute vertical position (in pixels) to place node at.  (Specify this *or* \"around\" parameter.)\r\n\t\t // orient: Object|String\r\n\t\t //\t\tWhen the around parameter is specified, orient should be a list of positions to try, ex:\r\n\t\t //\t|\t[ \"below\", \"above\" ]\r\n\t\t //\t\tFor backwards compatibility it can also be an (ordered) hash of tuples of the form\r\n\t\t //\t\t(around-node-corner, popup-node-corner), ex:\r\n\t\t //\t|\t{ \"BL\": \"TL\", \"TL\": \"BL\" }\r\n\t\t //\t\twhere BL means \"bottom left\" and \"TL\" means \"top left\", etc.\r\n\t\t //\r\n\t\t //\t\tdijit/popup.open() tries to position the popup according to each specified position, in order,\r\n\t\t //\t\tuntil the popup appears fully within the viewport.\r\n\t\t //\r\n\t\t //\t\tThe default value is [\"below\", \"above\"]\r\n\t\t //\r\n\t\t //\t\tWhen an (x,y) position is specified rather than an around node, orient is either\r\n\t\t //\t\t\"R\" or \"L\".  R (for right) means that it tries to put the popup to the right of the mouse,\r\n\t\t //\t\tspecifically positioning the popup's top-right corner at the mouse position, and if that doesn't\r\n\t\t //\t\tfit in the viewport, then it tries, in order, the bottom-right corner, the top left corner,\r\n\t\t //\t\tand the top-right corner.\r\n\t\t // onCancel: Function\r\n\t\t //\t\tcallback when user has canceled the popup by:\r\n\t\t //\r\n\t\t //\t\t1. hitting ESC or\r\n\t\t //\t\t2. by using the popup widget's proprietary cancel mechanism (like a cancel button in a dialog);\r\n\t\t //\t\t   i.e. whenever popupWidget.onCancel() is called, args.onCancel is called\r\n\t\t // onClose: Function\r\n\t\t //\t\tcallback whenever this popup is closed\r\n\t\t // onExecute: Function\r\n\t\t //\t\tcallback when user \"executed\" on the popup/sub-popup by selecting a menu choice, etc. (top menu only)\r\n\t\t // padding: place.__Position\r\n\t\t //\t\tadding a buffer around the opening position. This is only useful when around is not set.\r\n\t\t // maxHeight: Integer\r\n\t\t //\t\tThe max height for the popup.  Any popup taller than this will have scrollbars.\r\n\t\t //\t\tSet to Infinity for no max height.  Default is to limit height to available space in viewport,\r\n\t\t //\t\tabove or below the aroundNode or specified x/y position.\r\n\t };\r\n\t =====*/\r\n\r\n\tfunction destroyWrapper(){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to destroy wrapper when popup widget is destroyed.\r\n\t\t//\t\tLeft in this scope to avoid memory leak on IE8 on refresh page, see #15206.\r\n\t\tif(this._popupWrapper){\r\n\t\t\tdomConstruct.destroy(this._popupWrapper);\r\n\t\t\tdelete this._popupWrapper;\r\n\t\t}\r\n\t}\r\n\r\n\tvar PopupManager = declare(null, {\r\n\t\t// summary:\r\n\t\t//\t\tUsed to show drop downs (ex: the select list of a ComboBox)\r\n\t\t//\t\tor popups (ex: right-click context menus).\r\n\r\n\t\t// _stack: dijit/_WidgetBase[]\r\n\t\t//\t\tStack of currently popped up widgets.\r\n\t\t//\t\t(someone opened _stack[0], and then it opened _stack[1], etc.)\r\n\t\t_stack: [],\r\n\r\n\t\t// _beginZIndex: Number\r\n\t\t//\t\tZ-index of the first popup.   (If first popup opens other\r\n\t\t//\t\tpopups they get a higher z-index.)\r\n\t\t_beginZIndex: 1000,\r\n\r\n\t\t_idGen: 1,\r\n\r\n\t\t_repositionAll: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tIf screen has been scrolled, reposition all the popups in the stack.\r\n\t\t\t//\t\tThen set timer to check again later.\r\n\r\n\t\t\tif(this._firstAroundNode){\t// guard for when clearTimeout() on IE doesn't work\r\n\t\t\t\tvar oldPos = this._firstAroundPosition,\r\n\t\t\t\t\tnewPos = domGeometry.position(this._firstAroundNode, true),\r\n\t\t\t\t\tdx = newPos.x - oldPos.x,\r\n\t\t\t\t\tdy = newPos.y - oldPos.y;\r\n\r\n\t\t\t\tif(dx || dy){\r\n\t\t\t\t\tthis._firstAroundPosition = newPos;\r\n\t\t\t\t\tfor(var i = 0; i < this._stack.length; i++){\r\n\t\t\t\t\t\tvar style = this._stack[i].wrapper.style;\r\n\t\t\t\t\t\tstyle.top = (parseFloat(style.top) + dy) + \"px\";\r\n\t\t\t\t\t\tif(style.right == \"auto\"){\r\n\t\t\t\t\t\t\tstyle.left = (parseFloat(style.left) + dx) + \"px\";\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tstyle.right = (parseFloat(style.right) - dx) + \"px\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._aroundMoveListener = setTimeout(lang.hitch(this, \"_repositionAll\"), dx || dy ? 10 : 50);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_createWrapper: function(/*Widget*/ widget){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInitialization for widgets that will be used as popups.\r\n\t\t\t//\t\tPuts widget inside a wrapper DIV (if not already in one),\r\n\t\t\t//\t\tand returns pointer to that wrapper DIV.\r\n\r\n\t\t\tvar wrapper = widget._popupWrapper,\r\n\t\t\t\tnode = widget.domNode;\r\n\r\n\t\t\tif(!wrapper){\r\n\t\t\t\t// Create wrapper <div> for when this widget [in the future] will be used as a popup.\r\n\t\t\t\t// This is done early because of IE bugs where creating/moving DOM nodes causes focus\r\n\t\t\t\t// to go wonky, see tests/robot/Toolbar.html to reproduce\r\n\t\t\t\twrapper = domConstruct.create(\"div\", {\r\n\t\t\t\t\t\"class\": \"dijitPopup\",\r\n\t\t\t\t\tstyle: { display: \"none\"},\r\n\t\t\t\t\trole: \"region\",\r\n\t\t\t\t\t\"aria-label\": widget[\"aria-label\"] || widget.label || widget.name || widget.id\r\n\t\t\t\t}, widget.ownerDocumentBody);\r\n\t\t\t\twrapper.appendChild(node);\r\n\r\n\t\t\t\tvar s = node.style;\r\n\t\t\t\ts.display = \"\";\r\n\t\t\t\ts.visibility = \"\";\r\n\t\t\t\ts.position = \"\";\r\n\t\t\t\ts.top = \"0px\";\r\n\r\n\t\t\t\twidget._popupWrapper = wrapper;\r\n\t\t\t\taspect.after(widget, \"destroy\", destroyWrapper, true);\r\n\r\n\t\t\t\t// Workaround iOS problem where clicking a Menu can focus an <input> (or click a button) behind it.\r\n\t\t\t\t// Need to be careful though that you can still focus <input>'s and click <button>'s in a TooltipDialog.\r\n\t\t\t\t// Also, be careful not to break (native) scrolling of dropdown like ComboBox's options list.\r\n\t\t\t\tif(\"ontouchend\" in document) {\r\n\t\t\t\t\ton(wrapper, \"touchend\", function (evt){\r\n\t\t\t\t\t\tif(!/^(input|button|textarea)$/i.test(evt.target.tagName)) {\r\n\t\t\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn wrapper;\r\n\t\t},\r\n\r\n\t\tmoveOffScreen: function(/*Widget*/ widget){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tMoves the popup widget off-screen.\r\n\t\t\t//\t\tDo not use this method to hide popups when not in use, because\r\n\t\t\t//\t\tthat will create an accessibility issue: the offscreen popup is\r\n\t\t\t//\t\tstill in the tabbing order.\r\n\r\n\t\t\t// Create wrapper if not already there\r\n\t\t\tvar wrapper = this._createWrapper(widget);\r\n\r\n\t\t\t// Besides setting visibility:hidden, move it out of the viewport, see #5776, #10111, #13604\r\n\t\t\tvar ltr = domGeometry.isBodyLtr(widget.ownerDocument),\r\n\t\t\t\tstyle = {\r\n\t\t\t\t\tvisibility: \"hidden\",\r\n\t\t\t\t\ttop: \"-9999px\",\r\n\t\t\t\t\tdisplay: \"\"\r\n\t\t\t\t};\r\n\t\t\tstyle[ltr ? \"left\" : \"right\"] = \"-9999px\";\r\n\t\t\tstyle[ltr ? \"right\" : \"left\"] = \"auto\";\r\n\t\t\tdomStyle.set(wrapper, style);\r\n\r\n\t\t\treturn wrapper;\r\n\t\t},\r\n\r\n\t\thide: function(/*Widget*/ widget){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHide this popup widget (until it is ready to be shown).\r\n\t\t\t//\t\tInitialization for widgets that will be used as popups\r\n\t\t\t//\r\n\t\t\t//\t\tAlso puts widget inside a wrapper DIV (if not already in one)\r\n\t\t\t//\r\n\t\t\t//\t\tIf popup widget needs to layout it should\r\n\t\t\t//\t\tdo so when it is made visible, and popup._onShow() is called.\r\n\r\n\t\t\t// Create wrapper if not already there\r\n\t\t\tvar wrapper = this._createWrapper(widget);\r\n\r\n\t\t\tdomStyle.set(wrapper, {\r\n\t\t\t\tdisplay: \"none\",\r\n\t\t\t\theight: \"auto\",\t\t// Open may have limited the height to fit in the viewport\r\n\t\t\t\toverflow: \"visible\",\r\n\t\t\t\tborder: \"\"\t\t\t// Open() may have moved border from popup to wrapper.\r\n\t\t\t});\r\n\r\n\t\t\t// Open() may have moved border from popup to wrapper.  Move it back.\r\n\t\t\tvar node = widget.domNode;\r\n\t\t\tif(\"_originalStyle\" in node){\r\n\t\t\t\tnode.style.cssText = node._originalStyle;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetTopPopup: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCompute the closest ancestor popup that's *not* a child of another popup.\r\n\t\t\t//\t\tEx: For a TooltipDialog with a button that spawns a tree of menus, find the popup of the button.\r\n\t\t\tvar stack = this._stack;\r\n\t\t\tfor(var pi = stack.length - 1; pi > 0 && stack[pi].parent === stack[pi - 1].widget; pi--){\r\n\t\t\t\t/* do nothing, just trying to get right value for pi */\r\n\t\t\t}\r\n\t\t\treturn stack[pi];\r\n\t\t},\r\n\r\n\t\topen: function(/*__OpenArgs*/ args){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tPopup the widget at the specified position\r\n\t\t\t//\r\n\t\t\t// example:\r\n\t\t\t//\t\topening at the mouse position\r\n\t\t\t//\t\t|\t\tpopup.open({popup: menuWidget, x: evt.pageX, y: evt.pageY});\r\n\t\t\t//\r\n\t\t\t// example:\r\n\t\t\t//\t\topening the widget as a dropdown\r\n\t\t\t//\t\t|\t\tpopup.open({parent: this, popup: menuWidget, around: this.domNode, onClose: function(){...}});\r\n\t\t\t//\r\n\t\t\t//\t\tNote that whatever widget called dijit/popup.open() should also listen to its own _onBlur callback\r\n\t\t\t//\t\t(fired from _base/focus.js) to know that focus has moved somewhere else and thus the popup should be closed.\r\n\r\n\t\t\tvar stack = this._stack,\r\n\t\t\t\twidget = args.popup,\r\n\t\t\t\tnode = widget.domNode,\r\n\t\t\t\torient = args.orient || [\"below\", \"below-alt\", \"above\", \"above-alt\"],\r\n\t\t\t\tltr = args.parent ? args.parent.isLeftToRight() : domGeometry.isBodyLtr(widget.ownerDocument),\r\n\t\t\t\taround = args.around,\r\n\t\t\t\tid = (args.around && args.around.id) ? (args.around.id + \"_dropdown\") : (\"popup_\" + this._idGen++);\r\n\r\n\t\t\t// If we are opening a new popup that isn't a child of a currently opened popup, then\r\n\t\t\t// close currently opened popup(s).   This should happen automatically when the old popups\r\n\t\t\t// gets the _onBlur() event, except that the _onBlur() event isn't reliable on IE, see [22198].\r\n\t\t\twhile(stack.length && (!args.parent || !dom.isDescendant(args.parent.domNode, stack[stack.length - 1].widget.domNode))){\r\n\t\t\t\tthis.close(stack[stack.length - 1].widget);\r\n\t\t\t}\r\n\r\n\t\t\t// Get pointer to popup wrapper, and create wrapper if it doesn't exist.  Remove display:none (but keep\r\n\t\t\t// off screen) so we can do sizing calculations.\r\n\t\t\tvar wrapper = this.moveOffScreen(widget);\r\n\r\n\t\t\tif(widget.startup && !widget._started){\r\n\t\t\t\twidget.startup(); // this has to be done after being added to the DOM\r\n\t\t\t}\r\n\r\n\t\t\t// Limit height to space available in viewport either above or below aroundNode (whichever side has more\r\n\t\t\t// room), adding scrollbar if necessary. Can't add scrollbar to widget because it may be a <table> (ex:\r\n\t\t\t// dijit/Menu), so add to wrapper, and then move popup's border to wrapper so scroll bar inside border.\r\n\t\t\tvar maxHeight, popupSize = domGeometry.position(node);\r\n\t\t\tif(\"maxHeight\" in args && args.maxHeight != -1){\r\n\t\t\t\tmaxHeight = args.maxHeight || Infinity;\t// map 0 --> infinity for back-compat of _HasDropDown.maxHeight\r\n\t\t\t}else{\r\n\t\t\t\tvar viewport = Viewport.getEffectiveBox(this.ownerDocument),\r\n\t\t\t\t\taroundPos = around ? domGeometry.position(around, false) : {y: args.y - (args.padding||0), h: (args.padding||0) * 2};\r\n\t\t\t\tmaxHeight = Math.floor(Math.max(aroundPos.y, viewport.h - (aroundPos.y + aroundPos.h)));\r\n\t\t\t}\r\n\t\t\tif(popupSize.h > maxHeight){\r\n\t\t\t\t// Get style of popup's border.  Unfortunately domStyle.get(node, \"border\") doesn't work on FF or IE,\r\n\t\t\t\t// and domStyle.get(node, \"borderColor\") etc. doesn't work on FF, so need to use fully qualified names.\r\n\t\t\t\tvar cs = domStyle.getComputedStyle(node),\r\n\t\t\t\t\tborderStyle = cs.borderLeftWidth + \" \" + cs.borderLeftStyle + \" \" + cs.borderLeftColor;\r\n\t\t\t\tdomStyle.set(wrapper, {\r\n\t\t\t\t\toverflowY: \"scroll\",\r\n\t\t\t\t\theight: maxHeight + \"px\",\r\n\t\t\t\t\tborder: borderStyle\t// so scrollbar is inside border\r\n\t\t\t\t});\r\n\t\t\t\tnode._originalStyle = node.style.cssText;\r\n\t\t\t\tnode.style.border = \"none\";\r\n\t\t\t}\r\n\r\n\t\t\tdomAttr.set(wrapper, {\r\n\t\t\t\tid: id,\r\n\t\t\t\tstyle: {\r\n\t\t\t\t\tzIndex: this._beginZIndex + stack.length\r\n\t\t\t\t},\r\n\t\t\t\t\"class\": \"dijitPopup \" + (widget.baseClass || widget[\"class\"] || \"\").split(\" \")[0] + \"Popup\",\r\n\t\t\t\tdijitPopupParent: args.parent ? args.parent.id : \"\"\r\n\t\t\t});\r\n\r\n\t\t\tif(stack.length == 0 && around){\r\n\t\t\t\t// First element on stack. Save position of aroundNode and setup listener for changes to that position.\r\n\t\t\t\tthis._firstAroundNode = around;\r\n\t\t\t\tthis._firstAroundPosition = domGeometry.position(around, true);\r\n\t\t\t\tthis._aroundMoveListener = setTimeout(lang.hitch(this, \"_repositionAll\"), 50);\r\n\t\t\t}\r\n\r\n\t\t\tif(has(\"config-bgIframe\") && !widget.bgIframe){\r\n\t\t\t\t// setting widget.bgIframe triggers cleanup in _WidgetBase.destroyRendering()\r\n\t\t\t\twidget.bgIframe = new BackgroundIframe(wrapper);\r\n\t\t\t}\r\n\r\n\t\t\t// position the wrapper node and make it visible\r\n\t\t\tvar layoutFunc = widget.orient ? lang.hitch(widget, \"orient\") : null,\r\n\t\t\t\tbest = around ?\r\n\t\t\t\t\tplace.around(wrapper, around, orient, ltr, layoutFunc) :\r\n\t\t\t\t\tplace.at(wrapper, args, orient == 'R' ? ['TR', 'BR', 'TL', 'BL'] : ['TL', 'BL', 'TR', 'BR'], args.padding,\r\n\t\t\t\t\t\tlayoutFunc);\r\n\r\n\t\t\twrapper.style.visibility = \"visible\";\r\n\t\t\tnode.style.visibility = \"visible\";\t// counteract effects from _HasDropDown\r\n\r\n\t\t\tvar handlers = [];\r\n\r\n\t\t\t// provide default escape and tab key handling\r\n\t\t\t// (this will work for any widget, not just menu)\r\n\t\t\thandlers.push(on(wrapper, \"keydown\", lang.hitch(this, function(evt){\r\n\t\t\t\tif(evt.keyCode == keys.ESCAPE && args.onCancel){\r\n\t\t\t\t\tevt.stopPropagation();\r\n\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\targs.onCancel();\r\n\t\t\t\t}else if(evt.keyCode == keys.TAB){\r\n\t\t\t\t\tevt.stopPropagation();\r\n\t\t\t\t\tevt.preventDefault();\r\n\t\t\t\t\tvar topPopup = this.getTopPopup();\r\n\t\t\t\t\tif(topPopup && topPopup.onCancel){\r\n\t\t\t\t\t\ttopPopup.onCancel();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})));\r\n\r\n\t\t\t// watch for cancel/execute events on the popup and notify the caller\r\n\t\t\t// (for a menu, \"execute\" means clicking an item)\r\n\t\t\tif(widget.onCancel && args.onCancel){\r\n\t\t\t\thandlers.push(widget.on(\"cancel\", args.onCancel));\r\n\t\t\t}\r\n\r\n\t\t\thandlers.push(widget.on(widget.onExecute ? \"execute\" : \"change\", lang.hitch(this, function(){\r\n\t\t\t\tvar topPopup = this.getTopPopup();\r\n\t\t\t\tif(topPopup && topPopup.onExecute){\r\n\t\t\t\t\ttopPopup.onExecute();\r\n\t\t\t\t}\r\n\t\t\t})));\r\n\r\n\t\t\tstack.push({\r\n\t\t\t\twidget: widget,\r\n\t\t\t\twrapper: wrapper,\r\n\t\t\t\tparent: args.parent,\r\n\t\t\t\tonExecute: args.onExecute,\r\n\t\t\t\tonCancel: args.onCancel,\r\n\t\t\t\tonClose: args.onClose,\r\n\t\t\t\thandlers: handlers\r\n\t\t\t});\r\n\r\n\t\t\tif(widget.onOpen){\r\n\t\t\t\t// TODO: in 2.0 standardize onShow() (used by StackContainer) and onOpen() (used here)\r\n\t\t\t\twidget.onOpen(best);\r\n\t\t\t}\r\n\r\n\t\t\treturn best;\r\n\t\t},\r\n\r\n\t\tclose: function(/*Widget?*/ popup){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tClose specified popup and any popups that it parented.\r\n\t\t\t//\t\tIf no popup is specified, closes all popups.\r\n\r\n\t\t\tvar stack = this._stack;\r\n\r\n\t\t\t// Basically work backwards from the top of the stack closing popups\r\n\t\t\t// until we hit the specified popup, but IIRC there was some issue where closing\r\n\t\t\t// a popup would cause others to close too.  Thus if we are trying to close B in [A,B,C]\r\n\t\t\t// closing C might close B indirectly and then the while() condition will run where stack==[A]...\r\n\t\t\t// so the while condition is constructed defensively.\r\n\t\t\twhile((popup && array.some(stack, function(elem){\r\n\t\t\t\treturn elem.widget == popup;\r\n\t\t\t})) ||\r\n\t\t\t\t(!popup && stack.length)){\r\n\t\t\t\tvar top = stack.pop(),\r\n\t\t\t\t\twidget = top.widget,\r\n\t\t\t\t\tonClose = top.onClose;\r\n\r\n\t\t\t\tif (widget.bgIframe) {\r\n\t\t\t\t\t// push the iframe back onto the stack.\r\n\t\t\t\t\twidget.bgIframe.destroy();\r\n\t\t\t\t\tdelete widget.bgIframe;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(widget.onClose){\r\n\t\t\t\t\t// TODO: in 2.0 standardize onHide() (used by StackContainer) and onClose() (used here).\r\n\t\t\t\t\t// Actually, StackContainer also calls onClose(), but to mean that the pane is being deleted\r\n\t\t\t\t\t// (i.e. that the TabContainer's tab's [x] icon was clicked)\r\n\t\t\t\t\twidget.onClose();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar h;\r\n\t\t\t\twhile(h = top.handlers.pop()){\r\n\t\t\t\t\th.remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Hide the widget and it's wrapper unless it has already been destroyed in above onClose() etc.\r\n\t\t\t\tif(widget && widget.domNode){\r\n\t\t\t\t\tthis.hide(widget);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(onClose){\r\n\t\t\t\t\tonClose();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(stack.length == 0 && this._aroundMoveListener){\r\n\t\t\t\tclearTimeout(this._aroundMoveListener);\r\n\t\t\t\tthis._firstAroundNode = this._firstAroundPosition = this._aroundMoveListener = null;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn (dijit.popup = new PopupManager());\r\n});\r\n"]}