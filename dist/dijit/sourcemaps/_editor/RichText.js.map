{"version":3,"sources":["_editor/RichText.js"],"names":["define","array","config","declare","Deferred","dom","domAttr","domClass","domConstruct","domGeometry","domStyle","kernel","keys","lang","on","query","domReady","has","topic","unload","_Url","winUtils","_Widget","_CssStateMixin","selectionapi","rangeapi","htmlapi","focus","dijit","RichText","constructor","params","this","contentPreFilters","contentPostFilters","contentDomPreFilters","contentDomPostFilters","editingAreaStyleSheets","events","concat","_keyHandlers","isString","value","onLoadDeferred","baseClass","inheritWidth","focusOnLoad","name","styleSheets","height","minHeight","isClosed","isLoaded","_SEPARATOR","_NAME_CONTENT_SEP","isTabIndent","disableSpellCheck","postCreate","domNode","tagName","toLowerCase","console","warn","trim","hitch","_normalizeFontStyle","_removeMozBogus","_removeWebkitBogus","inherited","arguments","publish","_scopeName","startup","open","setupDefaultShortcuts","key","exec","cmd","arg","execCommand","ctrlKeyHandlers","b","i","u","a","s","save","m","1","2","3","4","\\","Z","addKeyHandler","captureEvents","_editorCommandsLocalized","_localizeEditorCommands","_local2NativeFormatNames","_native2LocalFormatNames","format","formats","localhtml","charAt","div","create","style","position","top","zIndex","opacity","innerHTML","ownerDocumentBody","appendChild","inject","node","firstChild","selection","selectElement","nativename","document","queryCommandValue","nextSibling","e","destroy","defer","element","fired","close","length","nodeName","html","dn","ta","textarea","ownerDocument","createElement","setAttribute","id","removeAttribute","cssText","className","place","tmpFunc","set","display","__overflow","overflow","form","resetValue","reset","getValue","replaceValue","disabled","getChildrenHtml","header","editingArea","footer","saveTextarea","byId","dat","datas","split","data","splice","join","_globalSaveHandler","addOnUnload","f","isFunction","ifr","editorObject","iframe","border","width","_layoutMode","frameBorder","_loadFunc","w","window","SelectionManager","onLoad","get","src","_getIframeDocTxt","replace","domain","lastChild","marginTop","add","_cs","getComputedStyle","font","fontWeight","fontSize","fontFamily","lineHeight","indexOf","parseFloat","userStyle","self","match","sC","c","toUpperCase","label","title","isLeftToRight","_applyEditingAreaStyleSheets","files","url","text","ownerWindow","abstring","location","toString","push","addStyleSheet","uri","host","then","createStyleSheet","head","getElementsByTagName","stylesheet","rel","type","href","removeStyleSheet","index","orphan","_mozSettingProps","styleWithCSS","_setDisabledAttr","_set","preventIEfocus","editNode","unselectable","contentEditable","tabIndex","n","ps","hasOwnProperty","e2","_disabledOK","__registeredWindow","_iframeRegHandle","registerIframe","body","_this","beforeIframeNode","afterIframeNode","onfocus","focusNode","ap","own","apply","map","item","zoom","_webkitListener","t","target","setContent","setValue","isFulfilled","resolve","onDisplayChanged","updateInterval","setValueDeferred","onKeyDown","keyCode","SHIFT","ALT","META","CTRL","TAB","stopPropagation","preventDefault","queryCommandEnabled","shiftKey","ctrlKey","altKey","BACKSPACE","PAGE_UP","PAGE_DOWN","clientHeight","scrollHeight","handlers","args","some","h","shift","ctrl","metaKey","handler","onKeyUp","setDisabled","deprecated","_setValueAttr","_setDisableSpellCheckAttr","charCodeAt","isArray","onKeyPressed","onClick","_onIEMouseDown","focused","_onBlur","curNode","newValue","onChange","_onFocus","blur","documentElement","fireEvent","createEventObject","_updateTimer","remove","onNormalizedDisplayChanged","_normalizeCommand","argument","command","undefined","_qcaCache","queryCommandAvailable","ca","_queryCommandAvailable","ie","mozilla","webkit","opera","isSupportedBy","browsers","Boolean","supportedBy","returnValue","Error","implFunc","_browserQueryCommandEnabled","queryCommandState","r","oldValue","_sCall","placeCursorAtStart","isvalid","first","nodeType","nodeValue","tg","test","selectElementChildren","collapse","placeCursorAtEnd","last","previousSibling","nonDestructive","_postFilterContent","_getValueAttr","_preFilterContent","_preDomFilterContent","getSelection","ec","forEach","ef","clone","_saveContent","escapeXml","str","noSingleQuotes","getNodeHtml","getNodeChildrenHtml","interval","clearInterval","left","_frameElement","_preFixUrlAttributes","elem","createRange","_createlinkEnabledImpl","enabled","isCollapsed","_unlinkEnabledImpl","hasAncestorElement","_inserttableEnabledImpl","_cutEnabledImpl","sel","_copyEnabledImpl","_pasteEnabledImpl","_inserthorizontalruleImpl","_inserthtmlImpl","_unlinkImpl","getAncestorElement","_hilitecolorImpl","_handleTextColorOrProperties","log","_backcolorImpl","isApplied","_forecolorImpl","rv","insertRange","outerHTML","pasteHTML","select","rangeCount","getRangeAt","deleteContents","lastNode","createDocumentFragment","insertNode","cloneRange","setStartAfter","removeAllRanges","addRange","_boldImpl","applied","_adaptIESelection","_adaptIEFormatAreaAndExec","_italicImpl","_underlineImpl","_strikethroughImpl","_superscriptImpl","_subscriptImpl","_fontnameImpl","_fontsizeImpl","_insertorderedlistImpl","_adaptIEList","_insertunorderedlistImpl","getHeaderHeight","_getNodeChildrenHeight","getFooterHeight","childNodes","_isNodeEmpty","startOffset","substring","_removeStartingRangeFromRange","range","setStart","parent","parentNode","firstNode","startContainer","rs","ret","txt","startNode","endNode","breaker","sNode","doc","topNode","nNames","_tagNamesForCommand","fs","offset","endOffset","_adjustNodeAndOffset","tName","newblock","nodeToMove","tNode","createTextNode","endText","tagData","parentC","tagList","newTg","color","face","size","pop","newContTag","newTgNode","newrange","setEnd","sc","lType","list","li","extraSpan","removeChild","_stripBreakerNodes","_stripTrailingEmptyNodes","isEmpty","children","textContent","innerText","_setTextDirAttr","dir"],"mappings":"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","file":"../../_editor/RichText.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\", // array.forEach array.indexOf array.some\r\n\t\"dojo/_base/config\", // config\r\n\t\"dojo/_base/declare\", // declare\r\n\t\"dojo/_base/Deferred\", // Deferred\r\n\t\"dojo/dom\", // dom.byId\r\n\t\"dojo/dom-attr\", // domAttr.set or get\r\n\t\"dojo/dom-class\", // domClass.add domClass.remove\r\n\t\"dojo/dom-construct\", // domConstruct.create domConstruct.destroy domConstruct.place\r\n\t\"dojo/dom-geometry\", // domGeometry.position\r\n\t\"dojo/dom-style\", // domStyle.getComputedStyle domStyle.set\r\n\t\"dojo/_base/kernel\", // kernel.deprecated\r\n\t\"dojo/keys\", // keys.BACKSPACE keys.TAB\r\n\t\"dojo/_base/lang\", // lang.clone lang.hitch lang.isArray lang.isFunction lang.isString lang.trim\r\n\t\"dojo/on\", // on()\r\n\t\"dojo/query\", // query\r\n\t\"dojo/domReady\",\r\n\t\"dojo/sniff\", // has(\"ie\") has(\"mozilla\") has(\"opera\") has(\"safari\") has(\"webkit\")\r\n\t\"dojo/topic\", // topic.publish() (publish)\r\n\t\"dojo/_base/unload\", // unload\r\n\t\"dojo/_base/url\", // url\r\n\t\"dojo/window\", // winUtils.get()\r\n\t\"../_Widget\",\r\n\t\"../_CssStateMixin\",\r\n\t\"../selection\",\r\n\t\"./range\",\r\n\t\"./html\",\r\n\t\"../focus\",\r\n\t\"../main\"    // dijit._scopeName\r\n], function(array, config, declare, Deferred, dom, domAttr, domClass, domConstruct, domGeometry, domStyle,\r\n\t\t\tkernel, keys, lang, on, query, domReady, has, topic, unload, _Url, winUtils,\r\n\t\t\t_Widget, _CssStateMixin, selectionapi, rangeapi, htmlapi, focus, dijit){\r\n\r\n\t// module:\r\n\t//\t\tdijit/_editor/RichText\r\n\r\n\t// If you want to allow for rich text saving with back/forward actions, you must add a text area to your page with\r\n\t// the id==dijit._scopeName + \"._editor.RichText.value\" (typically \"dijit/_editor/RichText.value). For example,\r\n\t// something like this will work:\r\n\t//\r\n\t//\t<textarea id=\"dijit._editor.RichText.value\" style=\"display:none;position:absolute;top:-100px;left:-100px;height:3px;width:3px;overflow:hidden;\"></textarea>\r\n\r\n\tvar RichText = declare(\"dijit._editor.RichText\", [_Widget, _CssStateMixin], {\r\n\t\t// summary:\r\n\t\t//\t\tdijit/_editor/RichText is the core of dijit.Editor, which provides basic\r\n\t\t//\t\tWYSIWYG editing features.\r\n\t\t//\r\n\t\t// description:\r\n\t\t//\t\tdijit/_editor/RichText is the core of dijit.Editor, which provides basic\r\n\t\t//\t\tWYSIWYG editing features. It also encapsulates the differences\r\n\t\t//\t\tof different js engines for various browsers.  Do not use this widget\r\n\t\t//\t\twith an HTML &lt;TEXTAREA&gt; tag, since the browser unescapes XML escape characters,\r\n\t\t//\t\tlike &lt;.  This can have unexpected behavior and lead to security issues\r\n\t\t//\t\tsuch as scripting attacks.\r\n\t\t//\r\n\t\t// tags:\r\n\t\t//\t\tprivate\r\n\r\n\t\tconstructor: function(params /*===== , srcNodeRef =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCreate the widget.\r\n\t\t\t// params: Object|null\r\n\t\t\t//\t\tInitial settings for any of the widget attributes, except readonly attributes.\r\n\t\t\t// srcNodeRef: DOMNode\r\n\t\t\t//\t\tThe widget replaces the specified DOMNode.\r\n\r\n\t\t\t// contentPreFilters: Function(String)[]\r\n\t\t\t//\t\tPre content filter function register array.\r\n\t\t\t//\t\tthese filters will be executed before the actual\r\n\t\t\t//\t\tediting area gets the html content.\r\n\t\t\tthis.contentPreFilters = [];\r\n\r\n\t\t\t// contentPostFilters: Function(String)[]\r\n\t\t\t//\t\tpost content filter function register array.\r\n\t\t\t//\t\tThese will be used on the resulting html\r\n\t\t\t//\t\tfrom contentDomPostFilters. The resulting\r\n\t\t\t//\t\tcontent is the final html (returned by getValue()).\r\n\t\t\tthis.contentPostFilters = [];\r\n\r\n\t\t\t// contentDomPreFilters: Function(DomNode)[]\r\n\t\t\t//\t\tPre content dom filter function register array.\r\n\t\t\t//\t\tThese filters are applied after the result from\r\n\t\t\t//\t\tcontentPreFilters are set to the editing area.\r\n\t\t\tthis.contentDomPreFilters = [];\r\n\r\n\t\t\t// contentDomPostFilters: Function(DomNode)[]\r\n\t\t\t//\t\tPost content dom filter function register array.\r\n\t\t\t//\t\tThese filters are executed on the editing area dom.\r\n\t\t\t//\t\tThe result from these will be passed to contentPostFilters.\r\n\t\t\tthis.contentDomPostFilters = [];\r\n\r\n\t\t\t// editingAreaStyleSheets: dojo._URL[]\r\n\t\t\t//\t\tarray to store all the stylesheets applied to the editing area\r\n\t\t\tthis.editingAreaStyleSheets = [];\r\n\r\n\t\t\t// Make a copy of this.events before we start writing into it, otherwise we\r\n\t\t\t// will modify the prototype which leads to bad things on pages w/multiple editors\r\n\t\t\tthis.events = [].concat(this.events);\r\n\r\n\t\t\tthis._keyHandlers = {};\r\n\r\n\t\t\tif(params && lang.isString(params.value)){\r\n\t\t\t\tthis.value = params.value;\r\n\t\t\t}\r\n\r\n\t\t\tthis.onLoadDeferred = new Deferred();\r\n\t\t},\r\n\r\n\t\tbaseClass: \"dijitEditor\",\r\n\r\n\t\t// inheritWidth: Boolean\r\n\t\t//\t\twhether to inherit the parent's width or simply use 100%\r\n\t\tinheritWidth: false,\r\n\r\n\t\t// focusOnLoad: [deprecated] Boolean\r\n\t\t//\t\tFocus into this widget when the page is loaded\r\n\t\tfocusOnLoad: false,\r\n\r\n\t\t// name: String?\r\n\t\t//\t\tSpecifies the name of a (hidden) `<textarea>` node on the page that's used to save\r\n\t\t//\t\tthe editor content on page leave.   Used to restore editor contents after navigating\r\n\t\t//\t\tto a new page and then hitting the back button.\r\n\t\tname: \"\",\r\n\r\n\t\t// styleSheets: [const] String\r\n\t\t//\t\tsemicolon (\";\") separated list of css files for the editing area\r\n\t\tstyleSheets: \"\",\r\n\r\n\t\t// height: String\r\n\t\t//\t\tSet height to fix the editor at a specific height, with scrolling.\r\n\t\t//\t\tBy default, this is 300px.  If you want to have the editor always\r\n\t\t//\t\tresizes to accommodate the content, use AlwaysShowToolbar plugin\r\n\t\t//\t\tand set height=\"\".  If this editor is used within a layout widget,\r\n\t\t//\t\tset height=\"100%\".\r\n\t\theight: \"300px\",\r\n\r\n\t\t// minHeight: String\r\n\t\t//\t\tThe minimum height that the editor should have.\r\n\t\tminHeight: \"1em\",\r\n\r\n\t\t// isClosed: [private] Boolean\r\n\t\tisClosed: true,\r\n\r\n\t\t// isLoaded: [private] Boolean\r\n\t\tisLoaded: false,\r\n\r\n\t\t// _SEPARATOR: [private] String\r\n\t\t//\t\tUsed to concat contents from multiple editors into a single string,\r\n\t\t//\t\tso they can be saved into a single `<textarea>` node.  See \"name\" attribute.\r\n\t\t_SEPARATOR: \"@@**%%__RICHTEXTBOUNDRY__%%**@@\",\r\n\r\n\t\t// _NAME_CONTENT_SEP: [private] String\r\n\t\t//\t\tUSed to separate name from content.  Just a colon isn't safe.\r\n\t\t_NAME_CONTENT_SEP: \"@@**%%:%%**@@\",\r\n\r\n\t\t// onLoadDeferred: [readonly] dojo/promise/Promise\r\n\t\t//\t\tDeferred which is fired when the editor finishes loading.\r\n\t\t//\t\tCall myEditor.onLoadDeferred.then(callback) it to be informed\r\n\t\t//\t\twhen the rich-text area initialization is finalized.\r\n\t\tonLoadDeferred: null,\r\n\r\n\t\t// isTabIndent: Boolean\r\n\t\t//\t\tMake tab key and shift-tab indent and outdent rather than navigating.\r\n\t\t//\t\tCaution: sing this makes web pages inaccessible to users unable to use a mouse.\r\n\t\tisTabIndent: false,\r\n\r\n\t\t// disableSpellCheck: [const] Boolean\r\n\t\t//\t\tWhen true, disables the browser's native spell checking, if supported.\r\n\t\t//\t\tWorks only in Firefox.\r\n\t\tdisableSpellCheck: false,\r\n\r\n\t\tpostCreate: function(){\r\n\t\t\tif(\"textarea\" === this.domNode.tagName.toLowerCase()){\r\n\t\t\t\tconsole.warn(\"RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.\");\r\n\t\t\t}\r\n\r\n\t\t\t// Push in the builtin filters now, making them the first executed, but not over-riding anything\r\n\t\t\t// users passed in.  See: #6062\r\n\t\t\tthis.contentPreFilters = [\r\n\t\t\t\tlang.trim,\t// avoid IE10 problem hitting ENTER on last line when there's a trailing \\n.\r\n\t\t\t\tlang.hitch(this, \"_preFixUrlAttributes\")\r\n\t\t\t].concat(this.contentPreFilters);\r\n\t\t\tif(has(\"mozilla\")){\r\n\t\t\t\tthis.contentPreFilters = [this._normalizeFontStyle].concat(this.contentPreFilters);\r\n\t\t\t\tthis.contentPostFilters = [this._removeMozBogus].concat(this.contentPostFilters);\r\n\t\t\t}\r\n\t\t\tif(has(\"webkit\")){\r\n\t\t\t\t// Try to clean up WebKit bogus artifacts.  The inserted classes\r\n\t\t\t\t// made by WebKit sometimes messes things up.\r\n\t\t\t\tthis.contentPreFilters = [this._removeWebkitBogus].concat(this.contentPreFilters);\r\n\t\t\t\tthis.contentPostFilters = [this._removeWebkitBogus].concat(this.contentPostFilters);\r\n\t\t\t}\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\t// IE generates <strong> and <em> but we want to normalize to <b> and <i>\r\n\t\t\t\t// Still happens in IE11!\r\n\t\t\t\tthis.contentPostFilters = [this._normalizeFontStyle].concat(this.contentPostFilters);\r\n\t\t\t\tthis.contentDomPostFilters = [lang.hitch(this, \"_stripBreakerNodes\")].concat(this.contentDomPostFilters);\r\n\t\t\t}\r\n\t\t\tthis.contentDomPostFilters = [lang.hitch(this, \"_stripTrailingEmptyNodes\")].concat(this.contentDomPostFilters);\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\ttopic.publish(dijit._scopeName + \"._editor.RichText::init\", this);\r\n\t\t},\r\n\r\n\t\tstartup: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\t// Don't call open() until startup() because we need to be attached to the DOM, and also if we are the\r\n\t\t\t// child of a StackContainer, let StackContainer._setupChild() do DOM manipulations before iframe is\r\n\t\t\t// created, to avoid duplicate onload call.\r\n\t\t\tthis.open();\r\n\t\t\tthis.setupDefaultShortcuts();\r\n\t\t},\r\n\r\n\t\tsetupDefaultShortcuts: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAdd some default key handlers\r\n\t\t\t// description:\r\n\t\t\t//\t\tOverwrite this to setup your own handlers. The default\r\n\t\t\t//\t\timplementation does not use Editor commands, but directly\r\n\t\t\t//\t\texecutes the builtin commands within the underlying browser\r\n\t\t\t//\t\tsupport.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar exec = lang.hitch(this, function(cmd, arg){\r\n\t\t\t\treturn function(){\r\n\t\t\t\t\treturn !this.execCommand(cmd, arg);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\tvar ctrlKeyHandlers = {\r\n\t\t\t\tb: exec(\"bold\"),\r\n\t\t\t\ti: exec(\"italic\"),\r\n\t\t\t\tu: exec(\"underline\"),\r\n\t\t\t\ta: exec(\"selectall\"),\r\n\t\t\t\ts: function(){\r\n\t\t\t\t\tthis.save(true);\r\n\t\t\t\t},\r\n\t\t\t\tm: function(){\r\n\t\t\t\t\tthis.isTabIndent = !this.isTabIndent;\r\n\t\t\t\t},\r\n\r\n\t\t\t\t\"1\": exec(\"formatblock\", \"h1\"),\r\n\t\t\t\t\"2\": exec(\"formatblock\", \"h2\"),\r\n\t\t\t\t\"3\": exec(\"formatblock\", \"h3\"),\r\n\t\t\t\t\"4\": exec(\"formatblock\", \"h4\"),\r\n\r\n\t\t\t\t\"\\\\\": exec(\"insertunorderedlist\")\r\n\t\t\t};\r\n\r\n\t\t\tif(!has(\"ie\")){\r\n\t\t\t\tctrlKeyHandlers.Z = exec(\"redo\"); //FIXME: undo?\r\n\t\t\t}\r\n\r\n\t\t\tvar key;\r\n\t\t\tfor(key in ctrlKeyHandlers){\r\n\t\t\t\tthis.addKeyHandler(key, true, false, ctrlKeyHandlers[key]);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// events: [private] String[]\r\n\t\t//\t\t events which should be connected to the underlying editing area\r\n\t\tevents: [\"onKeyDown\", \"onKeyUp\"], // onClick handled specially\r\n\r\n\t\t// captureEvents: [deprecated] String[]\r\n\t\t//\t\t Events which should be connected to the underlying editing\r\n\t\t//\t\t area, events in this array will be addListener with\r\n\t\t//\t\t capture=true.\r\n\t\t// TODO: looking at the code I don't see any distinction between events and captureEvents,\r\n\t\t// so get rid of this for 2.0 if not sooner\r\n\t\tcaptureEvents: [],\r\n\r\n\t\t_editorCommandsLocalized: false,\r\n\t\t_localizeEditorCommands: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tWhen IE is running in a non-English locale, the API actually changes,\r\n\t\t\t//\t\tso that we have to say (for example) danraku instead of p (for paragraph).\r\n\t\t\t//\t\tHandle that here.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(RichText._editorCommandsLocalized){\r\n\t\t\t\t// Use the already generate cache of mappings.\r\n\t\t\t\tthis._local2NativeFormatNames = RichText._local2NativeFormatNames;\r\n\t\t\t\tthis._native2LocalFormatNames = RichText._native2LocalFormatNames;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tRichText._editorCommandsLocalized = true;\r\n\t\t\tRichText._local2NativeFormatNames = {};\r\n\t\t\tRichText._native2LocalFormatNames = {};\r\n\t\t\tthis._local2NativeFormatNames = RichText._local2NativeFormatNames;\r\n\t\t\tthis._native2LocalFormatNames = RichText._native2LocalFormatNames;\r\n\t\t\t//in IE, names for blockformat is locale dependent, so we cache the values here\r\n\r\n\t\t\t//put p after div, so if IE returns Normal, we show it as paragraph\r\n\t\t\t//We can distinguish p and div if IE returns Normal, however, in order to detect that,\r\n\t\t\t//we have to call this.document.selection.createRange().parentElement() or such, which\r\n\t\t\t//could slow things down. Leave it as it is for now\r\n\t\t\tvar formats = ['div', 'p', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ol', 'ul', 'address'];\r\n\t\t\tvar localhtml = \"\", format, i = 0;\r\n\t\t\twhile((format = formats[i++])){\r\n\t\t\t\t//append a <br> after each element to separate the elements more reliably\r\n\t\t\t\tif(format.charAt(1) !== 'l'){\r\n\t\t\t\t\tlocalhtml += \"<\" + format + \"><span>content</span></\" + format + \"><br/>\";\r\n\t\t\t\t}else{\r\n\t\t\t\t\tlocalhtml += \"<\" + format + \"><li>content</li></\" + format + \"><br/>\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// queryCommandValue returns empty if we hide editNode, so move it out of screen temporary\r\n\t\t\t// Also, IE9 does weird stuff unless we do it inside the editor iframe.\r\n\t\t\tvar style = { position: \"absolute\", top: \"0px\", zIndex: 10, opacity: 0.01 };\r\n\t\t\tvar div = domConstruct.create('div', {style: style, innerHTML: localhtml});\r\n\t\t\tthis.ownerDocumentBody.appendChild(div);\r\n\r\n\t\t\t// IE9 has a timing issue with doing this right after setting\r\n\t\t\t// the inner HTML, so put a delay in.\r\n\t\t\tvar inject = lang.hitch(this, function(){\r\n\t\t\t\tvar node = div.firstChild;\r\n\t\t\t\twhile(node){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tthis.selection.selectElement(node.firstChild);\r\n\t\t\t\t\t\tvar nativename = node.tagName.toLowerCase();\r\n\t\t\t\t\t\tthis._local2NativeFormatNames[nativename] = document.queryCommandValue(\"formatblock\");\r\n\t\t\t\t\t\tthis._native2LocalFormatNames[this._local2NativeFormatNames[nativename]] = nativename;\r\n\t\t\t\t\t\tnode = node.nextSibling.nextSibling;\r\n\t\t\t\t\t\t//console.log(\"Mapped: \", nativename, \" to: \", this._local2NativeFormatNames[nativename]);\r\n\t\t\t\t\t}catch(e){ /*Sqelch the occasional IE9 error */\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdomConstruct.destroy(div);\r\n\t\t\t});\r\n\t\t\tthis.defer(inject);\r\n\t\t},\r\n\r\n\t\topen: function(/*DomNode?*/ element){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTransforms the node referenced in this.domNode into a rich text editing\r\n\t\t\t//\t\tnode.\r\n\t\t\t// description:\r\n\t\t\t//\t\tSets up the editing area asynchronously. This will result in\r\n\t\t\t//\t\tthe creation and replacement with an iframe.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tif(!this.onLoadDeferred || this.onLoadDeferred.fired >= 0){\r\n\t\t\t\tthis.onLoadDeferred = new Deferred();\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.isClosed){\r\n\t\t\t\tthis.close();\r\n\t\t\t}\r\n\t\t\ttopic.publish(dijit._scopeName + \"._editor.RichText::open\", this);\r\n\r\n\t\t\tif(arguments.length === 1 && element.nodeName){ // else unchanged\r\n\t\t\t\tthis.domNode = element;\r\n\t\t\t}\r\n\r\n\t\t\tvar dn = this.domNode;\r\n\r\n\t\t\t// Compute initial value of the editor\r\n\t\t\tvar html;\r\n\t\t\tif(lang.isString(this.value)){\r\n\t\t\t\t// Allow setting the editor content programmatically instead of\r\n\t\t\t\t// relying on the initial content being contained within the target\r\n\t\t\t\t// domNode.\r\n\t\t\t\thtml = this.value;\r\n\t\t\t\tdn.innerHTML = \"\";\r\n\t\t\t}else if(dn.nodeName && dn.nodeName.toLowerCase() == \"textarea\"){\r\n\t\t\t\t// if we were created from a textarea, then we need to create a\r\n\t\t\t\t// new editing harness node.\r\n\t\t\t\tvar ta = (this.textarea = dn);\r\n\t\t\t\tthis.name = ta.name;\r\n\t\t\t\thtml = ta.value;\r\n\t\t\t\tdn = this.domNode = this.ownerDocument.createElement(\"div\");\r\n\t\t\t\tdn.setAttribute('widgetId', this.id);\r\n\t\t\t\tta.removeAttribute('widgetId');\r\n\t\t\t\tdn.cssText = ta.cssText;\r\n\t\t\t\tdn.className += \" \" + ta.className;\r\n\t\t\t\tdomConstruct.place(dn, ta, \"before\");\r\n\t\t\t\tvar tmpFunc = lang.hitch(this, function(){\r\n\t\t\t\t\t//some browsers refuse to submit display=none textarea, so\r\n\t\t\t\t\t//move the textarea off screen instead\r\n\t\t\t\t\tdomStyle.set(ta, {\r\n\t\t\t\t\t\tdisplay: \"block\",\r\n\t\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\t\ttop: \"-1000px\"\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif(has(\"ie\")){ //nasty IE bug: abnormal formatting if overflow is not hidden\r\n\t\t\t\t\t\tvar s = ta.style;\r\n\t\t\t\t\t\tthis.__overflow = s.overflow;\r\n\t\t\t\t\t\ts.overflow = \"hidden\";\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif(has(\"ie\")){\r\n\t\t\t\t\tthis.defer(tmpFunc, 10);\r\n\t\t\t\t}else{\r\n\t\t\t\t\ttmpFunc();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(ta.form){\r\n\t\t\t\t\tvar resetValue = ta.value;\r\n\t\t\t\t\tthis.reset = function(){\r\n\t\t\t\t\t\tvar current = this.getValue();\r\n\t\t\t\t\t\tif(current !== resetValue){\r\n\t\t\t\t\t\t\tthis.replaceValue(resetValue);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\t\t\t\t\ton(ta.form, \"submit\", lang.hitch(this, function(){\r\n\t\t\t\t\t\t// Copy value to the <textarea> so it gets submitted along with form.\r\n\t\t\t\t\t\t// FIXME: should we be calling close() here instead?\r\n\t\t\t\t\t\tdomAttr.set(ta, 'disabled', this.disabled); // don't submit the value if disabled\r\n\t\t\t\t\t\tta.value = this.getValue();\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\thtml = htmlapi.getChildrenHtml(dn);\r\n\t\t\t\tdn.innerHTML = \"\";\r\n\t\t\t}\r\n\t\t\tthis.value = html;\r\n\r\n\t\t\t// If we're a list item we have to put in a blank line to force the\r\n\t\t\t// bullet to nicely align at the top of text\r\n\t\t\tif(dn.nodeName && dn.nodeName === \"LI\"){\r\n\t\t\t\tdn.innerHTML = \" <br>\";\r\n\t\t\t}\r\n\r\n\t\t\t// Construct the editor div structure.\r\n\t\t\tthis.header = dn.ownerDocument.createElement(\"div\");\r\n\t\t\tdn.appendChild(this.header);\r\n\t\t\tthis.editingArea = dn.ownerDocument.createElement(\"div\");\r\n\t\t\tdn.appendChild(this.editingArea);\r\n\t\t\tthis.footer = dn.ownerDocument.createElement(\"div\");\r\n\t\t\tdn.appendChild(this.footer);\r\n\r\n\t\t\tif(!this.name){\r\n\t\t\t\tthis.name = this.id + \"_AUTOGEN\";\r\n\t\t\t}\r\n\r\n\t\t\t// User has pressed back/forward button so we lost the text in the editor, but it's saved\r\n\t\t\t// in a hidden <textarea> (which contains the data for all the editors on this page),\r\n\t\t\t// so get editor value from there\r\n\t\t\tif(this.name !== \"\" && (!config[\"useXDomain\"] || config[\"allowXdRichTextSave\"])){\r\n\t\t\t\tvar saveTextarea = dom.byId(dijit._scopeName + \"._editor.RichText.value\");\r\n\t\t\t\tif(saveTextarea && saveTextarea.value !== \"\"){\r\n\t\t\t\t\tvar datas = saveTextarea.value.split(this._SEPARATOR), i = 0, dat;\r\n\t\t\t\t\twhile((dat = datas[i++])){\r\n\t\t\t\t\t\tvar data = dat.split(this._NAME_CONTENT_SEP);\r\n\t\t\t\t\t\tif(data[0] === this.name){\r\n\t\t\t\t\t\t\tthis.value = data[1];\r\n\t\t\t\t\t\t\tdatas = datas.splice(i, 1);\r\n\t\t\t\t\t\t\tsaveTextarea.value = datas.join(this._SEPARATOR);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!RichText._globalSaveHandler){\r\n\t\t\t\t\tRichText._globalSaveHandler = {};\r\n\t\t\t\t\tunload.addOnUnload(function(){\r\n\t\t\t\t\t\tvar id;\r\n\t\t\t\t\t\tfor(id in RichText._globalSaveHandler){\r\n\t\t\t\t\t\t\tvar f = RichText._globalSaveHandler[id];\r\n\t\t\t\t\t\t\tif(lang.isFunction(f)){\r\n\t\t\t\t\t\t\t\tf();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tRichText._globalSaveHandler[this.id] = lang.hitch(this, \"_saveContent\");\r\n\t\t\t}\r\n\r\n\t\t\tthis.isClosed = false;\r\n\r\n\t\t\tvar ifr = (this.editorObject = this.iframe = this.ownerDocument.createElement('iframe'));\r\n\t\t\tifr.id = this.id + \"_iframe\";\r\n\t\t\tifr.style.border = \"none\";\r\n\t\t\tifr.style.width = \"100%\";\r\n\t\t\tif(this._layoutMode){\r\n\t\t\t\t// iframe should be 100% height, thus getting it's height from surrounding\r\n\t\t\t\t// <div> (which has the correct height set by Editor)\r\n\t\t\t\tifr.style.height = \"100%\";\r\n\t\t\t}else{\r\n\t\t\t\tif(has(\"ie\") >= 7){\r\n\t\t\t\t\tif(this.height){\r\n\t\t\t\t\t\tifr.style.height = this.height;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(this.minHeight){\r\n\t\t\t\t\t\tifr.style.minHeight = this.minHeight;\r\n\t\t\t\t\t}\r\n\t\t\t\t}else{\r\n\t\t\t\t\tifr.style.height = this.height ? this.height : this.minHeight;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tifr.frameBorder = 0;\r\n\t\t\tifr._loadFunc = lang.hitch(this, function(w){\r\n\t\t\t\t// This method is called when the editor is first loaded and also if the Editor's\r\n\t\t\t\t// dom node is repositioned. Unfortunately repositioning the Editor tends to\r\n\t\t\t\t// clear the iframe's contents, so we can't just no-op in that case.\r\n\r\n\t\t\t\tthis.window = w;\r\n\t\t\t\tthis.document = w.document;\r\n\r\n\t\t\t\t// instantiate class to access selected text in editor's iframe\r\n\t\t\t\tthis.selection = new selectionapi.SelectionManager(w);\r\n\r\n\t\t\t\tif(has(\"ie\")){\r\n\t\t\t\t\tthis._localizeEditorCommands();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Do final setup and set contents of editor.\r\n\t\t\t\t// Use get(\"value\") rather than html in case _loadFunc() is being called for a second time\r\n\t\t\t\t// because editor's DOMNode was repositioned.\r\n\t\t\t\tthis.onLoad(this.get(\"value\"));\r\n\t\t\t});\r\n\r\n\t\t\t// Attach iframe to document, and set the initial (blank) content.\r\n\t\t\tvar src = this._getIframeDocTxt().replace(/\\\\/g, \"\\\\\\\\\").replace(/'/g, \"\\\\'\"),\r\n\t\t\t\ts;\r\n\r\n\t\t\t// IE10 and earlier will throw an \"Access is denied\" error when attempting to access the parent frame if\r\n\t\t\t// document.domain has been set, unless the child frame also has the same document.domain set. In some\r\n\t\t\t// cases, we can only set document.domain while the document is being constructed using open/write/close;\r\n\t\t\t// attempting to set it later results in a different \"This method can't be used in this context\" error.\r\n\t\t\t// However, in at least IE9-10, sometimes the parent.window check will succeed and the access failure will\r\n\t\t\t// only happen later when trying to access frameElement, so there is an additional check and fix there\r\n\t\t\t// as well. See #17529\r\n\t\t\tif (has(\"ie\") < 11) {\r\n\t\t\t\ts = 'javascript:document.open();try{parent.window;}catch(e){document.domain=\"' + document.domain + '\";}' +\r\n\t\t\t\t\t'document.write(\\'' + src + '\\');document.close()';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ts = \"javascript: '\" + src + \"'\";\r\n\t\t\t}\r\n\r\n\t\t\tif(has(\"ie\") == 9){\r\n\t\t\t\t// On IE9, attach to document before setting the content, to avoid problem w/iframe running in\r\n\t\t\t\t// wrong security context, see #16633.\r\n\t\t\t\tthis.editingArea.appendChild(ifr);\r\n\t\t\t\tifr.src = s;\r\n\t\t\t}else{\r\n\t\t\t\t// For other browsers, set src first, especially for IE6/7 where attaching first gives a warning on\r\n\t\t\t\t// https:// about \"this page contains secure and insecure items, do you want to view both?\"\r\n\t\t\t\tifr.setAttribute('src', s);\r\n\t\t\t\tthis.editingArea.appendChild(ifr);\r\n\t\t\t}\r\n\r\n\t\t\t// TODO: this is a guess at the default line-height, kinda works\r\n\t\t\tif(dn.nodeName === \"LI\"){\r\n\t\t\t\tdn.lastChild.style.marginTop = \"-1.2em\";\r\n\t\t\t}\r\n\r\n\t\t\tdomClass.add(this.domNode, this.baseClass);\r\n\t\t},\r\n\r\n\t\t//static cache variables shared among all instance of this class\r\n\t\t_local2NativeFormatNames: {},\r\n\t\t_native2LocalFormatNames: {},\r\n\r\n\t\t_getIframeDocTxt: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tGenerates the boilerplate text of the document inside the iframe (ie, `<html><head>...</head><body/></html>`).\r\n\t\t\t//\t\tEditor content (if not blank) should be added afterwards.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar _cs = domStyle.getComputedStyle(this.domNode);\r\n\r\n\t\t\t// The contents inside of <body>.  The real contents are set later via a call to setValue().\r\n\t\t\t// In auto-expand mode, need a wrapper div for AlwaysShowToolbar plugin to correctly\r\n\t\t\t// expand/contract the editor as the content changes.\r\n\t\t\tvar html = \"<div id='dijitEditorBody'></div>\";\r\n\r\n\t\t\tvar font = [ _cs.fontWeight, _cs.fontSize, _cs.fontFamily ].join(\" \");\r\n\r\n\t\t\t// line height is tricky - applying a units value will mess things up.\r\n\t\t\t// if we can't get a non-units value, bail out.\r\n\t\t\tvar lineHeight = _cs.lineHeight;\r\n\t\t\tif(lineHeight.indexOf(\"px\") >= 0){\r\n\t\t\t\tlineHeight = parseFloat(lineHeight) / parseFloat(_cs.fontSize);\r\n\t\t\t\t// console.debug(lineHeight);\r\n\t\t\t}else if(lineHeight.indexOf(\"em\") >= 0){\r\n\t\t\t\tlineHeight = parseFloat(lineHeight);\r\n\t\t\t}else{\r\n\t\t\t\t// If we can't get a non-units value, just default\r\n\t\t\t\t// it to the CSS spec default of 'normal'.  Seems to\r\n\t\t\t\t// work better, esp on IE, than '1.0'\r\n\t\t\t\tlineHeight = \"normal\";\r\n\t\t\t}\r\n\t\t\tvar userStyle = \"\";\r\n\t\t\tvar self = this;\r\n\t\t\tthis.style.replace(/(^|;)\\s*(line-|font-?)[^;]+/ig, function(match){\r\n\t\t\t\tmatch = match.replace(/^;/ig, \"\") + ';';\r\n\t\t\t\tvar s = match.split(\":\")[0];\r\n\t\t\t\tif(s){\r\n\t\t\t\t\ts = lang.trim(s);\r\n\t\t\t\t\ts = s.toLowerCase();\r\n\t\t\t\t\tvar i;\r\n\t\t\t\t\tvar sC = \"\";\r\n\t\t\t\t\tfor(i = 0; i < s.length; i++){\r\n\t\t\t\t\t\tvar c = s.charAt(i);\r\n\t\t\t\t\t\tswitch(c){\r\n\t\t\t\t\t\t\tcase \"-\":\r\n\t\t\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\t\t\tc = s.charAt(i).toUpperCase();\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\tsC += c;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdomStyle.set(self.domNode, sC, \"\");\r\n\t\t\t\t}\r\n\t\t\t\tuserStyle += match + ';';\r\n\t\t\t});\r\n\r\n\r\n\t\t\t// need to find any associated label element, aria-label, or aria-labelledby and update iframe document title\r\n\t\t\tvar label = query('label[for=\"' + this.id + '\"]');\r\n\t\t\tvar title = \"\";\r\n\t\t\tif(label.length){\r\n\t\t\t\ttitle = label[0].innerHTML;\r\n\t\t\t}else if(this[\"aria-label\"]){\r\n\t\t\t\ttitle = this[\"aria-label\"];\r\n\t\t\t}else if(this[\"aria-labelledby\"]){\r\n\t\t\t\ttitle = dom.byId(this[\"aria-labelledby\"]).innerHTML;\r\n\t\t\t}\r\n\r\n\t\t\t// Now that we have the title, also set it as the title attribute on the iframe\r\n\t\t\tthis.iframe.setAttribute(\"title\", title);\r\n\r\n\t\t\treturn [\r\n\t\t\t\t\"<!DOCTYPE html>\",\r\n\t\t\t\tthis.isLeftToRight() ? \"<html lang='\" + this.lang + \"'>\\n<head>\\n\" : \"<html dir='rtl' lang='\" + this.lang + \"'>\\n<head>\\n\",\r\n\t\t\t\ttitle ? \"<title>\" + title + \"</title>\" : \"\",\r\n\t\t\t\t\"<meta http-equiv='Content-Type' content='text/html'>\\n\",\r\n\t\t\t\t\"<style>\\n\",\r\n\t\t\t\t\"\\tbody,html {\\n\",\r\n\t\t\t\t\"\\t\\tbackground:transparent;\\n\",\r\n\t\t\t\t\"\\t\\tpadding: 1px 0 0 0;\\n\",\r\n\t\t\t\t\"\\t\\tmargin: -1px 0 0 0;\\n\", // remove extraneous vertical scrollbar on safari and firefox\r\n\t\t\t\t\"\\t}\\n\",\r\n\t\t\t\t\"\\tbody,html,#dijitEditorBody { outline: none; }\",\r\n\r\n\t\t\t\t// Set <body> to expand to full size of editor, so clicking anywhere will work.\r\n\t\t\t\t// Except in auto-expand mode, in which case the editor expands to the size of <body>.\r\n\t\t\t\t// Also determine how scrollers should be applied.  In autoexpand mode (height = \"\") no scrollers on y at all.\r\n\t\t\t\t// But in fixed height mode we want both x/y scrollers.\r\n\t\t\t\t// Scrollers go on <body> since it's been set to height: 100%.\r\n\t\t\t\t\"html { height: 100%; width: 100%; overflow: hidden; }\\n\",\t// scroll bar is on #dijitEditorBody, shouldn't be on <html>\r\n\t\t\t\tthis.height ? \"\\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\\n\" :\r\n\t\t\t\t\t\"\\tbody,#dijitEditorBody { min-height: \" + this.minHeight + \"; width: 100%; overflow-x: auto; overflow-y: hidden; }\\n\",\r\n\r\n\t\t\t\t// TODO: left positioning will cause contents to disappear out of view\r\n\t\t\t\t//\t   if it gets too wide for the visible area\r\n\t\t\t\t\"\\tbody{\\n\",\r\n\t\t\t\t\"\\t\\ttop:0px;\\n\",\r\n\t\t\t\t\"\\t\\tleft:0px;\\n\",\r\n\t\t\t\t\"\\t\\tright:0px;\\n\",\r\n\t\t\t\t\"\\t\\tfont:\", font, \";\\n\",\r\n\t\t\t\t((this.height || has(\"opera\")) ? \"\" : \"\\t\\tposition: fixed;\\n\"),\r\n\t\t\t\t\"\\t\\tline-height:\", lineHeight, \";\\n\",\r\n\t\t\t\t\"\\t}\\n\",\r\n\t\t\t\t\"\\tp{ margin: 1em 0; }\\n\",\r\n\r\n\t\t\t\t\"\\tli > ul:-moz-first-node, li > ol:-moz-first-node{ padding-top: 1.2em; }\\n\",\r\n\t\t\t\t// Can't set min-height in IE>=9, it puts layout on li, which puts move/resize handles.\r\n\t\t\t\t(has(\"ie\") || has(\"trident\") ? \"\" : \"\\tli{ min-height:1.2em; }\\n\"),\r\n\t\t\t\t\"</style>\\n\",\r\n\t\t\t\tthis._applyEditingAreaStyleSheets(), \"\\n\",\r\n\t\t\t\t\"</head>\\n<body role='main' \",\r\n\r\n\t\t\t\t// Onload handler fills in real editor content.\r\n\t\t\t\t// On IE9, sometimes onload is called twice, and the first time frameElement is null (test_FullScreen.html)\r\n\t\t\t\t// On IE9-10, it is also possible that accessing window.parent in the initial creation of the\r\n\t\t\t\t// iframe DOM will succeed, but trying to access window.frameElement will fail, in which case we\r\n\t\t\t\t// *can* set the domain without a \"This method can't be used in this context\" error. See #17529\r\n\t\t\t\t\"onload='try{frameElement && frameElement._loadFunc(window,document)}catch(e){document.domain=\\\"\" + document.domain + \"\\\";frameElement._loadFunc(window,document)}' \",\r\n\t\t\t\t\"style='\" + userStyle + \"'>\", html, \"</body>\\n</html>\"\r\n\t\t\t].join(\"\"); // String\r\n\t\t},\r\n\r\n\t\t_applyEditingAreaStyleSheets: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tapply the specified css files in styleSheets\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar files = [];\r\n\t\t\tif(this.styleSheets){\r\n\t\t\t\tfiles = this.styleSheets.split(';');\r\n\t\t\t\tthis.styleSheets = '';\r\n\t\t\t}\r\n\r\n\t\t\t//empty this.editingAreaStyleSheets here, as it will be filled in addStyleSheet\r\n\t\t\tfiles = files.concat(this.editingAreaStyleSheets);\r\n\t\t\tthis.editingAreaStyleSheets = [];\r\n\r\n\t\t\tvar text = '', i = 0, url, ownerWindow = winUtils.get(this.ownerDocument);\r\n\t\t\twhile((url = files[i++])){\r\n\t\t\t\tvar abstring = (new _Url(ownerWindow.location, url)).toString();\r\n\t\t\t\tthis.editingAreaStyleSheets.push(abstring);\r\n\t\t\t\ttext += '<link rel=\"stylesheet\" type=\"text/css\" href=\"' + abstring + '\"/>';\r\n\t\t\t}\r\n\t\t\treturn text;\r\n\t\t},\r\n\r\n\t\taddStyleSheet: function(/*dojo/_base/url*/ uri){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tadd an external stylesheet for the editing area\r\n\t\t\t// uri:\r\n\t\t\t//\t\tUrl of the external css file\r\n\t\t\tvar url = uri.toString(), ownerWindow = winUtils.get(this.ownerDocument);\r\n\r\n\t\t\t//if uri is relative, then convert it to absolute so that it can be resolved correctly in iframe\r\n\t\t\tif(url.charAt(0) === '.' || (url.charAt(0) !== '/' && !uri.host)){\r\n\t\t\t\turl = (new _Url(ownerWindow.location, url)).toString();\r\n\t\t\t}\r\n\r\n\t\t\tif(array.indexOf(this.editingAreaStyleSheets, url) > -1){\r\n//\t\t\tconsole.debug(\"dijit/_editor/RichText.addStyleSheet(): Style sheet \"+url+\" is already applied\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.editingAreaStyleSheets.push(url);\r\n\t\t\tthis.onLoadDeferred.then(lang.hitch(this, function(){\r\n\t\t\t\tif(this.document.createStyleSheet){ //IE\r\n\t\t\t\t\tthis.document.createStyleSheet(url);\r\n\t\t\t\t}else{ //other browser\r\n\t\t\t\t\tvar head = this.document.getElementsByTagName(\"head\")[0];\r\n\t\t\t\t\tvar stylesheet = this.document.createElement(\"link\");\r\n\t\t\t\t\tstylesheet.rel = \"stylesheet\";\r\n\t\t\t\t\tstylesheet.type = \"text/css\";\r\n\t\t\t\t\tstylesheet.href = url;\r\n\t\t\t\t\thead.appendChild(stylesheet);\r\n\t\t\t\t}\r\n\t\t\t}));\r\n\t\t},\r\n\r\n\t\tremoveStyleSheet: function(/*dojo/_base/url*/ uri){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tremove an external stylesheet for the editing area\r\n\t\t\tvar url = uri.toString(), ownerWindow = winUtils.get(this.ownerDocument);\r\n\t\t\t//if uri is relative, then convert it to absolute so that it can be resolved correctly in iframe\r\n\t\t\tif(url.charAt(0) === '.' || (url.charAt(0) !== '/' && !uri.host)){\r\n\t\t\t\turl = (new _Url(ownerWindow.location, url)).toString();\r\n\t\t\t}\r\n\t\t\tvar index = array.indexOf(this.editingAreaStyleSheets, url);\r\n\t\t\tif(index === -1){\r\n//\t\t\tconsole.debug(\"dijit/_editor/RichText.removeStyleSheet(): Style sheet \"+url+\" has not been applied\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tdelete this.editingAreaStyleSheets[index];\r\n\t\t\tquery('link[href=\"' + url + '\"]', this.window.document).orphan();\r\n\t\t},\r\n\r\n\t\t// disabled: Boolean\r\n\t\t//\t\tThe editor is disabled; the text cannot be changed.\r\n\t\tdisabled: false,\r\n\r\n\t\t_mozSettingProps: {'styleWithCSS': false},\r\n\t\t_setDisabledAttr: function(/*Boolean*/ value){\r\n\t\t\tvalue = !!value;\r\n\t\t\tthis._set(\"disabled\", value);\r\n\t\t\tif(!this.isLoaded){\r\n\t\t\t\treturn;\r\n\t\t\t} // this method requires init to be complete\r\n\t\t\tvar preventIEfocus = has(\"ie\") && (this.isLoaded || !this.focusOnLoad);\r\n\t\t\tif(preventIEfocus){\r\n\t\t\t\tthis.editNode.unselectable = \"on\";\r\n\t\t\t}\r\n\t\t\tthis.editNode.contentEditable = !value;\r\n\t\t\tthis.editNode.tabIndex = value ? \"-1\" : this.tabIndex;\r\n\t\t\tif(preventIEfocus){\r\n\t\t\t\tthis.defer(function(){\r\n\t\t\t\t\tif(this.editNode){        // guard in case widget destroyed before timeout\r\n\t\t\t\t\t\tthis.editNode.unselectable = \"off\";\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(has(\"mozilla\") && !value && this._mozSettingProps){\r\n\t\t\t\tvar ps = this._mozSettingProps;\r\n\t\t\t\tvar n;\r\n\t\t\t\tfor(n in ps){\r\n\t\t\t\t\tif(ps.hasOwnProperty(n)){\r\n\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\tthis.document.execCommand(n, false, ps[n]);\r\n\t\t\t\t\t\t}catch(e2){\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._disabledOK = true;\r\n\t\t},\r\n\r\n\t\t/* Event handlers\r\n\t\t *****************/\r\n\r\n\t\tonLoad: function(/*String*/ html){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandler after the iframe finishes loading.\r\n\t\t\t// html: String\r\n\t\t\t//\t\tEditor contents should be set to this value\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(!this.window.__registeredWindow){\r\n\t\t\t\tthis.window.__registeredWindow = true;\r\n\t\t\t\tthis._iframeRegHandle = focus.registerIframe(this.iframe);\r\n\t\t\t}\r\n\r\n\t\t\t// there's a wrapper div around the content, see _getIframeDocTxt().\r\n\t\t\tthis.editNode = this.document.body.firstChild;\r\n\t\t\tvar _this = this;\r\n\r\n\t\t\t// Helper code so IE and FF skip over focusing on the <iframe> and just focus on the inner <div>.\r\n\t\t\t// See #4996 IE wants to focus the BODY tag.\r\n\t\t\tthis.beforeIframeNode = domConstruct.place(\"<div tabIndex=-1></div>\", this.iframe, \"before\");\r\n\t\t\tthis.afterIframeNode = domConstruct.place(\"<div tabIndex=-1></div>\", this.iframe, \"after\");\r\n\t\t\tthis.iframe.onfocus = this.document.onfocus = function(){\r\n\t\t\t\t_this.editNode.focus();\r\n\t\t\t};\r\n\r\n\t\t\tthis.focusNode = this.editNode; // for InlineEditBox\r\n\r\n\r\n\t\t\tvar events = this.events.concat(this.captureEvents);\r\n\t\t\tvar ap = this.iframe ? this.document : this.editNode;\r\n\t\t\tthis.own.apply(this,\r\n\t\t\t\tarray.map(events, function(item){\r\n\t\t\t\t\tvar type = item.toLowerCase().replace(/^on/, \"\");\r\n\t\t\t\t\treturn on(ap, type, lang.hitch(this, item));\r\n\t\t\t\t}, this)\r\n\t\t\t);\r\n\r\n\t\t\tthis.own(\r\n\t\t\t\t// mouseup in the margin does not generate an onclick event\r\n\t\t\t\ton(ap, \"mouseup\", lang.hitch(this, \"onClick\"))\r\n\t\t\t);\r\n\r\n\t\t\tif(has(\"ie\")){ // IE contentEditable\r\n\t\t\t\tthis.own(on(this.document, \"mousedown\", lang.hitch(this, \"_onIEMouseDown\"))); // #4996 fix focus\r\n\r\n\t\t\t\t// give the node Layout on IE\r\n\t\t\t\t// TODO: this may no longer be needed, since we've reverted IE to using an iframe,\r\n\t\t\t\t// not contentEditable.   Removing it would also probably remove the need for creating\r\n\t\t\t\t// the extra <div> in _getIframeDocTxt()\r\n\t\t\t\tthis.editNode.style.zoom = 1.0;\r\n\t\t\t}\r\n\r\n\t\t\tif(has(\"webkit\")){\r\n\t\t\t\t//WebKit sometimes doesn't fire right on selections, so the toolbar\r\n\t\t\t\t//doesn't update right.  Therefore, help it out a bit with an additional\r\n\t\t\t\t//listener.  A mouse up will typically indicate a display change, so fire this\r\n\t\t\t\t//and get the toolbar to adapt.  Reference: #9532\r\n\t\t\t\tthis._webkitListener = this.own(on(this.document, \"mouseup\", lang.hitch(this, \"onDisplayChanged\")))[0];\r\n\t\t\t\tthis.own(on(this.document, \"mousedown\", lang.hitch(this, function(e){\r\n\t\t\t\t\tvar t = e.target;\r\n\t\t\t\t\tif(t && (t === this.document.body || t === this.document)){\r\n\t\t\t\t\t\t// Since WebKit uses the inner DIV, we need to check and set position.\r\n\t\t\t\t\t\t// See: #12024 as to why the change was made.\r\n\t\t\t\t\t\tthis.defer(\"placeCursorAtEnd\");\r\n\t\t\t\t\t}\r\n\t\t\t\t})));\r\n\t\t\t}\r\n\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\t// Try to make sure 'hidden' elements aren't visible in edit mode (like browsers other than IE\r\n\t\t\t\t// do).  See #9103\r\n\t\t\t\ttry{\r\n\t\t\t\t\tthis.document.execCommand('RespectVisibilityInDesign', true, null);\r\n\t\t\t\t}catch(e){/* squelch */\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.isLoaded = true;\r\n\r\n\t\t\tthis.set('disabled', this.disabled); // initialize content to editable (or not)\r\n\r\n\t\t\t// Note that setValue() call will only work after isLoaded is set to true (above)\r\n\r\n\t\t\t// Set up a function to allow delaying the setValue until a callback is fired\r\n\t\t\t// This ensures extensions like dijit.Editor have a way to hold the value set\r\n\t\t\t// until plugins load (and do things like register filters).\r\n\t\t\tvar setContent = lang.hitch(this, function(){\r\n\t\t\t\tthis.setValue(html);\r\n\r\n\t\t\t\t// Tell app that the Editor has finished loading.  isFulfilled() check avoids spurious\r\n\t\t\t\t// console warning when this function is called repeatedly because Editor DOMNode was moved.\r\n\t\t\t\tif(this.onLoadDeferred && !this.onLoadDeferred.isFulfilled()){\r\n\t\t\t\t\tthis.onLoadDeferred.resolve(true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.onDisplayChanged();\r\n\t\t\t\tif(this.focusOnLoad){\r\n\t\t\t\t\t// after the document loads, then set focus after updateInterval expires so that\r\n\t\t\t\t\t// onNormalizedDisplayChanged has run to avoid input caret issues\r\n\t\t\t\t\tdomReady(lang.hitch(this, \"defer\", \"focus\", this.updateInterval));\r\n\t\t\t\t}\r\n\t\t\t\t// Save off the initial content now\r\n\t\t\t\tthis.value = this.getValue(true);\r\n\t\t\t});\r\n\t\t\tif(this.setValueDeferred){\r\n\t\t\t\tthis.setValueDeferred.then(setContent);\r\n\t\t\t}else{\r\n\t\t\t\tsetContent();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tonKeyDown: function(/* Event */ e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandler for keydown event\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\t// Modifier keys should not cause the onKeyPressed event because they do not cause any change to the\r\n\t\t\t// display\r\n\t\t\tif(e.keyCode === keys.SHIFT ||\r\n\t\t\t   e.keyCode === keys.ALT ||\r\n\t\t\t   e.keyCode === keys.META ||\r\n\t\t\t   e.keyCode === keys.CTRL){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif(e.keyCode === keys.TAB && this.isTabIndent){\r\n\t\t\t\t//prevent tab from moving focus out of editor\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t// FIXME: this is a poor-man's indent/outdent. It would be\r\n\t\t\t\t// better if it added 4 \"&nbsp;\" chars in an undoable way.\r\n\t\t\t\t// Unfortunately pasteHTML does not prove to be undoable\r\n\t\t\t\tif(this.queryCommandEnabled((e.shiftKey ? \"outdent\" : \"indent\"))){\r\n\t\t\t\t\tthis.execCommand((e.shiftKey ? \"outdent\" : \"indent\"));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Make tab and shift-tab skip over the <iframe>, going from the nested <div> to the toolbar\r\n\t\t\t// or next element after the editor\r\n\t\t\tif(e.keyCode == keys.TAB && !this.isTabIndent && !e.ctrlKey && !e.altKey){\r\n\t\t\t\tif(e.shiftKey){\r\n\t\t\t\t\t// focus the <iframe> so the browser will shift-tab away from it instead\r\n\t\t\t\t\tthis.beforeIframeNode.focus();\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// focus node after the <iframe> so the browser will tab away from it instead\r\n\t\t\t\t\tthis.afterIframeNode.focus();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Prevent onKeyPressed from firing in order to avoid triggering a display change event when the\r\n\t\t\t\t// editor is tabbed away; this fixes toolbar controls being inappropriately disabled in IE9+\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tif(has(\"ie\") < 9 && e.keyCode === keys.BACKSPACE && this.document.selection.type === \"Control\"){\r\n\t\t\t\t// IE has a bug where if a non-text object is selected in the editor,\r\n\t\t\t\t// hitting backspace would act as if the browser's back button was\r\n\t\t\t\t// clicked instead of deleting the object. see #1069\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis.execCommand(\"delete\");\r\n\t\t\t}\r\n\r\n\t\t\tif(has(\"ff\")){\r\n\t\t\t\tif(e.keyCode === keys.PAGE_UP || e.keyCode === keys.PAGE_DOWN){\r\n\t\t\t\t\tif(this.editNode.clientHeight >= this.editNode.scrollHeight){\r\n\t\t\t\t\t\t// Stop the event to prevent firefox from trapping the cursor when there is no scroll bar.\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar handlers = this._keyHandlers[e.keyCode],\r\n\t\t\t\targs = arguments;\r\n\r\n\t\t\tif(handlers && !e.altKey){\r\n\t\t\t\tarray.some(handlers, function(h){\r\n\t\t\t\t\t// treat meta- same as ctrl-, for benefit of mac users\r\n\t\t\t\t\tif(!(h.shift ^ e.shiftKey) && !(h.ctrl ^ (e.ctrlKey || e.metaKey))){\r\n\t\t\t\t\t\tif(!h.handler.apply(this, args)){\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this);\r\n\t\t\t}\r\n\r\n\t\t\t// function call after the character has been inserted\r\n\t\t\tthis.defer(\"onKeyPressed\", 1);\r\n\r\n\t\t\treturn true;\r\n\t\t},\r\n\r\n\t\tonKeyUp: function(/*===== e =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandler for onkeyup event\r\n\t\t\t// tags:\r\n\t\t\t//\t\tcallback\r\n\t\t},\r\n\r\n\t\tsetDisabled: function(/*Boolean*/ disabled){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDeprecated, use set('disabled', ...) instead.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tdeprecated\r\n\t\t\tkernel.deprecated('dijit.Editor::setDisabled is deprecated', 'use dijit.Editor::attr(\"disabled\",boolean) instead', 2.0);\r\n\t\t\tthis.set('disabled', disabled);\r\n\t\t},\r\n\t\t_setValueAttr: function(/*String*/ value){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRegisters that attr(\"value\", foo) should call setValue(foo)\r\n\t\t\tthis.setValue(value);\r\n\t\t},\r\n\t\t_setDisableSpellCheckAttr: function(/*Boolean*/ disabled){\r\n\t\t\tif(this.document){\r\n\t\t\t\tdomAttr.set(this.document.body, \"spellcheck\", !disabled);\r\n\t\t\t}else{\r\n\t\t\t\t// try again after the editor is finished loading\r\n\t\t\t\tthis.onLoadDeferred.then(lang.hitch(this, function(){\r\n\t\t\t\t\tdomAttr.set(this.document.body, \"spellcheck\", !disabled);\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\tthis._set(\"disableSpellCheck\", disabled);\r\n\t\t},\r\n\r\n\t\taddKeyHandler: function(/*String|Number*/ key, /*Boolean*/ ctrl, /*Boolean*/ shift, /*Function*/ handler){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAdd a handler for a keyboard shortcut\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(typeof key == \"string\"){\r\n\t\t\t\t// Something like Ctrl-B.  Since using keydown event, we need to convert string to a number.\r\n\t\t\t\tkey = key.toUpperCase().charCodeAt(0);\r\n\t\t\t}\r\n\r\n\t\t\tif(!lang.isArray(this._keyHandlers[key])){\r\n\t\t\t\tthis._keyHandlers[key] = [];\r\n\t\t\t}\r\n\r\n\t\t\tthis._keyHandlers[key].push({\r\n\t\t\t\tshift: shift || false,\r\n\t\t\t\tctrl: ctrl || false,\r\n\t\t\t\thandler: handler\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tonKeyPressed: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandler for after the user has pressed a key, and the display has been updated.\r\n\t\t\t//\t\t(Runs on a timer so that it runs after the display is updated)\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tthis.onDisplayChanged(/*e*/); // can't pass in e\r\n\t\t},\r\n\r\n\t\tonClick: function(/*Event*/ e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandler for when the user clicks.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\t// console.info('onClick',this._tryDesignModeOn);\r\n\t\t\tthis.onDisplayChanged(e);\r\n\t\t},\r\n\r\n\t\t_onIEMouseDown: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tIE only to prevent 2 clicks to focus\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(!this.focused && !this.disabled){\r\n\t\t\t\tthis.focus();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_onBlur: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCalled from focus manager when focus has moved away from this editor\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\t// Workaround IE problem when you blur the browser windows while an editor is focused: IE hangs\r\n\t\t\t// when you focus editor #1, blur the browser window, and then click editor #0.  See #16939.\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tthis.defer(function(){\r\n\t\t\t\t\tif(!focus.curNode){\r\n\t\t\t\t\t\tthis.ownerDocumentBody.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\tvar newValue = this.getValue(true);\r\n\t\t\tif(newValue !== this.value){\r\n\t\t\t\tthis.onChange(newValue);\r\n\t\t\t}\r\n\t\t\tthis._set(\"value\", newValue);\r\n\t\t},\r\n\r\n\t\t_onFocus: function(/*Event*/ e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCalled from focus manager when focus has moved into this editor\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\t// console.info('_onFocus')\r\n\t\t\tif(!this.disabled){\r\n\t\t\t\tif(!this._disabledOK){\r\n\t\t\t\t\tthis.set('disabled', false);\r\n\t\t\t\t}\r\n\t\t\t\tthis.inherited(arguments);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// TODO: remove in 2.0\r\n\t\tblur: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tRemove focus from this instance.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tdeprecated\r\n\t\t\tif(!has(\"ie\") && this.window.document.documentElement && this.window.document.documentElement.focus){\r\n\t\t\t\tthis.window.document.documentElement.focus();\r\n\t\t\t}else if(this.ownerDocumentBody.focus){\r\n\t\t\t\tthis.ownerDocumentBody.focus();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tfocus: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tMove focus to this editor\r\n\t\t\tif(!this.isLoaded){\r\n\t\t\t\tthis.focusOnLoad = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(has(\"ie\") < 9){\r\n\t\t\t\t//this.editNode.focus(); -> causes IE to scroll always (strict and quirks mode) to the top the Iframe\r\n\t\t\t\t// if we fire the event manually and let the browser handle the focusing, the latest\r\n\t\t\t\t// cursor position is focused like in FF\r\n\t\t\t\tthis.iframe.fireEvent('onfocus', document.createEventObject()); // createEventObject/fireEvent only in IE < 11\r\n\t\t\t}else{\r\n\t\t\t\t// Firefox and chrome\r\n\t\t\t\tthis.editNode.focus();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// _lastUpdate: 0,\r\n\t\tupdateInterval: 200,\r\n\t\t_updateTimer: null,\r\n\t\tonDisplayChanged: function(/*Event*/ /*===== e =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis event will be fired every time the display context\r\n\t\t\t//\t\tchanges and the result needs to be reflected in the UI.\r\n\t\t\t// description:\r\n\t\t\t//\t\tIf you don't want to have update too often,\r\n\t\t\t//\t\tonNormalizedDisplayChanged should be used instead\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\t// var _t=new Date();\r\n\t\t\tif(this._updateTimer){\r\n\t\t\t\tthis._updateTimer.remove();\r\n\t\t\t}\r\n\t\t\tthis._updateTimer = this.defer(\"onNormalizedDisplayChanged\", this.updateInterval);\r\n\r\n\t\t\t// Technically this should trigger a call to watch(\"value\", ...) registered handlers,\r\n\t\t\t// but getValue() is too slow to call on every keystroke so we don't.\r\n\t\t},\r\n\t\tonNormalizedDisplayChanged: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis event is fired every updateInterval ms or more\r\n\t\t\t// description:\r\n\t\t\t//\t\tIf something needs to happen immediately after a\r\n\t\t\t//\t\tuser change, please use onDisplayChanged instead.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tdelete this._updateTimer;\r\n\t\t},\r\n\t\tonChange: function(/*===== newContent =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis is fired if and only if the editor loses focus and\r\n\t\t\t//\t\tthe content is changed.\r\n\t\t},\r\n\t\t_normalizeCommand: function(/*String*/ cmd, /*Anything?*/argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tUsed as the advice function to map our\r\n\t\t\t//\t\tnormalized set of commands to those supported by the target\r\n\t\t\t//\t\tbrowser.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar command = cmd.toLowerCase();\r\n\t\t\tif(command === \"formatblock\"){\r\n\t\t\t\tif(has(\"safari\") && argument === undefined){\r\n\t\t\t\t\tcommand = \"heading\";\r\n\t\t\t\t}\r\n\t\t\t}else if(command === \"hilitecolor\" && !has(\"mozilla\")){\r\n\t\t\t\tcommand = \"backcolor\";\r\n\t\t\t}\r\n\r\n\t\t\treturn command;\r\n\t\t},\r\n\r\n\t\t_qcaCache: {},\r\n\t\tqueryCommandAvailable: function(/*String*/ command){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTests whether a command is supported by the host. Clients\r\n\t\t\t//\t\tSHOULD check whether a command is supported before attempting\r\n\t\t\t//\t\tto use it, behaviour for unsupported commands is undefined.\r\n\t\t\t// command:\r\n\t\t\t//\t\tThe command to test for\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\t// memoizing version. See _queryCommandAvailable for computing version\r\n\t\t\tvar ca = this._qcaCache[command];\r\n\t\t\tif(ca !== undefined){\r\n\t\t\t\treturn ca;\r\n\t\t\t}\r\n\t\t\treturn (this._qcaCache[command] = this._queryCommandAvailable(command));\r\n\t\t},\r\n\r\n\t\t_queryCommandAvailable: function(/*String*/ command){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSee queryCommandAvailable().\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar ie = 1;\r\n\t\t\tvar mozilla = 1 << 1;\r\n\t\t\tvar webkit = 1 << 2;\r\n\t\t\tvar opera = 1 << 3;\r\n\r\n\t\t\tfunction isSupportedBy(browsers){\r\n\t\t\t\treturn {\r\n\t\t\t\t\tie: Boolean(browsers & ie),\r\n\t\t\t\t\tmozilla: Boolean(browsers & mozilla),\r\n\t\t\t\t\twebkit: Boolean(browsers & webkit),\r\n\t\t\t\t\topera: Boolean(browsers & opera)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tvar supportedBy = null;\r\n\r\n\t\t\tswitch(command.toLowerCase()){\r\n\t\t\t\tcase \"bold\":\r\n\t\t\t\tcase \"italic\":\r\n\t\t\t\tcase \"underline\":\r\n\t\t\t\tcase \"subscript\":\r\n\t\t\t\tcase \"superscript\":\r\n\t\t\t\tcase \"fontname\":\r\n\t\t\t\tcase \"fontsize\":\r\n\t\t\t\tcase \"forecolor\":\r\n\t\t\t\tcase \"hilitecolor\":\r\n\t\t\t\tcase \"justifycenter\":\r\n\t\t\t\tcase \"justifyfull\":\r\n\t\t\t\tcase \"justifyleft\":\r\n\t\t\t\tcase \"justifyright\":\r\n\t\t\t\tcase \"delete\":\r\n\t\t\t\tcase \"selectall\":\r\n\t\t\t\tcase \"toggledir\":\r\n\t\t\t\t\tsupportedBy = isSupportedBy(mozilla | ie | webkit | opera);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"createlink\":\r\n\t\t\t\tcase \"unlink\":\r\n\t\t\t\tcase \"removeformat\":\r\n\t\t\t\tcase \"inserthorizontalrule\":\r\n\t\t\t\tcase \"insertimage\":\r\n\t\t\t\tcase \"insertorderedlist\":\r\n\t\t\t\tcase \"insertunorderedlist\":\r\n\t\t\t\tcase \"indent\":\r\n\t\t\t\tcase \"outdent\":\r\n\t\t\t\tcase \"formatblock\":\r\n\t\t\t\tcase \"inserthtml\":\r\n\t\t\t\tcase \"undo\":\r\n\t\t\t\tcase \"redo\":\r\n\t\t\t\tcase \"strikethrough\":\r\n\t\t\t\tcase \"tabindent\":\r\n\t\t\t\t\tsupportedBy = isSupportedBy(mozilla | ie | opera | webkit);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"blockdirltr\":\r\n\t\t\t\tcase \"blockdirrtl\":\r\n\t\t\t\tcase \"dirltr\":\r\n\t\t\t\tcase \"dirrtl\":\r\n\t\t\t\tcase \"inlinedirltr\":\r\n\t\t\t\tcase \"inlinedirrtl\":\r\n\t\t\t\t\tsupportedBy = isSupportedBy(ie);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"cut\":\r\n\t\t\t\tcase \"copy\":\r\n\t\t\t\tcase \"paste\":\r\n\t\t\t\t\tsupportedBy = isSupportedBy(ie | mozilla | webkit | opera);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"inserttable\":\r\n\t\t\t\t\tsupportedBy = isSupportedBy(mozilla | ie);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase \"insertcell\":\r\n\t\t\t\tcase \"insertcol\":\r\n\t\t\t\tcase \"insertrow\":\r\n\t\t\t\tcase \"deletecells\":\r\n\t\t\t\tcase \"deletecols\":\r\n\t\t\t\tcase \"deleterows\":\r\n\t\t\t\tcase \"mergecells\":\r\n\t\t\t\tcase \"splitcell\":\r\n\t\t\t\t\tsupportedBy = isSupportedBy(ie | mozilla);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn ((has(\"ie\") || has(\"trident\")) && supportedBy.ie) ||\r\n\t\t\t\t(has(\"mozilla\") && supportedBy.mozilla) ||\r\n\t\t\t\t(has(\"webkit\") && supportedBy.webkit) ||\r\n\t\t\t\t(has(\"opera\") && supportedBy.opera);\t// Boolean return true if the command is supported, false otherwise\r\n\t\t},\r\n\r\n\t\texecCommand: function(/*String*/ command, argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tExecutes a command in the Rich Text area\r\n\t\t\t// command:\r\n\t\t\t//\t\tThe command to execute\r\n\t\t\t// argument:\r\n\t\t\t//\t\tAn optional argument to the command\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar returnValue;\r\n\r\n\t\t\t//focus() is required for IE to work\r\n\t\t\t//In addition, focus() makes sure after the execution of\r\n\t\t\t//the command, the editor receives the focus as expected\r\n\t\t\tif(this.focused){\r\n\t\t\t\t// put focus back in the iframe, unless focus has somehow been shifted out of the editor completely\r\n\t\t\t\tthis.focus();\r\n\t\t\t}\r\n\r\n\t\t\tcommand = this._normalizeCommand(command, argument);\r\n\r\n\t\t\tif(argument !== undefined){\r\n\t\t\t\tif(command === \"heading\"){\r\n\t\t\t\t\tthrow new Error(\"unimplemented\");\r\n\t\t\t\t}else if(command === \"formatblock\" && (has(\"ie\") || has(\"trident\"))){\r\n\t\t\t\t\targument = '<' + argument + '>';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//Check to see if we have any over-rides for commands, they will be functions on this\r\n\t\t\t//widget of the form _commandImpl.  If we don't, fall through to the basic native\r\n\t\t\t//exec command of the browser.\r\n\t\t\tvar implFunc = \"_\" + command + \"Impl\";\r\n\t\t\tif(this[implFunc]){\r\n\t\t\t\treturnValue = this[implFunc](argument);\r\n\t\t\t}else{\r\n\t\t\t\targument = arguments.length > 1 ? argument : null;\r\n\t\t\t\tif(argument || command !== \"createlink\"){\r\n\t\t\t\t\treturnValue = this.document.execCommand(command, false, argument);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.onDisplayChanged();\r\n\t\t\treturn returnValue;\r\n\t\t},\r\n\r\n\t\tqueryCommandEnabled: function(/*String*/ command){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCheck whether a command is enabled or not.\r\n\t\t\t// command:\r\n\t\t\t//\t\tThe command to execute\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif(this.disabled || !this._disabledOK){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tcommand = this._normalizeCommand(command);\r\n\r\n\t\t\t//Check to see if we have any over-rides for commands, they will be functions on this\r\n\t\t\t//widget of the form _commandEnabledImpl.  If we don't, fall through to the basic native\r\n\t\t\t//command of the browser.\r\n\t\t\tvar implFunc = \"_\" + command + \"EnabledImpl\";\r\n\r\n\t\t\tif(this[implFunc]){\r\n\t\t\t\treturn  this[implFunc](command);\r\n\t\t\t}else{\r\n\t\t\t\treturn this._browserQueryCommandEnabled(command);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tqueryCommandState: function(command){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCheck the state of a given command and returns true or false.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(this.disabled || !this._disabledOK){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tcommand = this._normalizeCommand(command);\r\n\t\t\ttry{\r\n\t\t\t\treturn this.document.queryCommandState(command);\r\n\t\t\t}catch(e){\r\n\t\t\t\t//Squelch, occurs if editor is hidden on FF 3 (and maybe others.)\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tqueryCommandValue: function(command){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCheck the value of a given command. This matters most for\r\n\t\t\t//\t\tcustom selections and complex values like font value setting.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(this.disabled || !this._disabledOK){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar r;\r\n\t\t\tcommand = this._normalizeCommand(command);\r\n\t\t\tif((has(\"ie\") || has(\"trident\")) && command === \"formatblock\"){\r\n\t\t\t\tr = this._native2LocalFormatNames[this.document.queryCommandValue(command)];\r\n\t\t\t}else if(has(\"mozilla\") && command === \"hilitecolor\"){\r\n\t\t\t\tvar oldValue;\r\n\t\t\t\ttry{\r\n\t\t\t\t\toldValue = this.document.queryCommandValue(\"styleWithCSS\");\r\n\t\t\t\t}catch(e){\r\n\t\t\t\t\toldValue = false;\r\n\t\t\t\t}\r\n\t\t\t\tthis.document.execCommand(\"styleWithCSS\", false, true);\r\n\t\t\t\tr = this.document.queryCommandValue(command);\r\n\t\t\t\tthis.document.execCommand(\"styleWithCSS\", false, oldValue);\r\n\t\t\t}else{\r\n\t\t\t\tr = this.document.queryCommandValue(command);\r\n\t\t\t}\r\n\t\t\treturn r;\r\n\t\t},\r\n\r\n\t\t// Misc.\r\n\r\n\t\t_sCall: function(name, args){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDeprecated, remove for 2.0.   New code should access this.selection directly.\r\n\t\t\t//\t\tRun the named method of dijit/selection over the\r\n\t\t\t//\t\tcurrent editor instance's window, with the passed args.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate deprecated\r\n\r\n\t\t\treturn this.selection[name].apply(this.selection, args);\r\n\t\t},\r\n\r\n\t\t// FIXME: this is a TON of code duplication. Why?\r\n\r\n\t\tplaceCursorAtStart: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tPlace the cursor at the start of the editing area.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis.focus();\r\n\r\n\t\t\t//see comments in placeCursorAtEnd\r\n\t\t\tvar isvalid = false;\r\n\t\t\tif(has(\"mozilla\")){\r\n\t\t\t\t// TODO:  Is this branch even necessary?\r\n\t\t\t\tvar first = this.editNode.firstChild;\r\n\t\t\t\twhile(first){\r\n\t\t\t\t\tif(first.nodeType === 3){\r\n\t\t\t\t\t\tif(first.nodeValue.replace(/^\\s+|\\s+$/g, \"\").length > 0){\r\n\t\t\t\t\t\t\tisvalid = true;\r\n\t\t\t\t\t\t\tthis.selection.selectElement(first);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(first.nodeType === 1){\r\n\t\t\t\t\t\tisvalid = true;\r\n\t\t\t\t\t\tvar tg = first.tagName ? first.tagName.toLowerCase() : \"\";\r\n\t\t\t\t\t\t// Collapse before childless tags.\r\n\t\t\t\t\t\tif(/br|input|img|base|meta|area|basefont|hr|link/.test(tg)){\r\n\t\t\t\t\t\t\tthis.selection.selectElement(first);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t// Collapse inside tags with children.\r\n\t\t\t\t\t\t\tthis.selection.selectElementChildren(first);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfirst = first.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tisvalid = true;\r\n\t\t\t\tthis.selection.selectElementChildren(this.editNode);\r\n\t\t\t}\r\n\t\t\tif(isvalid){\r\n\t\t\t\tthis.selection.collapse(true);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tplaceCursorAtEnd: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tPlace the cursor at the end of the editing area.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis.focus();\r\n\r\n\t\t\t//In mozilla, if last child is not a text node, we have to use\r\n\t\t\t// selectElementChildren on this.editNode.lastChild otherwise the\r\n\t\t\t// cursor would be placed at the end of the closing tag of\r\n\t\t\t//this.editNode.lastChild\r\n\t\t\tvar isvalid = false;\r\n\t\t\tif(has(\"mozilla\")){\r\n\t\t\t\tvar last = this.editNode.lastChild;\r\n\t\t\t\twhile(last){\r\n\t\t\t\t\tif(last.nodeType === 3){\r\n\t\t\t\t\t\tif(last.nodeValue.replace(/^\\s+|\\s+$/g, \"\").length > 0){\r\n\t\t\t\t\t\t\tisvalid = true;\r\n\t\t\t\t\t\t\tthis.selection.selectElement(last);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else if(last.nodeType === 1){\r\n\t\t\t\t\t\tisvalid = true;\r\n\t\t\t\t\t\tthis.selection.selectElement(last.lastChild || last);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlast = last.previousSibling;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tisvalid = true;\r\n\t\t\t\tthis.selection.selectElementChildren(this.editNode);\r\n\t\t\t}\r\n\t\t\tif(isvalid){\r\n\t\t\t\tthis.selection.collapse(false);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetValue: function(/*Boolean?*/ nonDestructive){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tReturn the current content of the editing area (post filters\r\n\t\t\t//\t\tare applied).  Users should call get('value') instead.\r\n\t\t\t// nonDestructive:\r\n\t\t\t//\t\tdefaults to false. Should the post-filtering be run over a copy\r\n\t\t\t//\t\tof the live DOM? Most users should pass \"true\" here unless they\r\n\t\t\t//\t\t*really* know that none of the installed filters are going to\r\n\t\t\t//\t\tmess up the editing session.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(this.textarea){\r\n\t\t\t\tif(this.isClosed || !this.isLoaded){\r\n\t\t\t\t\treturn this.textarea.value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this.isLoaded ? this._postFilterContent(null, nonDestructive) : this.value;\r\n\t\t},\r\n\t\t_getValueAttr: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHook to make attr(\"value\") work\r\n\t\t\treturn this.getValue(true);\r\n\t\t},\r\n\r\n\t\tsetValue: function(/*String*/ html){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function sets the content. No undo history is preserved.\r\n\t\t\t//\t\tUsers should use set('value', ...) instead.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tdeprecated\r\n\r\n\t\t\t// TODO: remove this and getValue() for 2.0, and move code to _setValueAttr()\r\n\r\n\t\t\tif(!this.isLoaded){\r\n\t\t\t\t// try again after the editor is finished loading\r\n\t\t\t\tthis.onLoadDeferred.then(lang.hitch(this, function(){\r\n\t\t\t\t\tthis.setValue(html);\r\n\t\t\t\t}));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(this.textarea && (this.isClosed || !this.isLoaded)){\r\n\t\t\t\tthis.textarea.value = html;\r\n\t\t\t}else{\r\n\t\t\t\thtml = this._preFilterContent(html);\r\n\t\t\t\tvar node = this.isClosed ? this.domNode : this.editNode;\r\n\r\n\t\t\t\tnode.innerHTML = html;\r\n\t\t\t\tthis._preDomFilterContent(node);\r\n\t\t\t}\r\n\r\n\t\t\tthis.onDisplayChanged();\r\n\t\t\tthis._set(\"value\", this.getValue(true));\r\n\t\t},\r\n\r\n\t\treplaceValue: function(/*String*/ html){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function set the content while trying to maintain the undo stack\r\n\t\t\t//\t\t(now only works fine with Moz, this is identical to setValue in all\r\n\t\t\t//\t\tother browsers)\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\r\n\t\t\tif(this.isClosed){\r\n\t\t\t\tthis.setValue(html);\r\n\t\t\t}else if(this.window && this.window.getSelection && !has(\"mozilla\")){ // Safari\r\n\t\t\t\t// look ma! it's a totally f'd browser!\r\n\t\t\t\tthis.setValue(html);\r\n\t\t\t}else if(this.window && this.window.getSelection){ // Moz\r\n\t\t\t\thtml = this._preFilterContent(html);\r\n\t\t\t\tthis.execCommand(\"selectall\");\r\n\t\t\t\tthis.execCommand(\"inserthtml\", html);\r\n\t\t\t\tthis._preDomFilterContent(this.editNode);\r\n\t\t\t}else if(this.document && this.document.selection){//IE\r\n\t\t\t\t//In IE, when the first element is not a text node, say\r\n\t\t\t\t//an <a> tag, when replacing the content of the editing\r\n\t\t\t\t//area, the <a> tag will be around all the content\r\n\t\t\t\t//so for now, use setValue for IE too\r\n\t\t\t\tthis.setValue(html);\r\n\t\t\t}\r\n\r\n\t\t\tthis._set(\"value\", this.getValue(true));\r\n\t\t},\r\n\r\n\t\t_preFilterContent: function(/*String*/ html){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFilter the input before setting the content of the editing\r\n\t\t\t//\t\tarea. DOM pre-filtering may happen after this\r\n\t\t\t//\t\tstring-based filtering takes place but as of 1.2, this is not\r\n\t\t\t//\t\tguaranteed for operations such as the inserthtml command.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar ec = html;\r\n\t\t\tarray.forEach(this.contentPreFilters, function(ef){\r\n\t\t\t\tif(ef){\r\n\t\t\t\t\tec = ef(ec);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn ec;\r\n\t\t},\r\n\t\t_preDomFilterContent: function(/*DomNode*/ dom){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tfilter the input's live DOM. All filter operations should be\r\n\t\t\t//\t\tconsidered to be \"live\" and operating on the DOM that the user\r\n\t\t\t//\t\twill be interacting with in their editing session.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tdom = dom || this.editNode;\r\n\t\t\tarray.forEach(this.contentDomPreFilters, function(ef){\r\n\t\t\t\tif(ef && lang.isFunction(ef)){\r\n\t\t\t\t\tef(dom);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\r\n\t\t_postFilterContent: function(/*DomNode|DomNode[]|String?*/ dom, /*Boolean?*/ nonDestructive){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tfilter the output after getting the content of the editing area\r\n\t\t\t//\r\n\t\t\t// description:\r\n\t\t\t//\t\tpost-filtering allows plug-ins and users to specify any number\r\n\t\t\t//\t\tof transforms over the editor's content, enabling many common\r\n\t\t\t//\t\tuse-cases such as transforming absolute to relative URLs (and\r\n\t\t\t//\t\tvice-versa), ensuring conformance with a particular DTD, etc.\r\n\t\t\t//\t\tThe filters are registered in the contentDomPostFilters and\r\n\t\t\t//\t\tcontentPostFilters arrays. Each item in the\r\n\t\t\t//\t\tcontentDomPostFilters array is a function which takes a DOM\r\n\t\t\t//\t\tNode or array of nodes as its only argument and returns the\r\n\t\t\t//\t\tsame. It is then passed down the chain for further filtering.\r\n\t\t\t//\t\tThe contentPostFilters array behaves the same way, except each\r\n\t\t\t//\t\tmember operates on strings. Together, the DOM and string-based\r\n\t\t\t//\t\tfiltering allow the full range of post-processing that should\r\n\t\t\t//\t\tbe necessaray to enable even the most agressive of post-editing\r\n\t\t\t//\t\tconversions to take place.\r\n\t\t\t//\r\n\t\t\t//\t\tIf nonDestructive is set to \"true\", the nodes are cloned before\r\n\t\t\t//\t\tfiltering proceeds to avoid potentially destructive transforms\r\n\t\t\t//\t\tto the content which may still needed to be edited further.\r\n\t\t\t//\t\tOnce DOM filtering has taken place, the serialized version of\r\n\t\t\t//\t\tthe DOM which is passed is run through each of the\r\n\t\t\t//\t\tcontentPostFilters functions.\r\n\t\t\t//\r\n\t\t\t// dom:\r\n\t\t\t//\t\ta node, set of nodes, which to filter using each of the current\r\n\t\t\t//\t\tmembers of the contentDomPostFilters and contentPostFilters arrays.\r\n\t\t\t//\r\n\t\t\t// nonDestructive:\r\n\t\t\t//\t\tdefaults to \"false\". If true, ensures that filtering happens on\r\n\t\t\t//\t\ta clone of the passed-in content and not the actual node\r\n\t\t\t//\t\titself.\r\n\t\t\t//\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar ec;\r\n\t\t\tif(!lang.isString(dom)){\r\n\t\t\t\tdom = dom || this.editNode;\r\n\t\t\t\tif(this.contentDomPostFilters.length){\r\n\t\t\t\t\tif(nonDestructive){\r\n\t\t\t\t\t\tdom = lang.clone(dom);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tarray.forEach(this.contentDomPostFilters, function(ef){\r\n\t\t\t\t\t\tdom = ef(dom);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tec = htmlapi.getChildrenHtml(dom);\r\n\t\t\t}else{\r\n\t\t\t\tec = dom;\r\n\t\t\t}\r\n\r\n\t\t\tif(!lang.trim(ec.replace(/^\\xA0\\xA0*/, '').replace(/\\xA0\\xA0*$/, '')).length){\r\n\t\t\t\tec = \"\";\r\n\t\t\t}\r\n\r\n\t\t\tarray.forEach(this.contentPostFilters, function(ef){\r\n\t\t\t\tec = ef(ec);\r\n\t\t\t});\r\n\r\n\t\t\treturn ec;\r\n\t\t},\r\n\r\n\t\t_saveContent: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSaves the content in an onunload event if the editor has not been closed\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar saveTextarea = dom.byId(dijit._scopeName + \"._editor.RichText.value\");\r\n\t\t\tif(saveTextarea){\r\n\t\t\t\tif(saveTextarea.value){\r\n\t\t\t\t\tsaveTextarea.value += this._SEPARATOR;\r\n\t\t\t\t}\r\n\t\t\t\tsaveTextarea.value += this.name + this._NAME_CONTENT_SEP + this.getValue(true);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\tescapeXml: function(/*String*/ str, /*Boolean*/ noSingleQuotes){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAdds escape sequences for special characters in XML.\r\n\t\t\t//\t\tOptionally skips escapes for single quotes\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tstr = str.replace(/&/gm, \"&amp;\").replace(/</gm, \"&lt;\").replace(/>/gm, \"&gt;\").replace(/\"/gm, \"&quot;\");\r\n\t\t\tif(!noSingleQuotes){\r\n\t\t\t\tstr = str.replace(/'/gm, \"&#39;\");\r\n\t\t\t}\r\n\t\t\treturn str; // string\r\n\t\t},\r\n\r\n\t\tgetNodeHtml: function(/* DomNode */ node){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDeprecated.   Use dijit/_editor/html::_getNodeHtml() instead.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tdeprecated\r\n\t\t\tkernel.deprecated('dijit.Editor::getNodeHtml is deprecated', 'use dijit/_editor/html::getNodeHtml instead', 2);\r\n\t\t\treturn htmlapi.getNodeHtml(node); // String\r\n\t\t},\r\n\r\n\t\tgetNodeChildrenHtml: function(/* DomNode */ dom){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tDeprecated.   Use dijit/_editor/html::getChildrenHtml() instead.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tdeprecated\r\n\t\t\tkernel.deprecated('dijit.Editor::getNodeChildrenHtml is deprecated', 'use dijit/_editor/html::getChildrenHtml instead', 2);\r\n\t\t\treturn htmlapi.getChildrenHtml(dom);\r\n\t\t},\r\n\r\n\t\tclose: function(/*Boolean?*/ save){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tKills the editor and optionally writes back the modified contents to the\r\n\t\t\t//\t\telement from which it originated.\r\n\t\t\t// save:\r\n\t\t\t//\t\tWhether or not to save the changes. If false, the changes are discarded.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tif(this.isClosed){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!arguments.length){\r\n\t\t\t\tsave = true;\r\n\t\t\t}\r\n\t\t\tif(save){\r\n\t\t\t\tthis._set(\"value\", this.getValue(true));\r\n\t\t\t}\r\n\r\n\t\t\t// line height is squashed for iframes\r\n\t\t\t// FIXME: why was this here? if(this.iframe){ this.domNode.style.lineHeight = null; }\r\n\r\n\t\t\tif(this.interval){\r\n\t\t\t\tclearInterval(this.interval);\r\n\t\t\t}\r\n\r\n\t\t\tif(this._webkitListener){\r\n\t\t\t\t// Cleanup of WebKit fix: #9532\r\n\t\t\t\tthis._webkitListener.remove();\r\n\t\t\t\tdelete this._webkitListener;\r\n\t\t\t}\r\n\r\n\t\t\t// Guard against memory leaks on IE (see #9268)\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\tthis.iframe.onfocus = null;\r\n\t\t\t}\r\n\t\t\tthis.iframe._loadFunc = null;\r\n\r\n\t\t\tif(this._iframeRegHandle){\r\n\t\t\t\tthis._iframeRegHandle.remove();\r\n\t\t\t\tdelete this._iframeRegHandle;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.textarea){\r\n\t\t\t\tvar s = this.textarea.style;\r\n\t\t\t\ts.position = \"\";\r\n\t\t\t\ts.left = s.top = \"\";\r\n\t\t\t\tif(has(\"ie\")){\r\n\t\t\t\t\ts.overflow = this.__overflow;\r\n\t\t\t\t\tthis.__overflow = null;\r\n\t\t\t\t}\r\n\t\t\t\tthis.textarea.value = this.value;\r\n\t\t\t\tdomConstruct.destroy(this.domNode);\r\n\t\t\t\tthis.domNode = this.textarea;\r\n\t\t\t}else{\r\n\t\t\t\t// Note that this destroys the iframe\r\n\t\t\t\tthis.domNode.innerHTML = this.value;\r\n\t\t\t}\r\n\t\t\tdelete this.iframe;\r\n\r\n\t\t\tdomClass.remove(this.domNode, this.baseClass);\r\n\t\t\tthis.isClosed = true;\r\n\t\t\tthis.isLoaded = false;\r\n\r\n\t\t\tdelete this.editNode;\r\n\t\t\tdelete this.focusNode;\r\n\r\n\t\t\tif(this.window && this.window._frameElement){\r\n\t\t\t\tthis.window._frameElement = null;\r\n\t\t\t}\r\n\r\n\t\t\tthis.window = null;\r\n\t\t\tthis.document = null;\r\n\t\t\tthis.editingArea = null;\r\n\t\t\tthis.editorObject = null;\r\n\t\t},\r\n\r\n\t\tdestroy: function(){\r\n\t\t\tif(!this.isClosed){\r\n\t\t\t\tthis.close(false);\r\n\t\t\t}\r\n\t\t\tif(this._updateTimer){\r\n\t\t\t\tthis._updateTimer.remove();\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tif(RichText._globalSaveHandler){\r\n\t\t\t\tdelete RichText._globalSaveHandler[this.id];\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_removeMozBogus: function(/* String */ html){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tPost filter to remove unwanted HTML attributes generated by mozilla\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\treturn html.replace(/\\stype=\"_moz\"/gi, '').replace(/\\s_moz_dirty=\"\"/gi, '').replace(/_moz_resizing=\"(true|false)\"/gi, ''); // String\r\n\t\t},\r\n\t\t_removeWebkitBogus: function(/* String */ html){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tPost filter to remove unwanted HTML attributes generated by webkit\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\thtml = html.replace(/\\sclass=\"webkit-block-placeholder\"/gi, '');\r\n\t\t\thtml = html.replace(/\\sclass=\"apple-style-span\"/gi, '');\r\n\t\t\t// For some reason copy/paste sometime adds extra meta tags for charset on\r\n\t\t\t// webkit (chrome) on mac.They need to be removed.  See: #12007\"\r\n\t\t\thtml = html.replace(/<meta charset=\\\"utf-8\\\" \\/>/gi, '');\r\n\t\t\treturn html; // String\r\n\t\t},\r\n\t\t_normalizeFontStyle: function(/* String */ html){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tConvert 'strong' and 'em' to 'b' and 'i'.\r\n\t\t\t// description:\r\n\t\t\t//\t\tMoz can not handle strong/em tags correctly, so to help\r\n\t\t\t//\t\tmozilla and also to normalize output, convert them to 'b' and 'i'.\r\n\t\t\t//\r\n\t\t\t//\t\tNote the IE generates 'strong' and 'em' rather than 'b' and 'i'\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\treturn html.replace(/<(\\/)?strong([ \\>])/gi, '<$1b$2')\r\n\t\t\t\t.replace(/<(\\/)?em([ \\>])/gi, '<$1i$2'); // String\r\n\t\t},\r\n\r\n\t\t_preFixUrlAttributes: function(/* String */ html){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tPre-filter to do fixing to href attributes on `<a>` and `<img>` tags\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\treturn html.replace(/(?:(<a(?=\\s).*?\\shref=)(\"|')(.*?)\\2)|(?:(<a\\s.*?href=)([^\"'][^ >]+))/gi,\r\n\t\t\t\t'$1$4$2$3$5$2 _djrealurl=$2$3$5$2')\r\n\t\t\t\t.replace(/(?:(<img(?=\\s).*?\\ssrc=)(\"|')(.*?)\\2)|(?:(<img\\s.*?src=)([^\"'][^ >]+))/gi,\r\n\t\t\t\t'$1$4$2$3$5$2 _djrealurl=$2$3$5$2'); // String\r\n\t\t},\r\n\r\n\t\t/*****************************************************************************\r\n\t\t The following functions implement HTML manipulation commands for various\r\n\t\t browser/contentEditable implementations.  The goal of them is to enforce\r\n\t\t standard behaviors of them.\r\n\t\t ******************************************************************************/\r\n\r\n\t\t/*** queryCommandEnabled implementations ***/\r\n\r\n\t\t_browserQueryCommandEnabled: function(command){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tImplementation to call to the native queryCommandEnabled of the browser.\r\n\t\t\t// command:\r\n\t\t\t//\t\tThe command to check.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif(!command){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar elem = has(\"ie\") < 9 ? this.document.selection.createRange() : this.document;\r\n\t\t\ttry{\r\n\t\t\t\treturn elem.queryCommandEnabled(command);\r\n\t\t\t}catch(e){\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_createlinkEnabledImpl: function(/*===== argument =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the test for if the create link\r\n\t\t\t//\t\tcommand should be enabled or not.\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar enabled = true;\r\n\t\t\tif(has(\"opera\")){\r\n\t\t\t\tvar sel = this.window.getSelection();\r\n\t\t\t\tif(sel.isCollapsed){\r\n\t\t\t\t\tenabled = true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tenabled = this.document.queryCommandEnabled(\"createlink\");\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tenabled = this._browserQueryCommandEnabled(\"createlink\");\r\n\t\t\t}\r\n\t\t\treturn enabled;\r\n\t\t},\r\n\r\n\t\t_unlinkEnabledImpl: function(/*===== argument =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the test for if the unlink\r\n\t\t\t//\t\tcommand should be enabled or not.\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar enabled = true;\r\n\t\t\tif(has(\"mozilla\") || has(\"webkit\")){\r\n\t\t\t\tenabled = this.selection.hasAncestorElement(\"a\");\r\n\t\t\t}else{\r\n\t\t\t\tenabled = this._browserQueryCommandEnabled(\"unlink\");\r\n\t\t\t}\r\n\t\t\treturn enabled;\r\n\t\t},\r\n\r\n\t\t_inserttableEnabledImpl: function(/*===== argument =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the test for if the inserttable\r\n\t\t\t//\t\tcommand should be enabled or not.\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar enabled = true;\r\n\t\t\tif(has(\"mozilla\") || has(\"webkit\")){\r\n\t\t\t\tenabled = true;\r\n\t\t\t}else{\r\n\t\t\t\tenabled = this._browserQueryCommandEnabled(\"inserttable\");\r\n\t\t\t}\r\n\t\t\treturn enabled;\r\n\t\t},\r\n\r\n\t\t_cutEnabledImpl: function(/*===== argument =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the test for if the cut\r\n\t\t\t//\t\tcommand should be enabled or not.\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar enabled = true;\r\n\t\t\tif(has(\"webkit\")){\r\n\t\t\t\t// WebKit deems clipboard activity as a security threat and natively would return false\r\n\t\t\t\tvar sel = this.window.getSelection();\r\n\t\t\t\tif(sel){\r\n\t\t\t\t\tsel = sel.toString();\r\n\t\t\t\t}\r\n\t\t\t\tenabled = !!sel;\r\n\t\t\t}else{\r\n\t\t\t\tenabled = this._browserQueryCommandEnabled(\"cut\");\r\n\t\t\t}\r\n\t\t\treturn enabled;\r\n\t\t},\r\n\r\n\t\t_copyEnabledImpl: function(/*===== argument =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the test for if the copy\r\n\t\t\t//\t\tcommand should be enabled or not.\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar enabled = true;\r\n\t\t\tif(has(\"webkit\")){\r\n\t\t\t\t// WebKit deems clipboard activity as a security threat and natively would return false\r\n\t\t\t\tvar sel = this.window.getSelection();\r\n\t\t\t\tif(sel){\r\n\t\t\t\t\tsel = sel.toString();\r\n\t\t\t\t}\r\n\t\t\t\tenabled = !!sel;\r\n\t\t\t}else{\r\n\t\t\t\tenabled = this._browserQueryCommandEnabled(\"copy\");\r\n\t\t\t}\r\n\t\t\treturn enabled;\r\n\t\t},\r\n\r\n\t\t_pasteEnabledImpl: function(/*===== argument =====*/){\r\n\t\t\t// summary:c\r\n\t\t\t//\t\tThis function implements the test for if the paste\r\n\t\t\t//\t\tcommand should be enabled or not.\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar enabled = true;\r\n\t\t\tif(has(\"webkit\")){\r\n\t\t\t\treturn true;\r\n\t\t\t}else{\r\n\t\t\t\tenabled = this._browserQueryCommandEnabled(\"paste\");\r\n\t\t\t}\r\n\t\t\treturn enabled;\r\n\t\t},\r\n\r\n\t\t/*** execCommand implementations ***/\r\n\r\n\t\t_inserthorizontalruleImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the insertion of HTML 'HR' tags.\r\n\t\t\t//\t\tinto a point on the page.  IE doesn't to it right, so\r\n\t\t\t//\t\twe have to use an alternate form\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\treturn this._inserthtmlImpl(\"<hr>\");\r\n\t\t\t}\r\n\t\t\treturn this.document.execCommand(\"inserthorizontalrule\", false, argument);\r\n\t\t},\r\n\r\n\t\t_unlinkImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the unlink of an 'a' tag.\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif((this.queryCommandEnabled(\"unlink\")) && (has(\"mozilla\") || has(\"webkit\"))){\r\n\t\t\t\tvar a = this.selection.getAncestorElement(\"a\");\r\n\t\t\t\tthis.selection.selectElement(a);\r\n\t\t\t\treturn this.document.execCommand(\"unlink\", false, null);\r\n\t\t\t}\r\n\t\t\treturn this.document.execCommand(\"unlink\", false, argument);\r\n\t\t},\r\n\r\n\t\t_hilitecolorImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the hilitecolor command\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar returnValue;\r\n\t\t\tvar isApplied = this._handleTextColorOrProperties(\"hilitecolor\", argument);\r\n\t\t\tif(!isApplied){\r\n\t\t\t\tif(has(\"mozilla\")){\r\n\t\t\t\t\t// mozilla doesn't support hilitecolor properly when useCSS is\r\n\t\t\t\t\t// set to false (bugzilla #279330)\r\n\t\t\t\t\tthis.document.execCommand(\"styleWithCSS\", false, true);\r\n\t\t\t\t\tconsole.log(\"Executing color command.\");\r\n\t\t\t\t\treturnValue = this.document.execCommand(\"hilitecolor\", false, argument);\r\n\t\t\t\t\tthis.document.execCommand(\"styleWithCSS\", false, false);\r\n\t\t\t\t}else{\r\n\t\t\t\t\treturnValue = this.document.execCommand(\"hilitecolor\", false, argument);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn returnValue;\r\n\t\t},\r\n\r\n\t\t_backcolorImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the backcolor command\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\t// Tested under IE 6 XP2, no problem here, comment out\r\n\t\t\t\t// IE weirdly collapses ranges when we exec these commands, so prevent it\r\n\t\t\t\t//\tvar tr = this.document.selection.createRange();\r\n\t\t\t\targument = argument ? argument : null;\r\n\t\t\t}\r\n\t\t\tvar isApplied = this._handleTextColorOrProperties(\"backcolor\", argument);\r\n\t\t\tif(!isApplied){\r\n\t\t\t\tisApplied = this.document.execCommand(\"backcolor\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn isApplied;\r\n\t\t},\r\n\r\n\t\t_forecolorImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the forecolor command\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\t// Tested under IE 6 XP2, no problem here, comment out\r\n\t\t\t\t// IE weirdly collapses ranges when we exec these commands, so prevent it\r\n\t\t\t\t//\tvar tr = this.document.selection.createRange();\r\n\t\t\t\targument = argument ? argument : null;\r\n\t\t\t}\r\n\t\t\tvar isApplied = false;\r\n\t\t\tisApplied = this._handleTextColorOrProperties(\"forecolor\", argument);\r\n\t\t\tif(!isApplied){\r\n\t\t\t\tisApplied = this.document.execCommand(\"forecolor\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn isApplied;\r\n\t\t},\r\n\r\n\t\t_inserthtmlImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the insertion of HTML content into\r\n\t\t\t//\t\ta point on the page.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tThe content to insert, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\targument = this._preFilterContent(argument);\r\n\t\t\tvar rv = true;\r\n\t\t\tif(has(\"ie\") < 9){\r\n\t\t\t\tvar insertRange = this.document.selection.createRange();\r\n\t\t\t\tif(this.document.selection.type.toUpperCase() === 'CONTROL'){\r\n\t\t\t\t\tvar n = insertRange.item(0);\r\n\t\t\t\t\twhile(insertRange.length){\r\n\t\t\t\t\t\tinsertRange.remove(insertRange.item(0));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tn.outerHTML = argument;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tinsertRange.pasteHTML(argument);\r\n\t\t\t\t}\r\n\t\t\t\tinsertRange.select();\r\n\t\t\t}else if(has(\"trident\") < 8){\r\n\t\t\t\tvar insertRange;\r\n\t\t\t\tvar selection = rangeapi.getSelection(this.window);\r\n\t\t\t\tif(selection && selection.rangeCount && selection.getRangeAt){\r\n\t\t\t\t\tinsertRange = selection.getRangeAt(0);\r\n\t\t\t\t\tinsertRange.deleteContents();\r\n\r\n\t\t\t\t\tvar div = domConstruct.create('div');\r\n\t\t\t\t\tdiv.innerHTML = argument;\r\n\t\t\t\t\tvar node, lastNode;\r\n\t\t\t\t\tvar n = this.document.createDocumentFragment();\r\n\t\t\t\t\twhile((node = div.firstChild)){\r\n\t\t\t\t\t\tlastNode = n.appendChild(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinsertRange.insertNode(n);\r\n\t\t\t\t\tif(lastNode) {\r\n\t\t\t\t\t\tinsertRange = insertRange.cloneRange();\r\n\t\t\t\t\t\tinsertRange.setStartAfter(lastNode);\r\n\t\t\t\t\t\tinsertRange.collapse(false);\r\n\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\tselection.addRange(insertRange);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else if(has(\"mozilla\") && !argument.length){\r\n\t\t\t\t//mozilla can not inserthtml an empty html to delete current selection\r\n\t\t\t\t//so we delete the selection instead in this case\r\n\t\t\t\tthis.selection.remove(); // FIXME\r\n\t\t\t}else{\r\n\t\t\t\trv = this.document.execCommand(\"inserthtml\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn rv;\r\n\t\t},\r\n\r\n\t\t_boldImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements an over-ride of the bold command.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tNot used, operates by selection.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar applied = false;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tthis._adaptIESelection();\r\n\t\t\t\tapplied = this._adaptIEFormatAreaAndExec(\"bold\");\r\n\t\t\t}\r\n\t\t\tif(!applied){\r\n\t\t\t\tapplied = this.document.execCommand(\"bold\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn applied;\r\n\t\t},\r\n\r\n\t\t_italicImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements an over-ride of the italic command.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tNot used, operates by selection.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar applied = false;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tthis._adaptIESelection();\r\n\t\t\t\tapplied = this._adaptIEFormatAreaAndExec(\"italic\");\r\n\t\t\t}\r\n\t\t\tif(!applied){\r\n\t\t\t\tapplied = this.document.execCommand(\"italic\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn applied;\r\n\t\t},\r\n\r\n\t\t_underlineImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements an over-ride of the underline command.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tNot used, operates by selection.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar applied = false;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tthis._adaptIESelection();\r\n\t\t\t\tapplied = this._adaptIEFormatAreaAndExec(\"underline\");\r\n\t\t\t}\r\n\t\t\tif(!applied){\r\n\t\t\t\tapplied = this.document.execCommand(\"underline\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn applied;\r\n\t\t},\r\n\r\n\t\t_strikethroughImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements an over-ride of the strikethrough command.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tNot used, operates by selection.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar applied = false;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tthis._adaptIESelection();\r\n\t\t\t\tapplied = this._adaptIEFormatAreaAndExec(\"strikethrough\");\r\n\t\t\t}\r\n\t\t\tif(!applied){\r\n\t\t\t\tapplied = this.document.execCommand(\"strikethrough\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn applied;\r\n\t\t},\r\n\r\n\t\t_superscriptImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements an over-ride of the superscript command.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tNot used, operates by selection.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar applied = false;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tthis._adaptIESelection();\r\n\t\t\t\tapplied = this._adaptIEFormatAreaAndExec(\"superscript\");\r\n\t\t\t}\r\n\t\t\tif(!applied){\r\n\t\t\t\tapplied = this.document.execCommand(\"superscript\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn applied;\r\n\t\t},\r\n\r\n\t\t_subscriptImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements an over-ride of the superscript command.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tNot used, operates by selection.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar applied = false;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tthis._adaptIESelection();\r\n\t\t\t\tapplied = this._adaptIEFormatAreaAndExec(\"subscript\");\r\n\r\n\t\t\t}\r\n\t\t\tif(!applied){\r\n\t\t\t\tapplied = this.document.execCommand(\"subscript\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn applied;\r\n\t\t},\r\n\r\n\t\t_fontnameImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the fontname command\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar isApplied;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tisApplied = this._handleTextColorOrProperties(\"fontname\", argument);\r\n\t\t\t}\r\n\t\t\tif(!isApplied){\r\n\t\t\t\tisApplied = this.document.execCommand(\"fontname\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn isApplied;\r\n\t\t},\r\n\r\n\t\t_fontsizeImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the fontsize command\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar isApplied;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tisApplied = this._handleTextColorOrProperties(\"fontsize\", argument);\r\n\t\t\t}\r\n\t\t\tif(!isApplied){\r\n\t\t\t\tisApplied = this.document.execCommand(\"fontsize\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn isApplied;\r\n\t\t},\r\n\r\n\t\t_insertorderedlistImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the insertorderedlist command\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar applied = false;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tapplied = this._adaptIEList(\"insertorderedlist\", argument);\r\n\t\t\t}\r\n\t\t\tif(!applied){\r\n\t\t\t\tapplied = this.document.execCommand(\"insertorderedlist\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn applied;\r\n\t\t},\r\n\r\n\t\t_insertunorderedlistImpl: function(argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function implements the insertunorderedlist command\r\n\t\t\t// argument:\r\n\t\t\t//\t\targuments to the exec command, if any.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar applied = false;\r\n\t\t\tif(has(\"ie\") || has(\"trident\")){\r\n\t\t\t\tapplied = this._adaptIEList(\"insertunorderedlist\", argument);\r\n\t\t\t}\r\n\t\t\tif(!applied){\r\n\t\t\t\tapplied = this.document.execCommand(\"insertunorderedlist\", false, argument);\r\n\t\t\t}\r\n\t\t\treturn applied;\r\n\t\t},\r\n\r\n\t\tgetHeaderHeight: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA function for obtaining the height of the header node\r\n\t\t\treturn this._getNodeChildrenHeight(this.header); // Number\r\n\t\t},\r\n\r\n\t\tgetFooterHeight: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA function for obtaining the height of the footer node\r\n\t\t\treturn this._getNodeChildrenHeight(this.footer); // Number\r\n\t\t},\r\n\r\n\t\t_getNodeChildrenHeight: function(node){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tAn internal function for computing the cumulative height of all child nodes of 'node'\r\n\t\t\t// node:\r\n\t\t\t//\t\tThe node to process the children of;\r\n\t\t\tvar h = 0;\r\n\t\t\tif(node && node.childNodes){\r\n\t\t\t\t// IE didn't compute it right when position was obtained on the node directly is some cases,\r\n\t\t\t\t// so we have to walk over all the children manually.\r\n\t\t\t\tvar i;\r\n\t\t\t\tfor(i = 0; i < node.childNodes.length; i++){\r\n\t\t\t\t\tvar size = domGeometry.position(node.childNodes[i]);\r\n\t\t\t\t\th += size.h;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn h; // Number\r\n\t\t},\r\n\r\n\t\t_isNodeEmpty: function(node, startOffset){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to test if a node is devoid of real content.\r\n\t\t\t// node:\r\n\t\t\t//\t\tThe node to check.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate.\r\n\t\t\tif(node.nodeType === 1/*element*/){\r\n\t\t\t\tif(node.childNodes.length > 0){\r\n\t\t\t\t\treturn this._isNodeEmpty(node.childNodes[0], startOffset);\t// huh?   why test just first child?\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}else if(node.nodeType === 3/*text*/){\r\n\t\t\t\treturn (node.nodeValue.substring(startOffset) === \"\");\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t_removeStartingRangeFromRange: function(node, range){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to adjust selection range by removing the current\r\n\t\t\t//\t\tstart node.\r\n\t\t\t// node:\r\n\t\t\t//\t\tThe node to remove from the starting range.\r\n\t\t\t// range:\r\n\t\t\t//\t\tThe range to adapt.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(node.nextSibling){\r\n\t\t\t\trange.setStart(node.nextSibling, 0);\r\n\t\t\t}else{\r\n\t\t\t\tvar parent = node.parentNode;\r\n\t\t\t\twhile(parent && parent.nextSibling == null){\r\n\t\t\t\t\t//move up the tree until we find a parent that has another node, that node will be the next node\r\n\t\t\t\t\tparent = parent.parentNode;\r\n\t\t\t\t}\r\n\t\t\t\tif(parent){\r\n\t\t\t\t\trange.setStart(parent.nextSibling, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn range;\r\n\t\t},\r\n\r\n\t\t_adaptIESelection: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to adapt the IE range by removing leading 'newlines'\r\n\t\t\t//\t\tNeeded to fix issue with bold/italics/underline not working if\r\n\t\t\t//\t\trange included leading 'newlines'.\r\n\t\t\t//\t\tIn IE, if a user starts a selection at the very end of a line,\r\n\t\t\t//\t\tthen the native browser commands will fail to execute correctly.\r\n\t\t\t//\t\tTo work around the issue,  we can remove all empty nodes from\r\n\t\t\t//\t\tthe start of the range selection.\r\n\t\t\tvar selection = rangeapi.getSelection(this.window);\r\n\t\t\tif(selection && selection.rangeCount && !selection.isCollapsed){\r\n\t\t\t\tvar range = selection.getRangeAt(0);\r\n\t\t\t\tvar firstNode = range.startContainer;\r\n\t\t\t\tvar startOffset = range.startOffset;\r\n\r\n\t\t\t\twhile(firstNode.nodeType === 3/*text*/ && startOffset >= firstNode.length && firstNode.nextSibling){\r\n\t\t\t\t\t//traverse the text nodes until we get to the one that is actually highlighted\r\n\t\t\t\t\tstartOffset = startOffset - firstNode.length;\r\n\t\t\t\t\tfirstNode = firstNode.nextSibling;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//Remove the starting ranges until the range does not start with an empty node.\r\n\t\t\t\tvar lastNode = null;\r\n\t\t\t\twhile(this._isNodeEmpty(firstNode, startOffset) && firstNode !== lastNode){\r\n\t\t\t\t\tlastNode = firstNode; //this will break the loop in case we can't find the next sibling\r\n\t\t\t\t\trange = this._removeStartingRangeFromRange(firstNode, range); //move the start container to the next node in the range\r\n\t\t\t\t\tfirstNode = range.startContainer;\r\n\t\t\t\t\tstartOffset = 0; //start at the beginning of the new starting range\r\n\t\t\t\t}\r\n\t\t\t\tselection.removeAllRanges();// this will work as long as users cannot select multiple ranges. I have not been able to do that in the editor.\r\n\t\t\t\tselection.addRange(range);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_adaptIEFormatAreaAndExec: function(command){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to handle IE's quirkiness regarding how it handles\r\n\t\t\t//\t\tformat commands on a word.  This involves a lit of node splitting\r\n\t\t\t//\t\tand format cloning.\r\n\t\t\t// command:\r\n\t\t\t//\t\tThe format command, needed to check if the desired\r\n\t\t\t//\t\tcommand is true or not.\r\n\t\t\tvar selection = rangeapi.getSelection(this.window);\r\n\t\t\tvar doc = this.document;\r\n\t\t\tvar rs, ret, range, txt, startNode, endNode, breaker, sNode;\r\n\t\t\tif(command && selection && selection.isCollapsed){\r\n\t\t\t\tvar isApplied = this.queryCommandValue(command);\r\n\t\t\t\tif(isApplied){\r\n\r\n\t\t\t\t\t// We have to split backwards until we hit the format\r\n\t\t\t\t\tvar nNames = this._tagNamesForCommand(command);\r\n\t\t\t\t\trange = selection.getRangeAt(0);\r\n\t\t\t\t\tvar fs = range.startContainer;\r\n\t\t\t\t\tif(fs.nodeType === 3){\r\n\t\t\t\t\t\tvar offset = range.endOffset;\r\n\t\t\t\t\t\tif(fs.length < offset){\r\n\t\t\t\t\t\t\t//We are not looking from the right node, try to locate the correct one\r\n\t\t\t\t\t\t\tret = this._adjustNodeAndOffset(rs, offset);\r\n\t\t\t\t\t\t\tfs = ret.node;\r\n\t\t\t\t\t\t\toffset = ret.offset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar topNode;\r\n\t\t\t\t\twhile(fs && fs !== this.editNode){\r\n\t\t\t\t\t\t// We have to walk back and see if this is still a format or not.\r\n\t\t\t\t\t\t// Hm, how do I do this?\r\n\t\t\t\t\t\tvar tName = fs.tagName ? fs.tagName.toLowerCase() : \"\";\r\n\t\t\t\t\t\tif(array.indexOf(nNames, tName) > -1){\r\n\t\t\t\t\t\t\ttopNode = fs;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfs = fs.parentNode;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Okay, we have a stopping place, time to split things apart.\r\n\t\t\t\t\tif(topNode){\r\n\t\t\t\t\t\t// Okay, we know how far we have to split backwards, so we have to split now.\r\n\t\t\t\t\t\trs = range.startContainer;\r\n\t\t\t\t\t\tvar newblock = doc.createElement(topNode.tagName);\r\n\t\t\t\t\t\tdomConstruct.place(newblock, topNode, \"after\");\r\n\t\t\t\t\t\tif(rs && rs.nodeType === 3){\r\n\t\t\t\t\t\t\t// Text node, we have to split it.\r\n\t\t\t\t\t\t\tvar nodeToMove, tNode;\r\n\t\t\t\t\t\t\tvar endOffset = range.endOffset;\r\n\t\t\t\t\t\t\tif(rs.length < endOffset){\r\n\t\t\t\t\t\t\t\t//We are not splitting the right node, try to locate the correct one\r\n\t\t\t\t\t\t\t\tret = this._adjustNodeAndOffset(rs, endOffset);\r\n\t\t\t\t\t\t\t\trs = ret.node;\r\n\t\t\t\t\t\t\t\tendOffset = ret.offset;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\ttxt = rs.nodeValue;\r\n\t\t\t\t\t\t\tstartNode = doc.createTextNode(txt.substring(0, endOffset));\r\n\t\t\t\t\t\t\tvar endText = txt.substring(endOffset, txt.length);\r\n\t\t\t\t\t\t\tif(endText){\r\n\t\t\t\t\t\t\t\tendNode = doc.createTextNode(endText);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// Place the split, then remove original nodes.\r\n\t\t\t\t\t\t\tdomConstruct.place(startNode, rs, \"before\");\r\n\t\t\t\t\t\t\tif(endNode){\r\n\t\t\t\t\t\t\t\tbreaker = doc.createElement(\"span\");\r\n\t\t\t\t\t\t\t\tbreaker.className = \"ieFormatBreakerSpan\";\r\n\t\t\t\t\t\t\t\tdomConstruct.place(breaker, rs, \"after\");\r\n\t\t\t\t\t\t\t\tdomConstruct.place(endNode, breaker, \"after\");\r\n\t\t\t\t\t\t\t\tendNode = breaker;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdomConstruct.destroy(rs);\r\n\r\n\t\t\t\t\t\t\t// Okay, we split the text.  Now we need to see if we're\r\n\t\t\t\t\t\t\t// parented to the block element we're splitting and if\r\n\t\t\t\t\t\t\t// not, we have to split all the way up.  Ugh.\r\n\t\t\t\t\t\t\tvar parentC = startNode.parentNode;\r\n\t\t\t\t\t\t\tvar tagList = [];\r\n\t\t\t\t\t\t\tvar tagData;\r\n\t\t\t\t\t\t\twhile(parentC !== topNode){\r\n\t\t\t\t\t\t\t\tvar tg = parentC.tagName;\r\n\t\t\t\t\t\t\t\ttagData = {tagName: tg};\r\n\t\t\t\t\t\t\t\ttagList.push(tagData);\r\n\r\n\t\t\t\t\t\t\t\tvar newTg = doc.createElement(tg);\r\n\t\t\t\t\t\t\t\t// Clone over any 'style' data.\r\n\t\t\t\t\t\t\t\tif(parentC.style){\r\n\t\t\t\t\t\t\t\t\tif(newTg.style){\r\n\t\t\t\t\t\t\t\t\t\tif(parentC.style.cssText){\r\n\t\t\t\t\t\t\t\t\t\t\tnewTg.style.cssText = parentC.style.cssText;\r\n\t\t\t\t\t\t\t\t\t\t\ttagData.cssText = parentC.style.cssText;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t// If font also need to clone over any font data.\r\n\t\t\t\t\t\t\t\tif(parentC.tagName === \"FONT\"){\r\n\t\t\t\t\t\t\t\t\tif(parentC.color){\r\n\t\t\t\t\t\t\t\t\t\tnewTg.color = parentC.color;\r\n\t\t\t\t\t\t\t\t\t\ttagData.color = parentC.color;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif(parentC.face){\r\n\t\t\t\t\t\t\t\t\t\tnewTg.face = parentC.face;\r\n\t\t\t\t\t\t\t\t\t\ttagData.face = parentC.face;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif(parentC.size){  // this check was necessary on IE\r\n\t\t\t\t\t\t\t\t\t\tnewTg.size = parentC.size;\r\n\t\t\t\t\t\t\t\t\t\ttagData.size = parentC.size;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(parentC.className){\r\n\t\t\t\t\t\t\t\t\tnewTg.className = parentC.className;\r\n\t\t\t\t\t\t\t\t\ttagData.className = parentC.className;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Now move end node and every sibling\r\n\t\t\t\t\t\t\t\t// after it over into the new tag.\r\n\t\t\t\t\t\t\t\tif(endNode){\r\n\t\t\t\t\t\t\t\t\tnodeToMove = endNode;\r\n\t\t\t\t\t\t\t\t\twhile(nodeToMove){\r\n\t\t\t\t\t\t\t\t\t\ttNode = nodeToMove.nextSibling;\r\n\t\t\t\t\t\t\t\t\t\tnewTg.appendChild(nodeToMove);\r\n\t\t\t\t\t\t\t\t\t\tnodeToMove = tNode;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(newTg.tagName == parentC.tagName){\r\n\t\t\t\t\t\t\t\t\tbreaker = doc.createElement(\"span\");\r\n\t\t\t\t\t\t\t\t\tbreaker.className = \"ieFormatBreakerSpan\";\r\n\t\t\t\t\t\t\t\t\tdomConstruct.place(breaker, parentC, \"after\");\r\n\t\t\t\t\t\t\t\t\tdomConstruct.place(newTg, breaker, \"after\");\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tdomConstruct.place(newTg, parentC, \"after\");\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tstartNode = parentC;\r\n\t\t\t\t\t\t\t\tendNode = newTg;\r\n\t\t\t\t\t\t\t\tparentC = parentC.parentNode;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Lastly, move the split out all the split tags\r\n\t\t\t\t\t\t\t// to the new block as they should now be split properly.\r\n\t\t\t\t\t\t\tif(endNode){\r\n\t\t\t\t\t\t\t\tnodeToMove = endNode;\r\n\t\t\t\t\t\t\t\tif(nodeToMove.nodeType === 1 || (nodeToMove.nodeType === 3 && nodeToMove.nodeValue)){\r\n\t\t\t\t\t\t\t\t\t// Non-blank text and non-text nodes need to clear out that blank space\r\n\t\t\t\t\t\t\t\t\t// before moving the contents.\r\n\t\t\t\t\t\t\t\t\tnewblock.innerHTML = \"\";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\twhile(nodeToMove){\r\n\t\t\t\t\t\t\t\t\ttNode = nodeToMove.nextSibling;\r\n\t\t\t\t\t\t\t\t\tnewblock.appendChild(nodeToMove);\r\n\t\t\t\t\t\t\t\t\tnodeToMove = tNode;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// We had intermediate tags, we have to now recreate them inbetween the split\r\n\t\t\t\t\t\t\t// and restore what styles, classnames, etc, we can.\r\n\t\t\t\t\t\t\tvar newrange;\r\n\t\t\t\t\t\t\tif(tagList.length){\r\n\t\t\t\t\t\t\t\ttagData = tagList.pop();\r\n\t\t\t\t\t\t\t\tvar newContTag = doc.createElement(tagData.tagName);\r\n\t\t\t\t\t\t\t\tif(tagData.cssText && newContTag.style){\r\n\t\t\t\t\t\t\t\t\tnewContTag.style.cssText = tagData.cssText;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(tagData.className){\r\n\t\t\t\t\t\t\t\t\tnewContTag.className = tagData.className;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif(tagData.tagName === \"FONT\"){\r\n\t\t\t\t\t\t\t\t\tif(tagData.color){\r\n\t\t\t\t\t\t\t\t\t\tnewContTag.color = tagData.color;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif(tagData.face){\r\n\t\t\t\t\t\t\t\t\t\tnewContTag.face = tagData.face;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif(tagData.size){\r\n\t\t\t\t\t\t\t\t\t\tnewContTag.size = tagData.size;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tdomConstruct.place(newContTag, newblock, \"before\");\r\n\t\t\t\t\t\t\t\twhile(tagList.length){\r\n\t\t\t\t\t\t\t\t\ttagData = tagList.pop();\r\n\t\t\t\t\t\t\t\t\tvar newTgNode = doc.createElement(tagData.tagName);\r\n\t\t\t\t\t\t\t\t\tif(tagData.cssText && newTgNode.style){\r\n\t\t\t\t\t\t\t\t\t\tnewTgNode.style.cssText = tagData.cssText;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif(tagData.className){\r\n\t\t\t\t\t\t\t\t\t\tnewTgNode.className = tagData.className;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif(tagData.tagName === \"FONT\"){\r\n\t\t\t\t\t\t\t\t\t\tif(tagData.color){\r\n\t\t\t\t\t\t\t\t\t\t\tnewTgNode.color = tagData.color;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tif(tagData.face){\r\n\t\t\t\t\t\t\t\t\t\t\tnewTgNode.face = tagData.face;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tif(tagData.size){\r\n\t\t\t\t\t\t\t\t\t\t\tnewTgNode.size = tagData.size;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tnewContTag.appendChild(newTgNode);\r\n\t\t\t\t\t\t\t\t\tnewContTag = newTgNode;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Okay, everything is theoretically split apart and removed from the content\r\n\t\t\t\t\t\t\t\t// so insert the dummy text to select, select it, then\r\n\t\t\t\t\t\t\t\t// clear to position cursor.\r\n\t\t\t\t\t\t\t\tsNode = doc.createTextNode(\".\");\r\n\t\t\t\t\t\t\t\tbreaker.appendChild(sNode);\r\n\t\t\t\t\t\t\t\tnewContTag.appendChild(sNode);\r\n\t\t\t\t\t\t\t\tnewrange = rangeapi.create(this.window);\r\n\t\t\t\t\t\t\t\tnewrange.setStart(sNode, 0);\r\n\t\t\t\t\t\t\t\tnewrange.setEnd(sNode, sNode.length);\r\n\t\t\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\t\t\tselection.addRange(newrange);\r\n\t\t\t\t\t\t\t\tthis.selection.collapse(false);\r\n\t\t\t\t\t\t\t\tsNode.parentNode.innerHTML = \"\";\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t// No extra tags, so we have to insert a breaker point and rely\r\n\t\t\t\t\t\t\t\t// on filters to remove it later.\r\n\t\t\t\t\t\t\t\tbreaker = doc.createElement(\"span\");\r\n\t\t\t\t\t\t\t\tbreaker.className = \"ieFormatBreakerSpan\";\r\n\t\t\t\t\t\t\t\tsNode = doc.createTextNode(\".\");\r\n\t\t\t\t\t\t\t\tbreaker.appendChild(sNode);\r\n\t\t\t\t\t\t\t\tdomConstruct.place(breaker, newblock, \"before\");\r\n\t\t\t\t\t\t\t\tnewrange = rangeapi.create(this.window);\r\n\t\t\t\t\t\t\t\tnewrange.setStart(sNode, 0);\r\n\t\t\t\t\t\t\t\tnewrange.setEnd(sNode, sNode.length);\r\n\t\t\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\t\t\tselection.addRange(newrange);\r\n\t\t\t\t\t\t\t\tthis.selection.collapse(false);\r\n\t\t\t\t\t\t\t\tsNode.parentNode.innerHTML = \"\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(!newblock.firstChild){\r\n\t\t\t\t\t\t\t\t// Empty, we don't need it.  Split was at end or similar\r\n\t\t\t\t\t\t\t\t// So, remove it.\r\n\t\t\t\t\t\t\t\tdomConstruct.destroy(newblock);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}else{\r\n\t\t\t\t\trange = selection.getRangeAt(0);\r\n\t\t\t\t\trs = range.startContainer;\r\n\t\t\t\t\tif(rs && rs.nodeType === 3){\r\n\t\t\t\t\t\t// Text node, we have to split it.\r\n\t\t\t\t\t\tvar offset = range.startOffset;\r\n\t\t\t\t\t\tif(rs.length < offset){\r\n\t\t\t\t\t\t\t//We are not splitting the right node, try to locate the correct one\r\n\t\t\t\t\t\t\tret = this._adjustNodeAndOffset(rs, offset);\r\n\t\t\t\t\t\t\trs = ret.node;\r\n\t\t\t\t\t\t\toffset = ret.offset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttxt = rs.nodeValue;\r\n\t\t\t\t\t\tstartNode = doc.createTextNode(txt.substring(0, offset));\r\n\t\t\t\t\t\tvar endText = txt.substring(offset);\r\n\t\t\t\t\t\tif(endText !== \"\"){\r\n\t\t\t\t\t\t\tendNode = doc.createTextNode(txt.substring(offset));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Create a space, we'll select and bold it, so\r\n\t\t\t\t\t\t// the whole word doesn't get bolded\r\n\t\t\t\t\t\tbreaker = doc.createElement(\"span\");\r\n\t\t\t\t\t\tsNode = doc.createTextNode(\".\");\r\n\t\t\t\t\t\tbreaker.appendChild(sNode);\r\n\t\t\t\t\t\tif(startNode.length){\r\n\t\t\t\t\t\t\tdomConstruct.place(startNode, rs, \"after\");\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tstartNode = rs;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdomConstruct.place(breaker, startNode, \"after\");\r\n\t\t\t\t\t\tif(endNode){\r\n\t\t\t\t\t\t\tdomConstruct.place(endNode, breaker, \"after\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdomConstruct.destroy(rs);\r\n\t\t\t\t\t\tvar newrange = rangeapi.create(this.window);\r\n\t\t\t\t\t\tnewrange.setStart(sNode, 0);\r\n\t\t\t\t\t\tnewrange.setEnd(sNode, sNode.length);\r\n\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\tselection.addRange(newrange);\r\n\t\t\t\t\t\tdoc.execCommand(command);\r\n\t\t\t\t\t\tdomConstruct.place(breaker.firstChild, breaker, \"before\");\r\n\t\t\t\t\t\tdomConstruct.destroy(breaker);\r\n\t\t\t\t\t\tnewrange.setStart(sNode, 0);\r\n\t\t\t\t\t\tnewrange.setEnd(sNode, sNode.length);\r\n\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\tselection.addRange(newrange);\r\n\t\t\t\t\t\tthis.selection.collapse(false);\r\n\t\t\t\t\t\tsNode.parentNode.innerHTML = \"\";\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_adaptIEList: function(command /*===== , argument =====*/){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function handles normalizing the IE list behavior as\r\n\t\t\t//\t\tmuch as possible.\r\n\t\t\t// command:\r\n\t\t\t//\t\tThe list command to execute.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tAny additional argument.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar selection = rangeapi.getSelection(this.window);\r\n\t\t\tif(selection.isCollapsed){\r\n\t\t\t\t// In the case of no selection, lets commonize the behavior and\r\n\t\t\t\t// make sure that it indents if needed.\r\n\t\t\t\tif(selection.rangeCount && !this.queryCommandValue(command)){\r\n\t\t\t\t\tvar range = selection.getRangeAt(0);\r\n\t\t\t\t\tvar sc = range.startContainer;\r\n\t\t\t\t\tif(sc && sc.nodeType == 3){\r\n\t\t\t\t\t\t// text node.  Lets see if there is a node before it that isn't\r\n\t\t\t\t\t\t// some sort of breaker.\r\n\t\t\t\t\t\tif(!range.startOffset){\r\n\t\t\t\t\t\t\t// We're at the beginning of a text area.  It may have been br split\r\n\t\t\t\t\t\t\t// Who knows?  In any event, we must create the list manually\r\n\t\t\t\t\t\t\t// or IE may shove too much into the list element.  It seems to\r\n\t\t\t\t\t\t\t// grab content before the text node too if it's br split.\r\n\t\t\t\t\t\t\t// Why can't IE work like everyone else?\r\n\r\n\t\t\t\t\t\t\t// Create a space, we'll select and bold it, so\r\n\t\t\t\t\t\t\t// the whole word doesn't get bolded\r\n\t\t\t\t\t\t\tvar lType = \"ul\";\r\n\t\t\t\t\t\t\tif(command === \"insertorderedlist\"){\r\n\t\t\t\t\t\t\t\tlType = \"ol\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar list = this.document.createElement(lType);\r\n\t\t\t\t\t\t\tvar li = domConstruct.create(\"li\", null, list);\r\n\t\t\t\t\t\t\tdomConstruct.place(list, sc, \"before\");\r\n\t\t\t\t\t\t\t// Move in the text node as part of the li.\r\n\t\t\t\t\t\t\tli.appendChild(sc);\r\n\t\t\t\t\t\t\t// We need a br after it or the enter key handler\r\n\t\t\t\t\t\t\t// sometimes throws errors.\r\n\t\t\t\t\t\t\tdomConstruct.create(\"br\", null, list, \"after\");\r\n\t\t\t\t\t\t\t// Okay, now lets move our cursor to the beginning.\r\n\t\t\t\t\t\t\tvar newrange = rangeapi.create(this.window);\r\n\t\t\t\t\t\t\tnewrange.setStart(sc, 0);\r\n\t\t\t\t\t\t\tnewrange.setEnd(sc, sc.length);\r\n\t\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\t\tselection.addRange(newrange);\r\n\t\t\t\t\t\t\tthis.selection.collapse(true);\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t_handleTextColorOrProperties: function(command, argument){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function handles applying text color as best it is\r\n\t\t\t//\t\table to do so when the selection is collapsed, making the\r\n\t\t\t//\t\tbehavior cross-browser consistent. It also handles the name\r\n\t\t\t//\t\tand size for IE.\r\n\t\t\t// command:\r\n\t\t\t//\t\tThe command.\r\n\t\t\t// argument:\r\n\t\t\t//\t\tAny additional arguments.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar selection = rangeapi.getSelection(this.window);\r\n\t\t\tvar doc = this.document;\r\n\t\t\tvar rs, ret, range, txt, startNode, endNode, breaker, sNode;\r\n\t\t\targument = argument || null;\r\n\t\t\tif(command && selection && selection.isCollapsed){\r\n\t\t\t\tif(selection.rangeCount){\r\n\t\t\t\t\trange = selection.getRangeAt(0);\r\n\t\t\t\t\trs = range.startContainer;\r\n\t\t\t\t\tif(rs && rs.nodeType === 3){\r\n\t\t\t\t\t\t// Text node, we have to split it.\r\n\t\t\t\t\t\tvar offset = range.startOffset;\r\n\t\t\t\t\t\tif(rs.length < offset){\r\n\t\t\t\t\t\t\t//We are not splitting the right node, try to locate the correct one\r\n\t\t\t\t\t\t\tret = this._adjustNodeAndOffset(rs, offset);\r\n\t\t\t\t\t\t\trs = ret.node;\r\n\t\t\t\t\t\t\toffset = ret.offset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttxt = rs.nodeValue;\r\n\t\t\t\t\t\tstartNode = doc.createTextNode(txt.substring(0, offset));\r\n\t\t\t\t\t\tvar endText = txt.substring(offset);\r\n\t\t\t\t\t\tif(endText !== \"\"){\r\n\t\t\t\t\t\t\tendNode = doc.createTextNode(txt.substring(offset));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Create a space, we'll select and bold it, so\r\n\t\t\t\t\t\t// the whole word doesn't get bolded\r\n\t\t\t\t\t\tbreaker = doc.createElement(\"span\");\r\n\t\t\t\t\t\tsNode = doc.createTextNode(\".\");\r\n\t\t\t\t\t\tbreaker.appendChild(sNode);\r\n\t\t\t\t\t\t// Create a junk node to avoid it trying to style the breaker.\r\n\t\t\t\t\t\t// This will get destroyed later.\r\n\t\t\t\t\t\tvar extraSpan = doc.createElement(\"span\");\r\n\t\t\t\t\t\tbreaker.appendChild(extraSpan);\r\n\t\t\t\t\t\tif(startNode.length){\r\n\t\t\t\t\t\t\tdomConstruct.place(startNode, rs, \"after\");\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tstartNode = rs;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdomConstruct.place(breaker, startNode, \"after\");\r\n\t\t\t\t\t\tif(endNode){\r\n\t\t\t\t\t\t\tdomConstruct.place(endNode, breaker, \"after\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdomConstruct.destroy(rs);\r\n\t\t\t\t\t\tvar newrange = rangeapi.create(this.window);\r\n\t\t\t\t\t\tnewrange.setStart(sNode, 0);\r\n\t\t\t\t\t\tnewrange.setEnd(sNode, sNode.length);\r\n\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\tselection.addRange(newrange);\r\n\t\t\t\t\t\tif(has(\"webkit\")){\r\n\t\t\t\t\t\t\t// WebKit is frustrating with positioning the cursor.\r\n\t\t\t\t\t\t\t// It stinks to have a selected space, but there really\r\n\t\t\t\t\t\t\t// isn't much choice here.\r\n\t\t\t\t\t\t\tvar style = \"color\";\r\n\t\t\t\t\t\t\tif(command === \"hilitecolor\" || command === \"backcolor\"){\r\n\t\t\t\t\t\t\t\tstyle = \"backgroundColor\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdomStyle.set(breaker, style, argument);\r\n\t\t\t\t\t\t\tthis.selection.remove();\r\n\t\t\t\t\t\t\tdomConstruct.destroy(extraSpan);\r\n\t\t\t\t\t\t\tbreaker.innerHTML = \"&#160;\";\t// &nbsp;\r\n\t\t\t\t\t\t\tthis.selection.selectElement(breaker);\r\n\t\t\t\t\t\t\tthis.focus();\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tthis.execCommand(command, argument);\r\n\t\t\t\t\t\t\tdomConstruct.place(breaker.firstChild, breaker, \"before\");\r\n\t\t\t\t\t\t\tdomConstruct.destroy(breaker);\r\n\t\t\t\t\t\t\tnewrange.setStart(sNode, 0);\r\n\t\t\t\t\t\t\tnewrange.setEnd(sNode, sNode.length);\r\n\t\t\t\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\t\t\t\tselection.addRange(newrange);\r\n\t\t\t\t\t\t\tthis.selection.collapse(false);\r\n\t\t\t\t\t\t\tsNode.parentNode.removeChild(sNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\r\n\t\t_adjustNodeAndOffset: function(/*DomNode*/node, /*Int*/offset){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tIn the case there are multiple text nodes in a row the offset may not be within the node.\r\n\t\t\t//\t\tIf the offset is larger than the node length, it will attempt to find\r\n\t\t\t//\t\tthe next text sibling until it locates the text node in which the offset refers to\r\n\t\t\t// node:\r\n\t\t\t//\t\tThe node to check.\r\n\t\t\t// offset:\r\n\t\t\t//\t\tThe position to find within the text node\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate.\r\n\t\t\twhile(node.length < offset && node.nextSibling && node.nextSibling.nodeType === 3){\r\n\t\t\t\t//Adjust the offset and node in the case of multiple text nodes in a row\r\n\t\t\t\toffset = offset - node.length;\r\n\t\t\t\tnode = node.nextSibling;\r\n\t\t\t}\r\n\t\t\treturn {\"node\": node, \"offset\": offset};\r\n\t\t},\r\n\r\n\t\t_tagNamesForCommand: function(command){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to return the tab names that are associated\r\n\t\t\t//\t\twith a particular style.\r\n\t\t\t// command: String\r\n\t\t\t//\t\tThe command to return tags for.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(command === \"bold\"){\r\n\t\t\t\treturn [\"b\", \"strong\"];\r\n\t\t\t}else if(command === \"italic\"){\r\n\t\t\t\treturn [\"i\", \"em\"];\r\n\t\t\t}else if(command === \"strikethrough\"){\r\n\t\t\t\treturn [\"s\", \"strike\"];\r\n\t\t\t}else if(command === \"superscript\"){\r\n\t\t\t\treturn [\"sup\"];\r\n\t\t\t}else if(command === \"subscript\"){\r\n\t\t\t\treturn [\"sub\"];\r\n\t\t\t}else if(command === \"underline\"){\r\n\t\t\t\treturn [\"u\"];\r\n\t\t\t}\r\n\t\t\treturn [];\r\n\t\t},\r\n\r\n\t\t_stripBreakerNodes: function(/*DOMNode*/ node){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction for stripping out the breaker spans inserted by the formatting command.\r\n\t\t\t//\t\tRegistered as a filter for IE, handles the breaker spans needed to fix up\r\n\t\t\t//\t\tHow bold/italic/etc, work when selection is collapsed (single cursor).\r\n\t\t\tif(!this.isLoaded){\r\n\t\t\t\treturn;\r\n\t\t\t} // this method requires init to be complete\r\n\t\t\tquery(\".ieFormatBreakerSpan\", node).forEach(function(b){\r\n\t\t\t\twhile(b.firstChild){\r\n\t\t\t\t\tdomConstruct.place(b.firstChild, b, \"before\");\r\n\t\t\t\t}\r\n\t\t\t\tdomConstruct.destroy(b);\r\n\t\t\t});\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\t_stripTrailingEmptyNodes: function(/*DOMNode*/ node){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction for stripping trailing nodes without any text, excluding trailing nodes\r\n\t\t\t//\t\tlike <img> or <div><img></div>, even though they don't have text either.\r\n\r\n\t\t\tfunction isEmpty(node){\r\n\t\t\t\t// If not for old IE we could check for Element children by node.firstElementChild\r\n\t\t\t\treturn (/^(p|div|br)$/i.test(node.nodeName) && node.children.length == 0 &&\r\n\t\t\t\t\t/^[\\s\\xA0]*$/.test(node.textContent || node.innerText || \"\")) ||\r\n\t\t\t\t\t(node.nodeType === 3/*text*/ && /^[\\s\\xA0]*$/.test(node.nodeValue));\r\n\t\t\t}\r\n\t\t\twhile(node.lastChild && isEmpty(node.lastChild)){\r\n\t\t\t\tdomConstruct.destroy(node.lastChild);\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\t// Needed to support ToggleDir plugin.  Intentionally not inside if(has(\"dojo-bidi\")) block\r\n\t\t// so that (for backwards compatibility) ToggleDir plugin works even when has(\"dojo-bidi\") is falsy.\r\n\t\t_setTextDirAttr: function(/*String*/ value){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tSets textDir attribute.  Sets direction of editNode accordingly.\r\n\t\t\tthis._set(\"textDir\", value);\r\n\t\t\tthis.onLoadDeferred.then(lang.hitch(this, function(){\r\n\t\t\t\tthis.editNode.dir = value;\r\n\t\t\t}));\r\n\t\t}\r\n\t});\r\n\r\n\treturn RichText;\r\n});\r\n"]}