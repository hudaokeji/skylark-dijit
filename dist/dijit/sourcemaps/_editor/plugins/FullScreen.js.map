{"version":3,"sources":["_editor/plugins/FullScreen.js"],"names":["define","aspect","declare","domClass","domGeometry","domStyle","i18n","keys","lang","on","has","win","winUtils","focus","_Plugin","ToggleButton","registry","FullScreen","zIndex","_origState","_origiFrameState","_resizeHandle","isFullscreen","toggle","this","button","set","get","_initButton","strings","getLocalization","editor","label","ownerDocument","dir","showLabel","iconClass","iconClassPrefix","tabIndex","onChange","hitch","setEditor","addKeyHandler","F11","e","stopPropagation","preventDefault","defer","own","domNode","_containFocus","ed","isTabIndent","_fullscreen_oldOnKeyDown","keyCode","TAB","f","curNode","avn","_getAltViewNode","iframe","setTimeout","toolbar","event","_resizeEditor","vp","getBox","setMarginBox","w","h","hHeight","getHeaderHeight","fHeight","getFooterHeight","extents","getPadBorderExtents","fcpExtents","parentNode","fcmExtents","getMarginExtents","cHeight","_setFullScreen","full","body","ownerDocumentBody","editorParent","add","_editorResizeHolder","resize","onKeyDown","rawStyle","style","width","height","top","left","position","marginBox","getMarginBox","iframeStyle","bc","backgroundColor","overflow","_oldOverflow","_oldBodyParentOverflow","window","_prevW","_prevH","_resizer","clearTimeout","_resizeHandle2","after","dn","scrollIntoView","remove","_rst","self","mb","oh","pWidget","getEnclosingWidget","indexOf","updateState","destroy","inherited","arguments","args"],"mappings":"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","file":"../../../_editor/plugins/FullScreen.js","sourcesContent":["define([\r\n\t\"dojo/aspect\",\r\n\t\"dojo/_base/declare\", // declare\r\n\t\"dojo/dom-class\", // domClass.add domClass.remove\r\n\t\"dojo/dom-geometry\",\r\n\t\"dojo/dom-style\",\r\n\t\"dojo/i18n\", // i18n.getLocalization\r\n\t\"dojo/keys\", // keys.F11 keys.TAB\r\n\t\"dojo/_base/lang\", // lang.hitch\r\n\t\"dojo/on\", // on()\r\n\t\"dojo/sniff\", // has(\"ie\"), has(\"quirks\")\r\n\t\"dojo/_base/window\", // win.body\r\n\t\"dojo/window\", // winUtils.getBox winUtils.scrollIntoView\r\n\t\"../../focus\", // focus.focus(), focus.curNode\r\n\t\"../_Plugin\",\r\n\t\"../../form/ToggleButton\",\r\n\t\"../../registry\", // registry.getEnclosingWidget()\r\n\t\"dojo/i18n!../nls/commands\"\r\n], function(aspect, declare, domClass, domGeometry, domStyle, i18n, keys, lang, on, has, win, winUtils,\r\n\t\t\tfocus, _Plugin, ToggleButton, registry){\r\n\r\n\t// module:\r\n\t//\t\tdijit/_editor/plugins/FullScreen\r\n\r\n\tvar FullScreen = declare(\"dijit._editor.plugins.FullScreen\", _Plugin, {\r\n\t\t// summary:\r\n\t\t//\t\tThis plugin provides FullScreen capability to the editor.  When\r\n\t\t//\t\ttoggled on, it will render the editor into the full window and\r\n\t\t//\t\toverlay everything.  It also binds to the hotkey: CTRL-SHIFT-F11\r\n\t\t//\t\tfor toggling fullscreen mode.\r\n\r\n\t\t// zIndex: [public] Number\r\n\t\t//\t\tzIndex value used for overlaying the full page.\r\n\t\t//\t\tdefault is 500.\r\n\t\tzIndex: 500,\r\n\r\n\t\t// _origState: [private] Object\r\n\t\t//\t\tThe original view state of the editor.\r\n\t\t_origState: null,\r\n\r\n\t\t// _origiFrameState: [private] Object\r\n\t\t//\t\tThe original view state of the iframe of the editor.\r\n\t\t_origiFrameState: null,\r\n\r\n\t\t// _resizeHandle: [private] Object\r\n\t\t//\t\tConnection point used for handling resize when window resizes.\r\n\t\t_resizeHandle: null,\r\n\r\n\t\t// isFullscreen: [const] boolean\r\n\t\t//\t\tRead-Only variable used to denote of the editor is in fullscreen mode or not.\r\n\t\tisFullscreen: false,\r\n\r\n\t\ttoggle: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to allow programmatic toggling of the view.\r\n\t\t\tthis.button.set(\"checked\", !this.button.get(\"checked\"));\r\n\t\t},\r\n\r\n\t\t_initButton: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride for creation of the resize button.\r\n\t\t\tvar strings = i18n.getLocalization(\"dijit._editor\", \"commands\"),\r\n\t\t\t\teditor = this.editor;\r\n\t\t\tthis.button = new ToggleButton({\r\n\t\t\t\tlabel: strings[\"fullScreen\"],\r\n\t\t\t\townerDocument: editor.ownerDocument,\r\n\t\t\t\tdir: editor.dir,\r\n\t\t\t\tlang: editor.lang,\r\n\t\t\t\tshowLabel: false,\r\n\t\t\t\ticonClass: this.iconClassPrefix + \" \" + this.iconClassPrefix + \"FullScreen\",\r\n\t\t\t\ttabIndex: \"-1\",\r\n\t\t\t\tonChange: lang.hitch(this, \"_setFullScreen\")\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetEditor: function(editor){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride for the setting of the editor.\r\n\t\t\t// editor: Object\r\n\t\t\t//\t\tThe editor to configure for this plugin to use.\r\n\t\t\tthis.editor = editor;\r\n\t\t\tthis._initButton();\r\n\r\n\t\t\tthis.editor.addKeyHandler(keys.F11, true, true, lang.hitch(this, function(e){\r\n\t\t\t\t// Enable the CTRL-SHIFT-F11 hotkey for fullscreen mode.\r\n\t\t\t\tthis.toggle();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis.editor.defer(\"focus\", 250);\r\n\t\t\t\treturn true;\r\n\t\t\t}));\r\n\t\t\tthis.own(on(this.editor.domNode, \"keydown\", lang.hitch(this, \"_containFocus\")));\r\n\t\t},\r\n\r\n\t\t_containFocus: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tWhen in Full Screen mode, it's good to try and retain focus in the editor\r\n\t\t\t//\t\tso this function is intended to try and constrain the TAB key.\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tThe key event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(this.isFullscreen){\r\n\t\t\t\tvar ed = this.editor;\r\n\t\t\t\tif(!ed.isTabIndent &&\r\n\t\t\t\t\ted._fullscreen_oldOnKeyDown &&\r\n\t\t\t\t\te.keyCode === keys.TAB){\r\n\t\t\t\t\t// If we're in fullscreen mode, we want to take over how tab moves focus a bit.\r\n\t\t\t\t\t// to keep it within the editor since it's hiding the rest of the page.\r\n\t\t\t\t\t// IE hates changing focus IN the event handler, so need to put calls\r\n\t\t\t\t\t// in a timeout.  Gotta love IE.\r\n\t\t\t\t\t// Also need to check for alternate view nodes if present and active.\r\n\t\t\t\t\tvar f = focus.curNode;\r\n\t\t\t\t\tvar avn = this._getAltViewNode();\r\n\t\t\t\t\tif(f == ed.iframe ||\r\n\t\t\t\t\t\t(avn && f === avn)){\r\n\t\t\t\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\t\t\ted.toolbar.focus();\r\n\t\t\t\t\t\t}), 10);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(avn && domStyle.get(ed.iframe, \"display\") === \"none\"){\r\n\t\t\t\t\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\t\t\t\tfocus.focus(avn);\r\n\t\t\t\t\t\t\t}), 10);\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\t\t\t\ted.focus();\r\n\t\t\t\t\t\t\t}), 10);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}else if(ed._fullscreen_oldOnKeyDown){\r\n\t\t\t\t\t// Only call up when it's a different function.  Traps corner case event issue\r\n\t\t\t\t\t// on IE which caused stack overflow on handler cleanup.\r\n\t\t\t\t\ted._fullscreen_oldOnKeyDown(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_resizeEditor: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to handle resizing the editor as the viewport\r\n\t\t\t//\t\tresizes (window scaled)\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar vp = winUtils.getBox(this.editor.ownerDocument);\r\n\t\t\tdomGeometry.setMarginBox(this.editor.domNode, {\r\n\t\t\t\tw: vp.w,\r\n\t\t\t\th: vp.h\r\n\t\t\t});\r\n\r\n\t\t\t//Adjust the internal heights too, as they can be a bit off.\r\n\t\t\tvar hHeight = this.editor.getHeaderHeight();\r\n\t\t\tvar fHeight = this.editor.getFooterHeight();\r\n\t\t\tvar extents = domGeometry.getPadBorderExtents(this.editor.domNode);\r\n\t\t\tvar fcpExtents = domGeometry.getPadBorderExtents(this.editor.iframe.parentNode);\r\n\t\t\tvar fcmExtents = domGeometry.getMarginExtents(this.editor.iframe.parentNode);\r\n\r\n\t\t\tvar cHeight = vp.h - (hHeight + extents.h + fHeight);\r\n\t\t\tdomGeometry.setMarginBox(this.editor.iframe.parentNode, {\r\n\t\t\t\th: cHeight,\r\n\t\t\t\tw: vp.w\r\n\t\t\t});\r\n\t\t\tdomGeometry.setMarginBox(this.editor.iframe, {\r\n\t\t\t\th: cHeight - (fcpExtents.h + fcmExtents.h)\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_getAltViewNode: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tThis function is intended as a hook point for setting an\r\n\t\t\t//\t\talternate view node for when in full screen mode and the\r\n\t\t\t//\t\teditable iframe is hidden.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected.\r\n\t\t},\r\n\r\n\t\t_setFullScreen: function(full){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to handle toggling between full screen and\r\n\t\t\t//\t\tregular view.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\t//Alias this for shorter code.\r\n\t\t\tvar ed = this.editor;\r\n\t\t\tvar body = ed.ownerDocumentBody;\r\n\t\t\tvar editorParent = ed.domNode.parentNode;\r\n\r\n\t\t\tvar vp = winUtils.getBox(ed.ownerDocument);\r\n\r\n\t\t\tthis.isFullscreen = full;\r\n\r\n\t\t\tif(full){\r\n\t\t\t\t//Parent classes can royally screw up this plugin, so we\r\n\t\t\t\t//have to set everything to position static.\r\n\t\t\t\twhile(editorParent && editorParent !== body){\r\n\t\t\t\t\tdomClass.add(editorParent, \"dijitForceStatic\");\r\n\t\t\t\t\teditorParent = editorParent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Save off the resize function.  We want to kill its behavior.\r\n\t\t\t\tthis._editorResizeHolder = this.editor.resize;\r\n\t\t\t\ted.resize = function(){\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Try to constrain focus control.\r\n\t\t\t\ted._fullscreen_oldOnKeyDown = ed.onKeyDown;\r\n\t\t\t\ted.onKeyDown = lang.hitch(this, this._containFocus);\r\n\r\n\t\t\t\tthis._origState = {};\r\n\t\t\t\tthis._origiFrameState = {};\r\n\r\n\t\t\t\t// Store the basic editor state we have to restore later.\r\n\t\t\t\t// Not using domStyle.get here, had problems, didn't\r\n\t\t\t\t// give me stuff like 100%, gave me pixel calculated values.\r\n\t\t\t\t// Need the exact original values.\r\n\t\t\t\tvar domNode = ed.domNode,\r\n\t\t\t\t\trawStyle = domNode && domNode.style || {};\r\n\t\t\t\tthis._origState = {\r\n\t\t\t\t\twidth: rawStyle.width || \"\",\r\n\t\t\t\t\theight: rawStyle.height || \"\",\r\n\t\t\t\t\ttop: domStyle.get(domNode, \"top\") || \"\",\r\n\t\t\t\t\tleft: domStyle.get(domNode, \"left\") || \"\",\r\n\t\t\t\t\tposition: domStyle.get(domNode, \"position\") || \"static\",\r\n\t\t\t\t\tmarginBox: domGeometry.getMarginBox(ed.domNode)\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Store the iframe state we have to restore later.\r\n\t\t\t\t// Not using domStyle.get here, had problems, didn't\r\n\t\t\t\t// give me stuff like 100%, gave me pixel calculated values.\r\n\t\t\t\t// Need the exact original values.\r\n\t\t\t\tvar iframe = ed.iframe,\r\n\t\t\t\t\tiframeStyle = iframe && iframe.style || {};\r\n\r\n\t\t\t\tvar bc = domStyle.get(ed.iframe, \"backgroundColor\");\r\n\t\t\t\tthis._origiFrameState = {\r\n\t\t\t\t\tbackgroundColor: bc || \"transparent\",\r\n\t\t\t\t\twidth: iframeStyle.width || \"auto\",\r\n\t\t\t\t\theight: iframeStyle.height || \"auto\",\r\n\t\t\t\t\tzIndex: iframeStyle.zIndex || \"\"\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Okay, size everything.\r\n\t\t\t\tdomStyle.set(ed.domNode, {\r\n\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\ttop: \"0px\",\r\n\t\t\t\t\tleft: \"0px\",\r\n\t\t\t\t\tzIndex: this.zIndex,\r\n\t\t\t\t\twidth: vp.w + \"px\",\r\n\t\t\t\t\theight: vp.h + \"px\"\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdomStyle.set(ed.iframe, {\r\n\t\t\t\t\theight: \"100%\",\r\n\t\t\t\t\twidth: \"100%\",\r\n\t\t\t\t\tzIndex: this.zIndex,\r\n\t\t\t\t\tbackgroundColor: bc !== \"transparent\" &&\r\n\t\t\t\t\t\tbc !== \"rgba(0, 0, 0, 0)\" ? bc : \"white\"\r\n\t\t\t\t});\r\n\r\n\t\t\t\tdomStyle.set(ed.iframe.parentNode, {\r\n\t\t\t\t\theight: \"95%\",\r\n\t\t\t\t\twidth: \"100%\"\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Store the overflow state we have to restore later.\r\n\t\t\t\t// IE had issues, so have to check that it's defined.  Ugh.\r\n\t\t\t\tif(body.style && body.style.overflow){\r\n\t\t\t\t\tthis._oldOverflow = domStyle.get(body, \"overflow\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._oldOverflow = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(has(\"ie\") && !has(\"quirks\")){\r\n\t\t\t\t\t// IE will put scrollbars in anyway, html (parent of body)\r\n\t\t\t\t\t// also controls them in standards mode, so we have to\r\n\t\t\t\t\t// remove them, argh.\r\n\t\t\t\t\tif(body.parentNode &&\r\n\t\t\t\t\t\tbody.parentNode.style &&\r\n\t\t\t\t\t\tbody.parentNode.style.overflow){\r\n\t\t\t\t\t\tthis._oldBodyParentOverflow = body.parentNode.style.overflow;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\ttry{\r\n\t\t\t\t\t\t\tthis._oldBodyParentOverflow = domStyle.get(body.parentNode, \"overflow\");\r\n\t\t\t\t\t\t}catch(e){\r\n\t\t\t\t\t\t\tthis._oldBodyParentOverflow = \"scroll\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdomStyle.set(body.parentNode, \"overflow\", \"hidden\");\r\n\t\t\t\t}\r\n\t\t\t\tdomStyle.set(body, \"overflow\", \"hidden\");\r\n\r\n\t\t\t\tvar resizer = function(){\r\n\t\t\t\t\t// function to handle resize events.\r\n\t\t\t\t\t// Will check current VP and only resize if\r\n\t\t\t\t\t// different.\r\n\t\t\t\t\tvar vp = winUtils.getBox(ed.ownerDocument);\r\n\t\t\t\t\tif(\"_prevW\" in this && \"_prevH\" in this){\r\n\t\t\t\t\t\t// No actual size change, ignore.\r\n\t\t\t\t\t\tif(vp.w === this._prevW && vp.h === this._prevH){\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis._prevW = vp.w;\r\n\t\t\t\t\t\tthis._prevH = vp.h;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(this._resizer){\r\n\t\t\t\t\t\tclearTimeout(this._resizer);\r\n\t\t\t\t\t\tdelete this._resizer;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Timeout it to help avoid spamming resize on IE.\r\n\t\t\t\t\t// Works for all browsers.\r\n\t\t\t\t\tthis._resizer = setTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\t\tdelete this._resizer;\r\n\t\t\t\t\t\tthis._resizeEditor();\r\n\t\t\t\t\t}), 10);\r\n\t\t\t\t};\r\n\t\t\t\tthis._resizeHandle = on(window, \"resize\", lang.hitch(this, resizer));\r\n\r\n\t\t\t\t// Also monitor for direct calls to resize and adapt editor.\r\n\t\t\t\tthis._resizeHandle2 = aspect.after(ed, \"onResize\", lang.hitch(this, function(){\r\n\t\t\t\t\tif(this._resizer){\r\n\t\t\t\t\t\tclearTimeout(this._resizer);\r\n\t\t\t\t\t\tdelete this._resizer;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._resizer = setTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\t\tdelete this._resizer;\r\n\t\t\t\t\t\tthis._resizeEditor();\r\n\t\t\t\t\t}), 10);\r\n\t\t\t\t}));\r\n\r\n\t\t\t\t// Call it once to work around IE glitchiness.  Safe for other browsers too.\r\n\t\t\t\tthis._resizeEditor();\r\n\t\t\t\tvar dn = this.editor.toolbar.domNode;\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\twinUtils.scrollIntoView(dn);\r\n\t\t\t\t}, 250);\r\n\t\t\t}else{\r\n\t\t\t\tif(this._resizeHandle){\r\n\t\t\t\t\t// Cleanup resizing listeners\r\n\t\t\t\t\tthis._resizeHandle.remove();\r\n\t\t\t\t\tthis._resizeHandle = null;\r\n\t\t\t\t}\r\n\t\t\t\tif(this._resizeHandle2){\r\n\t\t\t\t\t// Cleanup resizing listeners\r\n\t\t\t\t\tthis._resizeHandle2.remove();\r\n\t\t\t\t\tthis._resizeHandle2 = null;\r\n\t\t\t\t}\r\n\t\t\t\tif(this._rst){\r\n\t\t\t\t\tclearTimeout(this._rst);\r\n\t\t\t\t\tthis._rst = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//Remove all position static class assigns.\r\n\t\t\t\twhile(editorParent && editorParent !== body){\r\n\t\t\t\t\tdomClass.remove(editorParent, \"dijitForceStatic\");\r\n\t\t\t\t\teditorParent = editorParent.parentNode;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Restore resize function\r\n\t\t\t\tif(this._editorResizeHolder){\r\n\t\t\t\t\tthis.editor.resize = this._editorResizeHolder;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(!this._origState && !this._origiFrameState){\r\n\t\t\t\t\t// If we actually didn't toggle, then don't do anything.\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(ed._fullscreen_oldOnKeyDown){\r\n\t\t\t\t\ted.onKeyDown = ed._fullscreen_oldOnKeyDown;\r\n\t\t\t\t\tdelete ed._fullscreen_oldOnKeyDown;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add a timeout to make sure we don't have a resize firing in the\r\n\t\t\t\t// background at the time of minimize.\r\n\t\t\t\tvar self = this;\r\n\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t// Restore all the editor state.\r\n\t\t\t\t\tvar mb = self._origState.marginBox;\r\n\t\t\t\t\tvar oh = self._origState.height;\r\n\t\t\t\t\tif(has(\"ie\") && !has(\"quirks\")){\r\n\t\t\t\t\t\tbody.parentNode.style.overflow = self._oldBodyParentOverflow;\r\n\t\t\t\t\t\tdelete self._oldBodyParentOverflow;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdomStyle.set(body, \"overflow\", self._oldOverflow);\r\n\t\t\t\t\tdelete self._oldOverflow;\r\n\r\n\t\t\t\t\tdomStyle.set(ed.domNode, self._origState);\r\n\t\t\t\t\tdomStyle.set(ed.iframe.parentNode, {\r\n\t\t\t\t\t\theight: \"\",\r\n\t\t\t\t\t\twidth: \"\"\r\n\t\t\t\t\t});\r\n\t\t\t\t\tdomStyle.set(ed.iframe, self._origiFrameState);\r\n\t\t\t\t\tdelete self._origState;\r\n\t\t\t\t\tdelete self._origiFrameState;\r\n\t\t\t\t\t// In case it is contained in a layout and the layout changed size,\r\n\t\t\t\t\t// go ahead and call resize.\r\n\t\t\t\t\tvar pWidget = registry.getEnclosingWidget(ed.domNode.parentNode);\r\n\t\t\t\t\tif(pWidget && pWidget.resize){\r\n\t\t\t\t\t\tpWidget.resize();\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif(!oh || oh.indexOf(\"%\") < 0){\r\n\t\t\t\t\t\t\t// Resize if the original size wasn't set\r\n\t\t\t\t\t\t\t// or wasn't in percent.  Timeout is to avoid\r\n\t\t\t\t\t\t\t// an IE crash in unit testing.\r\n\t\t\t\t\t\t\tsetTimeout(lang.hitch(this, function(){\r\n\t\t\t\t\t\t\t\ted.resize({h: mb.h});\r\n\t\t\t\t\t\t\t}), 0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\twinUtils.scrollIntoView(self.editor.toolbar.domNode);\r\n\t\t\t\t}, 100);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tupdateState: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride for button state control for disabled to work.\r\n\t\t\tthis.button.set(\"disabled\", this.get(\"disabled\"));\r\n\t\t},\r\n\r\n\t\tdestroy: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride to ensure the resize handle gets cleaned up.\r\n\t\t\tif(this._resizeHandle){\r\n\t\t\t\t// Cleanup resizing listeners\r\n\t\t\t\tthis._resizeHandle.remove();\r\n\t\t\t\tthis._resizeHandle = null;\r\n\t\t\t}\r\n\t\t\tif(this._resizeHandle2){\r\n\t\t\t\t// Cleanup resizing listeners\r\n\t\t\t\tthis._resizeHandle2.remove();\r\n\t\t\t\tthis._resizeHandle2 = null;\r\n\t\t\t}\r\n\t\t\tif(this._resizer){\r\n\t\t\t\tclearTimeout(this._resizer);\r\n\t\t\t\tthis._resizer = null;\r\n\t\t\t}\r\n\t\t\tthis.inherited(arguments);\r\n\t\t}\r\n\t});\r\n\r\n\t// Register this plugin.\r\n\t// For back-compat accept \"fullscreen\" (all lowercase) too, remove in 2.0\r\n\t_Plugin.registry[\"fullScreen\"] = _Plugin.registry[\"fullscreen\"] = function(args){\r\n\t\treturn new FullScreen({\r\n\t\t\tzIndex: (\"zIndex\" in args) ? args.zIndex : 500\r\n\t\t});\r\n\t};\r\n\r\n\treturn FullScreen;\r\n});\r\n"]}