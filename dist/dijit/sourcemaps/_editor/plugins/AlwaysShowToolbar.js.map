{"version":3,"sources":["_editor/plugins/AlwaysShowToolbar.js"],"names":["define","declare","domClass","domConstruct","domGeometry","lang","on","has","win","_Plugin","_handleScroll","setEditor","e","iframe","this","editor","onLoadDeferred","then","hitch","enable","console","log","d","_updateHeight","own","window","isLoaded","height","getMarginSize","editNode","h","scrollHeight","document","body","_fixEnabled","header","minHeight","min","parseInt","_lastHeight","setMarginBox","debug","globalOnScrollHandler","isIE6","tdn","_scrollSetUp","_scrollThreshold","position","y","scrollPos","docScroll","ownerDocument","s","style","tdnbox","marginTop","left","x","previousSibling","_IEOriginalPos","nextSibling","parentNode","ownerDocumentBody","appendChild","add","top","w","zIndex","eHeight","display","remove","place","width","destroy","inherited","arguments"],"mappings":"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","file":"../../../_editor/plugins/AlwaysShowToolbar.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\", // declare\r\n\t\"dojo/dom-class\", // domClass.add domClass.remove\r\n\t\"dojo/dom-construct\", // domConstruct.place\r\n\t\"dojo/dom-geometry\",\r\n\t\"dojo/_base/lang\", // lang.hitch\r\n\t\"dojo/on\",\r\n\t\"dojo/sniff\", // has(\"ie\") has(\"opera\")\r\n\t\"dojo/_base/window\", // win.body\r\n\t\"../_Plugin\"\r\n], function(declare, domClass, domConstruct, domGeometry, lang, on, has, win, _Plugin){\r\n\r\n\t// module:\r\n\t//\t\tdijit/_editor/plugins/AlwaysShowToolbar\r\n\r\n\treturn declare(\"dijit._editor.plugins.AlwaysShowToolbar\", _Plugin, {\r\n\t\t// summary:\r\n\t\t//\t\tThis plugin is required for Editors in auto-expand mode.\r\n\t\t//\t\tIt handles the auto-expansion as the user adds/deletes text,\r\n\t\t//\t\tand keeps the editor's toolbar visible even when the top of the editor\r\n\t\t//\t\thas scrolled off the top of the viewport (usually when editing a long\r\n\t\t//\t\tdocument).\r\n\t\t// description:\r\n\t\t//\t\tSpecify this in extraPlugins (or plugins) parameter and also set\r\n\t\t//\t\theight to \"\".\r\n\t\t// example:\r\n\t\t//\t|\t<script type=\"dojo/require\">\r\n\t\t//\t|\t\tAlwaysShowToolbar: \"dijit/_editor/plugins/AlwaysShowToolbar\"\r\n\t\t//\t|\t</script>\r\n\t\t//\t|\t<div data-dojo-type=\"dijit/Editor\" height=\"\"\r\n\t\t//\t|\t\t\tdata-dojo-props=\"extraPlugins: [AlwaysShowToolbar]\">\r\n\r\n\t\t// _handleScroll: Boolean\r\n\t\t//\t\tEnables/disables the handler for scroll events\r\n\t\t_handleScroll: true,\r\n\r\n\t\tsetEditor: function(e){\r\n\t\t\t// Overrides _Plugin.setEditor().\r\n\t\t\tif(!e.iframe){\r\n\t\t\t\tconsole.log('Port AlwaysShowToolbar plugin to work with Editor without iframe');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.editor = e;\r\n\r\n\t\t\te.onLoadDeferred.then(lang.hitch(this, this.enable));\r\n\t\t},\r\n\r\n\t\tenable: function(d){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tEnable plugin.  Called when Editor has finished initializing.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tthis._updateHeight();\r\n\t\t\tthis.own(\r\n\t\t\t\ton(window, 'scroll', lang.hitch(this, \"globalOnScrollHandler\")),\r\n\t\t\t\tthis.editor.on('NormalizedDisplayChanged', lang.hitch(this, \"_updateHeight\"))\r\n\t\t\t);\r\n\t\t\treturn d;\r\n\t\t},\r\n\r\n\t\t_updateHeight: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tUpdates the height of the editor area to fit the contents.\r\n\t\t\tvar e = this.editor;\r\n\t\t\tif(!e.isLoaded){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(e.height){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar height = domGeometry.getMarginSize(e.editNode).h;\r\n\t\t\tif(has(\"opera\")){\r\n\t\t\t\theight = e.editNode.scrollHeight;\r\n\t\t\t}\r\n\t\t\t// console.debug('height',height);\r\n\t\t\t// alert(this.editNode);\r\n\r\n\t\t\t//height maybe zero in some cases even though the content is not empty,\r\n\t\t\t//we try the height of body instead\r\n\t\t\tif(!height){\r\n\t\t\t\theight = domGeometry.getMarginSize(e.document.body).h;\r\n\t\t\t}\r\n\r\n\t\t\tif(this._fixEnabled){\r\n\t\t\t\t// #16204: add toolbar height when it is fixed aka \"stuck to the top of the screen\" to prevent content from cutting off during autosizing.\r\n\t\t\t\t// Seems like _updateHeight should be taking the intitial margin height from a more appropriate node that includes the marginTop set in globalOnScrollHandler.\r\n\t\t\t\theight += domGeometry.getMarginSize(this.editor.header).h;\r\n\t\t\t}\r\n\r\n\t\t\tif(height == 0){\r\n\t\t\t\tconsole.debug(\"Can not figure out the height of the editing area!\");\r\n\t\t\t\treturn; //prevent setting height to 0\r\n\t\t\t}\r\n\t\t\tif(has(\"ie\") <= 7 && this.editor.minHeight){\r\n\t\t\t\tvar min = parseInt(this.editor.minHeight);\r\n\t\t\t\tif(height < min){\r\n\t\t\t\t\theight = min;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(height != this._lastHeight){\r\n\t\t\t\tthis._lastHeight = height;\r\n\t\t\t\t// this.editorObject.style.height = this._lastHeight + \"px\";\r\n\t\t\t\tdomGeometry.setMarginBox(e.iframe, { h: this._lastHeight });\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// _lastHeight: Integer\r\n\t\t//\t\tHeight in px of the editor at the last time we did sizing\r\n\t\t_lastHeight: 0,\r\n\r\n\t\tglobalOnScrollHandler: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandler for scroll events that bubbled up to `<html>`\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\tvar isIE6 = has(\"ie\") < 7;\r\n\t\t\tif(!this._handleScroll){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar tdn = this.editor.header;\r\n\t\t\tif(!this._scrollSetUp){\r\n\t\t\t\tthis._scrollSetUp = true;\r\n\t\t\t\tthis._scrollThreshold = domGeometry.position(tdn, true).y;\r\n\t\t\t}\r\n\r\n\t\t\tvar scrollPos = domGeometry.docScroll(this.editor.ownerDocument).y;\r\n\t\t\tvar s = tdn.style;\r\n\r\n\t\t\tif(scrollPos > this._scrollThreshold && scrollPos < this._scrollThreshold + this._lastHeight){\r\n\t\t\t\t// console.debug(scrollPos);\r\n\t\t\t\tif(!this._fixEnabled){\r\n\t\t\t\t\tvar tdnbox = domGeometry.getMarginSize(tdn);\r\n\t\t\t\t\tthis.editor.iframe.style.marginTop = tdnbox.h + \"px\";\r\n\r\n\t\t\t\t\tif(isIE6){\r\n\t\t\t\t\t\ts.left = domGeometry.position(tdn).x;\r\n\t\t\t\t\t\tif(tdn.previousSibling){\r\n\t\t\t\t\t\t\tthis._IEOriginalPos = ['after', tdn.previousSibling];\r\n\t\t\t\t\t\t}else if(tdn.nextSibling){\r\n\t\t\t\t\t\t\tthis._IEOriginalPos = ['before', tdn.nextSibling];\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tthis._IEOriginalPos = ['last', tdn.parentNode];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.editor.ownerDocumentBody.appendChild(tdn);\r\n\t\t\t\t\t\tdomClass.add(tdn, 'dijitIEFixedToolbar');\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\ts.position = \"fixed\";\r\n\t\t\t\t\t\ts.top = \"0px\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdomGeometry.setMarginBox(tdn, { w: tdnbox.w });\r\n\t\t\t\t\ts.zIndex = 2000;\r\n\t\t\t\t\tthis._fixEnabled = true;\r\n\t\t\t\t}\r\n\t\t\t\t// if we're showing the floating toolbar, make sure that if\r\n\t\t\t\t// we've scrolled past the bottom of the editor that we hide\r\n\t\t\t\t// the toolbar for this instance of the editor.\r\n\r\n\t\t\t\t// TODO: when we get multiple editor toolbar support working\r\n\t\t\t\t// correctly, ensure that we check this against the scroll\r\n\t\t\t\t// position of the bottom-most editor instance.\r\n\t\t\t\tvar eHeight = (this.height) ? parseInt(this.editor.height) : this.editor._lastHeight;\r\n\t\t\t\ts.display = (scrollPos > this._scrollThreshold + eHeight) ? \"none\" : \"\";\r\n\t\t\t}else if(this._fixEnabled){\r\n\t\t\t\tthis.editor.iframe.style.marginTop = '';\r\n\t\t\t\ts.position = \"\";\r\n\t\t\t\ts.top = \"\";\r\n\t\t\t\ts.zIndex = \"\";\r\n\t\t\t\ts.display = \"\";\r\n\t\t\t\tif(isIE6){\r\n\t\t\t\t\ts.left = \"\";\r\n\t\t\t\t\tdomClass.remove(tdn, 'dijitIEFixedToolbar');\r\n\t\t\t\t\tif(this._IEOriginalPos){\r\n\t\t\t\t\t\tdomConstruct.place(tdn, this._IEOriginalPos[1], this._IEOriginalPos[0]);\r\n\t\t\t\t\t\tthis._IEOriginalPos = null;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tdomConstruct.place(tdn, this.editor.iframe, 'before');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ts.width = \"\";\r\n\t\t\t\tthis._fixEnabled = false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroy: function(){\r\n\t\t\t// Overrides _Plugin.destroy().   TODO: call this.inherited() rather than repeating code.\r\n\t\t\tthis._IEOriginalPos = null;\r\n\t\t\tthis._handleScroll = false;\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\tif(has(\"ie\") < 7){\r\n\t\t\t\tdomClass.remove(this.editor.header, 'dijitIEFixedToolbar');\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n});\r\n"]}