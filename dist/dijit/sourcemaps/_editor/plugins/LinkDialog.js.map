{"version":3,"sources":["_editor/plugins/LinkDialog.js"],"names":["define","require","declare","domAttr","keys","lang","on","has","query","string","_Plugin","DropDownButton","rangeapi","LinkDialog","buttonClass","useDefaultCommand","urlRegExp","emailRegExp","htmlTemplate","tag","_hostRxp","_userAtRxp","linkDialogTemplate","join","_initButton","this","inherited","arguments","button","loadDropDown","hitch","_connectTagEvents","_loadDropDown","callback","i18n","TooltipDialog","registry","_this","command","messages","delegate","getLocalization","dropDown","title","ownerDocument","editor","dir","execute","onOpen","_onOpenDialog","prototype","apply","onCancel","setTimeout","id","getUniqueId","_uniqueId","_setContent","substitute","startup","_urlInput","byId","_textInput","_setButton","own","_urlRegExp","RegExp","_emailRegExp","isValid","value","get","test","domNode","e","keyCode","ENTER","shiftKey","metaKey","ctrlKey","altKey","onExecute","_checkAndFixInput","self","url","_delayedCheck","clearTimeout","appendHttp","appendMailto","length","trim","indexOf","charAt","set","_isValid","fixupUrl","onLoadDeferred","then","editNode","staticPanel","parserScope","content","_checkValues","args","urlInput","replace","setValue","_onCloseDialog","a","getSelection","window","getRangeAt","endContainer","nodeType","parentNode","nodeName","toLowerCase","selection","getSelectedElement","queryCommandEnabled","selectElementChildren","execCommand","document","forEach","innerHTML","removeChild","focused","focus","_getCurrentValues","text","target","tagName","getAttribute","textContent","innerText","selectElement","getSelectedText","textInput","targetSelect","b","fc","sel","rangeCount","range","getAncestorElement","startContainer","firstChild","reset","_onDblClick","t","onDisplayChanged","_updateTimer","remove","onNormalizedDisplayChanged","loadAndOpenDropDown","ImgLinkDialog","img","_selectTag"],"mappings":"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","file":"../../../_editor/plugins/LinkDialog.js","sourcesContent":["define([\r\n\t\"require\",\r\n\t\"dojo/_base/declare\", // declare\r\n\t\"dojo/dom-attr\", // domAttr.get\r\n\t\"dojo/keys\", // keys.ENTER\r\n\t\"dojo/_base/lang\", // lang.delegate lang.hitch lang.trim\r\n\t\"dojo/on\",\r\n\t\"dojo/sniff\", // has(\"ie\")\r\n\t\"dojo/query\", // query\r\n\t\"dojo/string\", // string.substitute\r\n\t\"../_Plugin\",\r\n\t\"../../form/DropDownButton\",\r\n\t\"../range\"\r\n], function(require, declare, domAttr, keys, lang, on, has, query, string,\r\n\t_Plugin, DropDownButton, rangeapi){\r\n\r\n\t// module:\r\n\t//\t\tdijit/_editor/plugins/LinkDialog\r\n\r\n\tvar LinkDialog = declare(\"dijit._editor.plugins.LinkDialog\", _Plugin, {\r\n\t\t// summary:\r\n\t\t//\t\tThis plugin provides the basis for an 'anchor' (link) dialog and an extension of it\r\n\t\t//\t\tprovides the image link dialog.\r\n\t\t// description:\r\n\t\t//\t\tThe command provided by this plugin is:\r\n\t\t//\r\n\t\t//\t\t- createLink\r\n\r\n\t\t// Override _Plugin.buttonClass.   This plugin is controlled by a DropDownButton\r\n\t\t// (which triggers a TooltipDialog).\r\n\t\tbuttonClass: DropDownButton,\r\n\r\n\t\t// Override _Plugin.useDefaultCommand... processing is handled by this plugin, not by dijit/Editor.\r\n\t\tuseDefaultCommand: false,\r\n\r\n\t\t// urlRegExp: [protected] String\r\n\t\t//\t\tUsed for validating input as correct URL.  While file:// urls are not terribly\r\n\t\t//\t\tuseful, they are technically valid.\r\n\t\turlRegExp: \"((https?|ftps?|file)\\\\://|\\./|\\.\\./|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\\\da-zA-Z](?:[-\\\\da-zA-Z]{0,61}[\\\\da-zA-Z])?)\\\\.)*(?:[a-zA-Z](?:[-\\\\da-zA-Z]{0,80}[\\\\da-zA-Z])?)\\\\.?)|(((\\\\d|[1-9]\\\\d|1\\\\d\\\\d|2[0-4]\\\\d|25[0-5])\\\\.){3}(\\\\d|[1-9]\\\\d|1\\\\d\\\\d|2[0-4]\\\\d|25[0-5])|(0[xX]0*[\\\\da-fA-F]?[\\\\da-fA-F]\\\\.){3}0[xX]0*[\\\\da-fA-F]?[\\\\da-fA-F]|(0+[0-3][0-7][0-7]\\\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\\\d{0,8}|[1-3]\\\\d{9}|4[01]\\\\d{8}|42[0-8]\\\\d{7}|429[0-3]\\\\d{6}|4294[0-8]\\\\d{5}|42949[0-5]\\\\d{4}|429496[0-6]\\\\d{3}|4294967[01]\\\\d{2}|42949672[0-8]\\\\d|429496729[0-5])|0[xX]0*[\\\\da-fA-F]{1,8}|([\\\\da-fA-F]{1,4}\\\\:){7}[\\\\da-fA-F]{1,4}|([\\\\da-fA-F]{1,4}\\\\:){6}((\\\\d|[1-9]\\\\d|1\\\\d\\\\d|2[0-4]\\\\d|25[0-5])\\\\.){3}(\\\\d|[1-9]\\\\d|1\\\\d\\\\d|2[0-4]\\\\d|25[0-5])))(\\\\:\\\\d+)?(/(?:[^?#\\\\s/]+/)*(?:[^?#\\\\s/]{0,}(?:\\\\?[^?#\\\\s/]*)?(?:#.*)?)?)?\",\r\n\r\n\t\t// emailRegExp: [protected] String\r\n\t\t//\t\tUsed for validating input as correct email address.  Taken from dojox.validate\r\n\t\temailRegExp: \"<?(mailto\\\\:)([!#-'*+\\\\-\\\\/-9=?A-Z^-~]+[.])*[!#-'*+\\\\-\\\\/-9=?A-Z^-~]+\" /*username*/ + \"@\" +\r\n\t\t\t\"((?:(?:[\\\\da-zA-Z](?:[-\\\\da-zA-Z]{0,61}[\\\\da-zA-Z])?)\\\\.)+(?:[a-zA-Z](?:[-\\\\da-zA-Z]{0,6}[\\\\da-zA-Z])?)\\\\.?)|localhost|^[^-][a-zA-Z0-9_-]*>?\", // host.\r\n\r\n\t\t// htmlTemplate: [protected] String\r\n\t\t//\t\tString used for templating the HTML to insert at the desired point.\r\n\t\thtmlTemplate: \"<a href=\\\"${urlInput}\\\" _djrealurl=\\\"${urlInput}\\\"\" +\r\n\t\t\t\" target=\\\"${targetSelect}\\\"\" +\r\n\t\t\t\">${textInput}</a>\",\r\n\r\n\t\t// tag: [protected] String\r\n\t\t//\t\tTag used for the link type.\r\n\t\ttag: \"a\",\r\n\r\n\t\t// _hostRxp [private] RegExp\r\n\t\t//\t\tRegular expression used to validate url fragments (ip address, hostname, etc)\r\n\t\t_hostRxp: /^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$/,\r\n\r\n\t\t// _userAtRxp [private] RegExp\r\n\t\t//\t\tRegular expression used to validate e-mail address fragment.\r\n\t\t_userAtRxp: /^([!#-'*+\\-\\/-9=?A-Z^-~]+[.])*[!#-'*+\\-\\/-9=?A-Z^-~]+@/i,\r\n\r\n\t\t// linkDialogTemplate: [protected] String\r\n\t\t//\t\tTemplate for contents of TooltipDialog to pick URL\r\n\t\tlinkDialogTemplate: [\r\n\t\t\t\"<table role='presentation'><tr><td>\",\r\n\t\t\t\"<label for='${id}_urlInput'>${url}</label>\",\r\n\t\t\t\"</td><td>\",\r\n\t\t\t\"<input data-dojo-type='dijit.form.ValidationTextBox' required='true' \" +\r\n\t\t\t\t\"id='${id}_urlInput' name='urlInput' data-dojo-props='intermediateChanges:true'/>\",\r\n\t\t\t\"</td></tr><tr><td>\",\r\n\t\t\t\"<label for='${id}_textInput'>${text}</label>\",\r\n\t\t\t\"</td><td>\",\r\n\t\t\t\"<input data-dojo-type='dijit.form.ValidationTextBox' required='true' id='${id}_textInput' \" +\r\n\t\t\t\t\"name='textInput' data-dojo-props='intermediateChanges:true'/>\",\r\n\t\t\t\"</td></tr><tr><td>\",\r\n\t\t\t\"<label for='${id}_targetSelect'>${target}</label>\",\r\n\t\t\t\"</td><td>\",\r\n\t\t\t\"<select id='${id}_targetSelect' name='targetSelect' data-dojo-type='dijit.form.Select'>\",\r\n\t\t\t\"<option selected='selected' value='_self'>${currentWindow}</option>\",\r\n\t\t\t\"<option value='_blank'>${newWindow}</option>\",\r\n\t\t\t\"<option value='_top'>${topWindow}</option>\",\r\n\t\t\t\"<option value='_parent'>${parentWindow}</option>\",\r\n\t\t\t\"</select>\",\r\n\t\t\t\"</td></tr><tr><td colspan='2'>\",\r\n\t\t\t\"<button data-dojo-type='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>\",\r\n\t\t\t\"<button data-dojo-type='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>\",\r\n\t\t\t\"</td></tr></table>\"\r\n\t\t].join(\"\"),\r\n\r\n\t\t_initButton: function(){\r\n\t\t\tthis.inherited(arguments);\r\n\r\n\t\t\t// Setup to lazy create TooltipDialog first time the button is clicked\r\n\t\t\tthis.button.loadDropDown = lang.hitch(this, \"_loadDropDown\");\r\n\r\n\t\t\tthis._connectTagEvents();\r\n\t\t},\r\n\t\t_loadDropDown: function(callback){\r\n\t\t\t// Called the first time the button is pressed.  Initialize TooltipDialog.\r\n\t\t\trequire([\r\n\t\t\t\t\"dojo/i18n\", // i18n.getLocalization\r\n\t\t\t\t\"../../TooltipDialog\",\r\n\t\t\t\t\"../../registry\", // registry.byId, registry.getUniqueId\r\n\t\t\t\t\"../../form/Button\", // used by template\r\n\t\t\t\t\"../../form/Select\", // used by template\r\n\t\t\t\t\"../../form/ValidationTextBox\", // used by template\r\n\t\t\t\t\"dojo/i18n!../../nls/common\",\r\n\t\t\t\t\"dojo/i18n!../nls/LinkDialog\"\r\n\t\t\t], lang.hitch(this, function(i18n, TooltipDialog, registry){\r\n\t\t\t\tvar _this = this;\r\n\t\t\t\tthis.tag = this.command == 'insertImage' ? 'img' : 'a';\r\n\t\t\t\tvar messages = lang.delegate(i18n.getLocalization(\"dijit\", \"common\", this.lang),\r\n\t\t\t\t\ti18n.getLocalization(\"dijit._editor\", \"LinkDialog\", this.lang));\r\n\t\t\t\tvar dropDown = (this.dropDown = this.button.dropDown = new TooltipDialog({\r\n\t\t\t\t\ttitle: messages[this.command + \"Title\"],\r\n\t\t\t\t\townerDocument: this.editor.ownerDocument,\r\n\t\t\t\t\tdir: this.editor.dir,\r\n\t\t\t\t\texecute: lang.hitch(this, \"setValue\"),\r\n\t\t\t\t\tonOpen: function(){\r\n\t\t\t\t\t\t_this._onOpenDialog();\r\n\t\t\t\t\t\tTooltipDialog.prototype.onOpen.apply(this, arguments);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonCancel: function(){\r\n\t\t\t\t\t\tsetTimeout(lang.hitch(_this, \"_onCloseDialog\"), 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t\tmessages.urlRegExp = this.urlRegExp;\r\n\t\t\t\tmessages.id = registry.getUniqueId(this.editor.id);\r\n\t\t\t\tthis._uniqueId = messages.id;\r\n\t\t\t\tthis._setContent(dropDown.title +\r\n\t\t\t\t\t\"<div style='border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'></div>\" +\r\n\t\t\t\t\tstring.substitute(this.linkDialogTemplate, messages));\r\n\t\t\t\tdropDown.startup();\r\n\t\t\t\tthis._urlInput = registry.byId(this._uniqueId + \"_urlInput\");\r\n\t\t\t\tthis._textInput = registry.byId(this._uniqueId + \"_textInput\");\r\n\t\t\t\tthis._setButton = registry.byId(this._uniqueId + \"_setButton\");\r\n\t\t\t\tthis.own(registry.byId(this._uniqueId + \"_cancelButton\").on(\"click\", lang.hitch(this.dropDown, \"onCancel\")));\r\n\t\t\t\tif(this._urlInput){\r\n\t\t\t\t\tthis.own(this._urlInput.on(\"change\", lang.hitch(this, \"_checkAndFixInput\")));\r\n\t\t\t\t}\r\n\t\t\t\tif(this._textInput){\r\n\t\t\t\t\tthis.own(this._textInput.on(\"change\", lang.hitch(this, \"_checkAndFixInput\")));\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Build up the dual check for http/https/file:, and mailto formats.\r\n\t\t\t\tthis._urlRegExp = new RegExp(\"^\" + this.urlRegExp + \"$\", \"i\");\r\n\t\t\t\tthis._emailRegExp = new RegExp(\"^\" + this.emailRegExp + \"$\", \"i\");\r\n\t\t\t\tthis._urlInput.isValid = lang.hitch(this, function(){\r\n\t\t\t\t\t// Function over-ride of isValid to test if the input matches a url or a mailto style link.\r\n\t\t\t\t\tvar value = this._urlInput.get(\"value\");\r\n\t\t\t\t\treturn this._urlRegExp.test(value) || this._emailRegExp.test(value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Listen for enter and execute if valid.\r\n\t\t\t\tthis.own(on(dropDown.domNode, \"keydown\", lang.hitch(this, lang.hitch(this, function(e){\r\n\t\t\t\t\tif(e && e.keyCode == keys.ENTER && !e.shiftKey && !e.metaKey && !e.ctrlKey && !e.altKey){\r\n\t\t\t\t\t\tif(!this._setButton.get(\"disabled\")){\r\n\t\t\t\t\t\t\tdropDown.onExecute();\r\n\t\t\t\t\t\t\tdropDown.execute(dropDown.get('value'));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}))));\r\n\r\n\t\t\t\tcallback();\r\n\t\t\t}));\r\n\t\t},\r\n\r\n\t\t_checkAndFixInput: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA function to listen for onChange events and test the input contents\r\n\t\t\t//\t\tfor valid information, such as valid urls with http/https/ftp and if\r\n\t\t\t//\t\tnot present, try and guess if the input url is relative or not, and if\r\n\t\t\t//\t\tnot, append http:// to it.  Also validates other fields as determined by\r\n\t\t\t//\t\tthe internal _isValid function.\r\n\t\t\tvar self = this;\r\n\t\t\tvar url = this._urlInput.get(\"value\");\r\n\t\t\tvar fixupUrl = function(url){\r\n\t\t\t\tvar appendHttp = false;\r\n\t\t\t\tvar appendMailto = false;\r\n\t\t\t\tif(url && url.length > 1){\r\n\t\t\t\t\turl = lang.trim(url);\r\n\t\t\t\t\tif(url.indexOf(\"mailto:\") !== 0){\r\n\t\t\t\t\t\tif(url.indexOf(\"/\") > 0){\r\n\t\t\t\t\t\t\tif(url.indexOf(\"://\") === -1){\r\n\t\t\t\t\t\t\t\t// Check that it doesn't start with /, ./, or ../, which would\r\n\t\t\t\t\t\t\t\t// imply 'target server relativeness'\r\n\t\t\t\t\t\t\t\tif(url.charAt(0) !== '/' && url.indexOf(\"./\") && url.indexOf(\"../\") !== 0){\r\n\t\t\t\t\t\t\t\t\tif(self._hostRxp.test(url)){\r\n\t\t\t\t\t\t\t\t\t\tappendHttp = true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else if(self._userAtRxp.test(url)){\r\n\t\t\t\t\t\t\t// If it looks like a foo@, append a mailto.\r\n\t\t\t\t\t\t\tappendMailto = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(appendHttp){\r\n\t\t\t\t\tself._urlInput.set(\"value\", \"http://\" + url);\r\n\t\t\t\t}\r\n\t\t\t\tif(appendMailto){\r\n\t\t\t\t\tself._urlInput.set(\"value\", \"mailto:\" + url);\r\n\t\t\t\t}\r\n\t\t\t\tself._setButton.set(\"disabled\", !self._isValid());\r\n\t\t\t};\r\n\t\t\tif(this._delayedCheck){\r\n\t\t\t\tclearTimeout(this._delayedCheck);\r\n\t\t\t\tthis._delayedCheck = null;\r\n\t\t\t}\r\n\t\t\tthis._delayedCheck = setTimeout(function(){\r\n\t\t\t\tfixupUrl(url);\r\n\t\t\t}, 250);\r\n\t\t},\r\n\r\n\t\t_connectTagEvents: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ridable function that connects tag specific events.\r\n\t\t\tthis.editor.onLoadDeferred.then(lang.hitch(this, function(){\r\n\t\t\t\tthis.own(on(this.editor.editNode, \"dblclick\", lang.hitch(this, \"_onDblClick\")));\r\n\t\t\t}));\r\n\t\t},\r\n\r\n\t\t_isValid: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tInternal function to allow validating of the inputs\r\n\t\t\t//\t\tfor a link to determine if set should be disabled or not\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\treturn this._urlInput.isValid() && this._textInput.isValid();\r\n\t\t},\r\n\r\n\t\t_setContent: function(staticPanel){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHelper for _initButton above.   Not sure why it's a separate method.\r\n\t\t\tthis.dropDown.set({\r\n\t\t\t\tparserScope: \"dojo\", // make parser search for dojoType/data-dojo-type even if page is multi-version\r\n\t\t\t\tcontent: staticPanel\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t_checkValues: function(args){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to check the values in args and 'fix' them up as needed.\r\n\t\t\t// args: Object\r\n\t\t\t//\t\tContent being set.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif(args && args.urlInput){\r\n\t\t\t\targs.urlInput = args.urlInput.replace(/\"/g, \"&quot;\");\r\n\t\t\t}\r\n\t\t\treturn args;\r\n\t\t},\r\n\r\n\t\tsetValue: function(args){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tCallback from the dialog when user presses \"set\" button.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\r\n\t\t\t// TODO: prevent closing popup if the text is empty\r\n\t\t\tthis._onCloseDialog();\r\n\t\t\tif(has(\"ie\") < 9){ //see #4151\r\n\t\t\t\tvar sel = rangeapi.getSelection(this.editor.window);\r\n\t\t\t\tvar range = sel.getRangeAt(0);\r\n\t\t\t\tvar a = range.endContainer;\r\n\t\t\t\tif(a.nodeType === 3){\r\n\t\t\t\t\t// Text node, may be the link contents, so check parent.\r\n\t\t\t\t\t// This plugin doesn't really support nested HTML elements\r\n\t\t\t\t\t// in the link, it assumes all link content is text.\r\n\t\t\t\t\ta = a.parentNode;\r\n\t\t\t\t}\r\n\t\t\t\tif(a && (a.nodeName && a.nodeName.toLowerCase() !== this.tag)){\r\n\t\t\t\t\t// Still nothing, one last thing to try on IE, as it might be 'img'\r\n\t\t\t\t\t// and thus considered a control.\r\n\t\t\t\t\ta = this.editor.selection.getSelectedElement(this.tag);\r\n\t\t\t\t}\r\n\t\t\t\tif(a && (a.nodeName && a.nodeName.toLowerCase() === this.tag)){\r\n\t\t\t\t\t// Okay, we do have a match.  IE, for some reason, sometimes pastes before\r\n\t\t\t\t\t// instead of removing the targeted paste-over element, so we unlink the\r\n\t\t\t\t\t// old one first.  If we do not the <a> tag remains, but it has no content,\r\n\t\t\t\t\t// so isn't readily visible (but is wrong for the action).\r\n\t\t\t\t\tif(this.editor.queryCommandEnabled(\"unlink\")){\r\n\t\t\t\t\t\t// Select all the link children, then unlink.  The following insert will\r\n\t\t\t\t\t\t// then replace the selected text.\r\n\t\t\t\t\t\tthis.editor.selection.selectElementChildren(a);\r\n\t\t\t\t\t\tthis.editor.execCommand(\"unlink\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// make sure values are properly escaped, etc.\r\n\t\t\targs = this._checkValues(args);\r\n\t\t\tthis.editor.execCommand('inserthtml',\r\n\t\t\t\tstring.substitute(this.htmlTemplate, args));\r\n\r\n\t\t\t// IE sometimes leaves a blank link, so we need to fix it up.\r\n\t\t\t// Go ahead and do this for everyone just to avoid blank links\r\n\t\t\t// in the page.\r\n\t\t\tquery(\"a\", this.editor.document).forEach(function(a){\r\n\t\t\t\tif(!a.innerHTML && !domAttr.has(a, \"name\")){\r\n\t\t\t\t\t// Remove empty anchors that do not have \"name\" set.\r\n\t\t\t\t\t// Empty ones with a name set could be a hidden hash\r\n\t\t\t\t\t// anchor.\r\n\t\t\t\t\ta.parentNode.removeChild(a);\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t},\r\n\r\n\t\t_onCloseDialog: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandler for close event on the dialog\r\n\r\n\t\t\tif(this.editor.focused){\r\n\t\t\t\t// put focus back in the edit area, unless the dialog closed because the user clicked somewhere else\r\n\t\t\t\tthis.editor.focus();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getCurrentValues: function(a){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride for getting the values to set in the dropdown.\r\n\t\t\t// a:\r\n\t\t\t//\t\tThe anchor/link to process for data for the dropdown.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar url, text, target;\r\n\t\t\tif(a && a.tagName.toLowerCase() === this.tag){\r\n\t\t\t\turl = a.getAttribute('_djrealurl') || a.getAttribute('href');\r\n\t\t\t\ttarget = a.getAttribute('target') || \"_self\";\r\n\t\t\t\ttext = a.textContent || a.innerText;\r\n\t\t\t\tthis.editor.selection.selectElement(a, true);\r\n\t\t\t}else{\r\n\t\t\t\ttext = this.editor.selection.getSelectedText();\r\n\t\t\t}\r\n\t\t\treturn {urlInput: url || '', textInput: text || '', targetSelect: target || ''}; //Object;\r\n\t\t},\r\n\r\n\t\t_onOpenDialog: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tHandler for when the dialog is opened.\r\n\t\t\t//\t\tIf the caret is currently in a URL then populate the URL's info into the dialog.\r\n\t\t\tvar a, b, fc;\r\n\t\t\tif(has(\"ie\")){\r\n\t\t\t\t// IE, even IE10, is difficult to select the element in, using the range unified\r\n\t\t\t\t// API seems to work reasonably well.\r\n\t\t\t\tvar sel = rangeapi.getSelection(this.editor.window);\r\n\t\t\t\tif(sel.rangeCount){\r\n\t\t\t\t\tvar range = sel.getRangeAt(0);\r\n\t\t\t\t\ta = range.endContainer;\r\n\t\t\t\t\tif(a.nodeType === 3){\r\n\t\t\t\t\t\t// Text node, may be the link contents, so check parent.\r\n\t\t\t\t\t\t// This plugin doesn't really support nested HTML elements\r\n\t\t\t\t\t\t// in the link, it assumes all link content is text.\r\n\t\t\t\t\t\ta = a.parentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(a && (a.nodeName && a.nodeName.toLowerCase() !== this.tag)){\r\n\t\t\t\t\t\t// Still nothing, one last thing to try on IE, as it might be 'img'\r\n\t\t\t\t\t\t// and thus considered a control.\r\n\t\t\t\t\t\ta = this.editor.selection.getSelectedElement(this.tag);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(!a || (a.nodeName && a.nodeName.toLowerCase() !== this.tag)){\r\n\t\t\t\t\t\t// Try another lookup, IE's selection is just terrible.\r\n\t\t\t\t\t\tb = this.editor.selection.getAncestorElement(this.tag);\r\n\t\t\t\t\t\tif(b && (b.nodeName && b.nodeName.toLowerCase() == this.tag)){\r\n\t\t\t\t\t\t\t// Looks like we found an A tag, use it and make sure just it is\r\n\t\t\t\t\t\t\t// selected.\r\n\t\t\t\t\t\t\ta = b;\r\n\t\t\t\t\t\t\tthis.editor.selection.selectElement(a);\r\n\t\t\t\t\t\t}else if(range.startContainer === range.endContainer){\r\n\t\t\t\t\t\t\t// STILL nothing.  Trying one more thing.  Lets look at the first child.\r\n\t\t\t\t\t\t\t// It might be an anchor tag in a div by itself or the like.  If it is,\r\n\t\t\t\t\t\t\t// we'll use it otherwise we give up.  The selection is not easily\r\n\t\t\t\t\t\t\t// determinable to be on an existing anchor tag.\r\n\t\t\t\t\t\t\tfc = range.startContainer.firstChild;\r\n\t\t\t\t\t\t\tif(fc && (fc.nodeName && fc.nodeName.toLowerCase() == this.tag)){\r\n\t\t\t\t\t\t\t\ta = fc;\r\n\t\t\t\t\t\t\t\tthis.editor.selection.selectElement(a);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\ta = this.editor.selection.getAncestorElement(this.tag);\r\n\t\t\t}\r\n\t\t\tthis.dropDown.reset();\r\n\t\t\tthis._setButton.set(\"disabled\", true);\r\n\t\t\tthis.dropDown.set(\"value\", this._getCurrentValues(a));\r\n\t\t},\r\n\r\n\t\t_onDblClick: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to define a behavior on double clicks on the element\r\n\t\t\t//\t\ttype this dialog edits to select it and pop up the editor\r\n\t\t\t//\t\tdialog.\r\n\t\t\t// e: Object\r\n\t\t\t//\t\tThe double-click event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected.\r\n\t\t\tif(e && e.target){\r\n\t\t\t\tvar t = e.target;\r\n\t\t\t\tvar tg = t.tagName ? t.tagName.toLowerCase() : \"\";\r\n\t\t\t\tif(tg === this.tag && domAttr.get(t, \"href\")){\r\n\t\t\t\t\tvar editor = this.editor;\r\n\r\n\t\t\t\t\tthis.editor.selection.selectElement(t);\r\n\t\t\t\t\teditor.onDisplayChanged();\r\n\r\n\t\t\t\t\t// Call onNormalizedDisplayChange() now, rather than on timer.\r\n\t\t\t\t\t// On IE, when focus goes to the first <input> in the TooltipDialog, the editor loses it's selection.\r\n\t\t\t\t\t// Later if onNormalizedDisplayChange() gets called via the timer it will disable the LinkDialog button\r\n\t\t\t\t\t// (actually, all the toolbar buttons), at which point clicking the <input> will close the dialog,\r\n\t\t\t\t\t// since (for unknown reasons) focus.js ignores disabled controls.\r\n\t\t\t\t\tif(editor._updateTimer){\r\n\t\t\t\t\t\teditor._updateTimer.remove();\r\n\t\t\t\t\t\tdelete editor._updateTimer;\r\n\t\t\t\t\t}\r\n\t\t\t\t\teditor.onNormalizedDisplayChanged();\r\n\r\n\t\t\t\t\tvar button = this.button;\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t// Focus shift outside the event handler.\r\n\t\t\t\t\t\t// IE doesn't like focus changes in event handles.\r\n\t\t\t\t\t\tbutton.set(\"disabled\", false);\r\n\t\t\t\t\t\tbutton.loadAndOpenDropDown().then(function(){\r\n\t\t\t\t\t\t\tif(button.dropDown.focus){\r\n\t\t\t\t\t\t\t\tbutton.dropDown.focus();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tvar ImgLinkDialog = declare(\"dijit._editor.plugins.ImgLinkDialog\", [LinkDialog], {\r\n\t\t// summary:\r\n\t\t//\t\tThis plugin extends LinkDialog and adds in a plugin for handling image links.\r\n\t\t//\t\tprovides the image link dialog.\r\n\t\t// description:\r\n\t\t//\t\tThe command provided by this plugin is:\r\n\t\t//\r\n\t\t//\t\t- insertImage\r\n\r\n\t\t// linkDialogTemplate: [protected] String\r\n\t\t//\t\tOver-ride for template since img dialog doesn't need target that anchor tags may.\r\n\t\tlinkDialogTemplate: [\r\n\t\t\t\"<table role='presentation'><tr><td>\",\r\n\t\t\t\"<label for='${id}_urlInput'>${url}</label>\",\r\n\t\t\t\"</td><td>\",\r\n\t\t\t\"<input dojoType='dijit.form.ValidationTextBox' regExp='${urlRegExp}' \" +\r\n\t\t\t\t\"required='true' id='${id}_urlInput' name='urlInput' data-dojo-props='intermediateChanges:true'/>\",\r\n\t\t\t\"</td></tr><tr><td>\",\r\n\t\t\t\"<label for='${id}_textInput'>${text}</label>\",\r\n\t\t\t\"</td><td>\",\r\n\t\t\t\"<input data-dojo-type='dijit.form.ValidationTextBox' required='false' id='${id}_textInput' \" +\r\n\t\t\t\t\"name='textInput' data-dojo-props='intermediateChanges:true'/>\",\r\n\t\t\t\"</td></tr><tr><td>\",\r\n\t\t\t\"</td><td>\",\r\n\t\t\t\"</td></tr><tr><td colspan='2'>\",\r\n\t\t\t\"<button data-dojo-type='dijit.form.Button' type='submit' id='${id}_setButton'>${set}</button>\",\r\n\t\t\t\"<button data-dojo-type='dijit.form.Button' type='button' id='${id}_cancelButton'>${buttonCancel}</button>\",\r\n\t\t\t\"</td></tr></table>\"\r\n\t\t].join(\"\"),\r\n\r\n\t\t// htmlTemplate: [protected] String\r\n\t\t//\t\tString used for templating the `<img>` HTML to insert at the desired point.\r\n\t\thtmlTemplate: \"<img src=\\\"${urlInput}\\\" _djrealurl=\\\"${urlInput}\\\" alt=\\\"${textInput}\\\" />\",\r\n\r\n\t\t// tag: [protected] String\r\n\t\t//\t\tTag used for the link type (img).\r\n\t\ttag: \"img\",\r\n\r\n\t\t_getCurrentValues: function(img){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride for getting the values to set in the dropdown.\r\n\t\t\t// a:\r\n\t\t\t//\t\tThe anchor/link to process for data for the dropdown.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tvar url, text;\r\n\t\t\tif(img && img.tagName.toLowerCase() === this.tag){\r\n\t\t\t\turl = img.getAttribute('_djrealurl') || img.getAttribute('src');\r\n\t\t\t\ttext = img.getAttribute('alt');\r\n\t\t\t\tthis.editor.selection.selectElement(img, true);\r\n\t\t\t}else{\r\n\t\t\t\ttext = this.editor.selection.getSelectedText();\r\n\t\t\t}\r\n\t\t\treturn {urlInput: url || '', textInput: text || ''}; //Object\r\n\t\t},\r\n\r\n\t\t_isValid: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride for images.  You can have alt text of blank, it is valid.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\treturn this._urlInput.isValid();\r\n\t\t},\r\n\r\n\t\t_connectTagEvents: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ridable function that connects tag specific events.\r\n\t\t\tthis.inherited(arguments);\r\n\t\t\tthis.editor.onLoadDeferred.then(lang.hitch(this, function(){\r\n\t\t\t\t// Use onmousedown instead of onclick.  Seems that IE eats the first onclick\r\n\t\t\t\t// to wrap it in a selector box, then the second one acts as onclick.  See #10420\r\n\t\t\t\tthis.own(on(this.editor.editNode, \"mousedown\", lang.hitch(this, \"_selectTag\")));\r\n\t\t\t}));\r\n\t\t},\r\n\r\n\t\t_selectTag: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tA simple event handler that lets me select an image if it is clicked on.\r\n\t\t\t//\t\tmakes it easier to select images in a standard way across browsers.  Otherwise\r\n\t\t\t//\t\tselecting an image for edit becomes difficult.\r\n\t\t\t// e: Event\r\n\t\t\t//\t\tThe mousedown event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tif(e && e.target){\r\n\t\t\t\tvar t = e.target;\r\n\t\t\t\tvar tg = t.tagName ? t.tagName.toLowerCase() : \"\";\r\n\t\t\t\tif(tg === this.tag){\r\n\t\t\t\t\tthis.editor.selection.selectElement(t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_checkValues: function(args){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to check the values in args and 'fix' them up as needed\r\n\t\t\t//\t\t(special characters in the url or alt text)\r\n\t\t\t// args: Object\r\n\t\t\t//\t\tContent being set.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected\r\n\t\t\tif(args && args.urlInput){\r\n\t\t\t\targs.urlInput = args.urlInput.replace(/\"/g, \"&quot;\");\r\n\t\t\t}\r\n\t\t\tif(args && args.textInput){\r\n\t\t\t\targs.textInput = args.textInput.replace(/\"/g, \"&quot;\");\r\n\t\t\t}\r\n\t\t\treturn args;\r\n\t\t},\r\n\r\n\t\t_onDblClick: function(e){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to define a behavior on double clicks on the element\r\n\t\t\t//\t\ttype this dialog edits to select it and pop up the editor\r\n\t\t\t//\t\tdialog.\r\n\t\t\t// e: Object\r\n\t\t\t//\t\tThe double-click event.\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprotected.\r\n\t\t\tif(e && e.target){\r\n\t\t\t\tvar t = e.target;\r\n\t\t\t\tvar tg = t.tagName ? t.tagName.toLowerCase() : \"\";\r\n\t\t\t\tif(tg === this.tag && domAttr.get(t, \"src\")){\r\n\t\t\t\t\tvar editor = this.editor;\r\n\r\n\t\t\t\t\tthis.editor.selection.selectElement(t);\r\n\t\t\t\t\teditor.onDisplayChanged();\r\n\r\n\t\t\t\t\t// Call onNormalizedDisplayChange() now, rather than on timer.\r\n\t\t\t\t\t// On IE, when focus goes to the first <input> in the TooltipDialog, the editor loses it's selection.\r\n\t\t\t\t\t// Later if onNormalizedDisplayChange() gets called via the timer it will disable the LinkDialog button\r\n\t\t\t\t\t// (actually, all the toolbar buttons), at which point clicking the <input> will close the dialog,\r\n\t\t\t\t\t// since (for unknown reasons) focus.js ignores disabled controls.\r\n\t\t\t\t\tif(editor._updateTimer){\r\n\t\t\t\t\t\teditor._updateTimer.remove();\r\n\t\t\t\t\t\tdelete editor._updateTimer;\r\n\t\t\t\t\t}\r\n\t\t\t\t\teditor.onNormalizedDisplayChanged();\r\n\r\n\t\t\t\t\tvar button = this.button;\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t// Focus shift outside the event handler.\r\n\t\t\t\t\t\t// IE doesn't like focus changes in event handles.\r\n\t\t\t\t\t\tbutton.set(\"disabled\", false);\r\n\t\t\t\t\t\tbutton.loadAndOpenDropDown().then(function(){\r\n\t\t\t\t\t\t\tif(button.dropDown.focus){\r\n\t\t\t\t\t\t\t\tbutton.dropDown.focus();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 10);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Register these plugins\r\n\t_Plugin.registry[\"createLink\"] = function(){\r\n\t\treturn new LinkDialog({command: \"createLink\"});\r\n\t};\r\n\t_Plugin.registry[\"insertImage\"] = function(){\r\n\t\treturn new ImgLinkDialog({command: \"insertImage\"});\r\n\t};\r\n\r\n\r\n\t// Export both LinkDialog and ImgLinkDialog\r\n\t// TODO for 2.0: either return both classes in a hash, or split this file into two separate files.\r\n\t// Then the documentation for the module can be applied to the hash, and will show up in the API doc.\r\n\tLinkDialog.ImgLinkDialog = ImgLinkDialog;\r\n\treturn LinkDialog;\r\n});\r\n"]}