{"version":3,"sources":["_editor/plugins/Print.js"],"names":["define","declare","i18n","lang","has","focus","_Plugin","Button","Print","_initButton","strings","getLocalization","editor","this","button","label","ownerDocument","dir","showLabel","iconClass","iconClassPrefix","tabIndex","onClick","hitch","setEditor","onLoadDeferred","then","iframe","contentWindow","set","updateState","disabled","get","_print","edFrame","edDoc","document","content","win","window","open","write","close","i","styleNodes","getElementsByTagName","length","style","innerHTML","sNode","createElement","appendChild","createTextNode","print","registry","command"],"mappings":";;;;;;;AAAAA,QACC,qBACA,YACA,kBACA,aACA,cACA,aACA,oBACA,6BACE,SAASC,EAASC,EAAMC,EAAMC,EAAKC,EAAOC,EAASC,GAKrD,IAAIC,EAAQP,EAAQ,8BAA+BK,GAKlDG,YAAa,WAGZ,IAAIC,EAAUR,EAAKS,gBAAgB,gBAAiB,YACnDC,EAASC,KAAKD,OACfC,KAAKC,OAAS,IAAIP,GACjBQ,MAAOL,EAAe,MACtBM,cAAeJ,EAAOI,cACtBC,IAAKL,EAAOK,IACZd,KAAMS,EAAOT,KACbe,WAAW,EACXC,UAAWN,KAAKO,gBAAkB,IAAMP,KAAKO,gBAAkB,QAC/DC,SAAU,KACVC,QAASnB,EAAKoB,MAAMV,KAAM,aAI5BW,UAAW,SAA0BZ,GAKpCC,KAAKD,OAASA,EACdC,KAAKJ,cAILI,KAAKD,OAAOa,eAAeC,KAC1BvB,EAAKoB,MAAMV,KAAM,WACZA,KAAKD,OAAOe,OAAOC,cAAqB,OAC3Cf,KAAKC,OAAOe,IAAI,YAAY,OAMhCC,YAAa,WAGZ,IAAIC,EAAWlB,KAAKmB,IAAI,YACpBnB,KAAKD,OAAOe,OAAOC,cAAqB,QAC3CG,GAAW,GAEZlB,KAAKC,OAAOe,IAAI,WAAYE,IAG7BE,OAAQ,WAKP,IAAIC,EAAUrB,KAAKD,OAAOe,OAC1B,GAAGO,EAAQN,cAAqB,MAI/B,GAAIxB,EAAI,UAAaA,EAAI,UAGpB,CAIJ,IAAI+B,EAAQtB,KAAKD,OAAOwB,SACpBC,EAAUxB,KAAKD,OAAOoB,IAAI,SAC9BK,EAAU,gGAETA,EAAU,iBACX,IAAIC,EAAMC,OAAOC,KAAK,iBACrB,GACA,qFAEDF,EAAIF,SAASI,OACbF,EAAIF,SAASK,MAAMJ,GACnBC,EAAIF,SAASM,QAEb,IAIKC,EAJDC,EAAaT,EAAMU,qBAAqB,SAC5C,GAAGD,EAIF,IAAID,EAAI,EAAGA,EAAIC,EAAWE,OAAQH,IAAI,CACrC,IAAII,EAAQH,EAAWD,GAAGK,UACtBC,EAAQX,EAAIF,SAASc,cAAc,SACvCD,EAAME,YAAYb,EAAIF,SAASgB,eAAeL,IAC9CT,EAAIF,SAASS,qBAAqB,QAAQ,GAAGM,YAAYF,GAG3DX,EAAIe,QACJf,EAAII,aAhCJrC,EAAMA,MAAM6B,GACZA,EAAQN,cAAcyB,WA0C1B,OAJA/C,EAAQgD,SAAgB,MAAI,WAC3B,OAAO,IAAI9C,GAAO+C,QAAS,WAGrB/C","file":"../../../_editor/plugins/Print.js","sourcesContent":["define([\r\n\t\"dojo/_base/declare\", // declare\r\n\t\"dojo/i18n\", // i18n.getLocalization\r\n\t\"dojo/_base/lang\", // lang.hitch\r\n\t\"dojo/sniff\", // has(\"chrome\") has(\"opera\")\r\n\t\"../../focus\", // focus.focus()\r\n\t\"../_Plugin\",\r\n\t\"../../form/Button\",\r\n\t\"dojo/i18n!../nls/commands\"\r\n], function(declare, i18n, lang, has, focus, _Plugin, Button){\r\n\r\n\t// module:\r\n\t//\t\tdijit/_editor/plugins/Print\r\n\r\n\tvar Print = declare(\"dijit._editor.plugins.Print\", _Plugin, {\r\n\t\t// summary:\r\n\t\t//\t\tThis plugin provides Print capability to the editor.  When\r\n\t\t//\t\tclicked, the document in the editor frame will be printed.\r\n\r\n\t\t_initButton: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride for creation of the Print button.\r\n\t\t\tvar strings = i18n.getLocalization(\"dijit._editor\", \"commands\"),\r\n\t\t\t\teditor = this.editor;\r\n\t\t\tthis.button = new Button({\r\n\t\t\t\tlabel: strings[\"print\"],\r\n\t\t\t\townerDocument: editor.ownerDocument,\r\n\t\t\t\tdir: editor.dir,\r\n\t\t\t\tlang: editor.lang,\r\n\t\t\t\tshowLabel: false,\r\n\t\t\t\ticonClass: this.iconClassPrefix + \" \" + this.iconClassPrefix + \"Print\",\r\n\t\t\t\ttabIndex: \"-1\",\r\n\t\t\t\tonClick: lang.hitch(this, \"_print\")\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tsetEditor: function(/*dijit/Editor*/ editor){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tTell the plugin which Editor it is associated with.\r\n\t\t\t// editor: Object\r\n\t\t\t//\t\tThe editor object to attach the print capability to.\r\n\t\t\tthis.editor = editor;\r\n\t\t\tthis._initButton();\r\n\r\n\t\t\t// Set up a check that we have a print function\r\n\t\t\t// and disable button if we do not.\r\n\t\t\tthis.editor.onLoadDeferred.then(\r\n\t\t\t\tlang.hitch(this, function(){\r\n\t\t\t\t\tif(!this.editor.iframe.contentWindow[\"print\"]){\r\n\t\t\t\t\t\tthis.button.set(\"disabled\", true);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tupdateState: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tOver-ride for button state control for disabled to work.\r\n\t\t\tvar disabled = this.get(\"disabled\");\r\n\t\t\tif(!this.editor.iframe.contentWindow[\"print\"]){\r\n\t\t\t\tdisabled = true;\r\n\t\t\t}\r\n\t\t\tthis.button.set(\"disabled\", disabled);\r\n\t\t},\r\n\r\n\t\t_print: function(){\r\n\t\t\t// summary:\r\n\t\t\t//\t\tFunction to trigger printing of the editor document\r\n\t\t\t// tags:\r\n\t\t\t//\t\tprivate\r\n\t\t\tvar edFrame = this.editor.iframe;\r\n\t\t\tif(edFrame.contentWindow[\"print\"]){\r\n\t\t\t\t// IE requires the frame to be focused for\r\n\t\t\t\t// print to work, but since this is okay for all\r\n\t\t\t\t// no special casing.\r\n\t\t\t\tif(!has(\"opera\") && !has(\"chrome\")){\r\n\t\t\t\t\tfocus.focus(edFrame);\r\n\t\t\t\t\tedFrame.contentWindow.print();\r\n\t\t\t\t}else{\r\n\t\t\t\t\t// Neither Opera nor Chrome 3 et you print single frames.\r\n\t\t\t\t\t// So, open a new 'window', print it, and close it.\r\n\t\t\t\t\t// Also, can't use size 0x0, have to use 1x1\r\n\t\t\t\t\tvar edDoc = this.editor.document;\r\n\t\t\t\t\tvar content = this.editor.get(\"value\");\r\n\t\t\t\t\tcontent = \"<html><head><meta http-equiv='Content-Type' \" +\r\n\t\t\t\t\t\t\"content='text/html; charset='UTF-8'></head><body>\" +\r\n\t\t\t\t\t\tcontent + \"</body></html>\";\r\n\t\t\t\t\tvar win = window.open(\"javascript: ''\",\r\n\t\t\t\t\t\t\"\",\r\n\t\t\t\t\t\t\"status=0,menubar=0,location=0,toolbar=0,\" +\r\n\t\t\t\t\t\t\t\"width=1,height=1,resizable=0,scrollbars=0\");\r\n\t\t\t\t\twin.document.open();\r\n\t\t\t\t\twin.document.write(content);\r\n\t\t\t\t\twin.document.close();\r\n\r\n\t\t\t\t\tvar styleNodes = edDoc.getElementsByTagName(\"style\");\r\n\t\t\t\t\tif(styleNodes){\r\n\t\t\t\t\t\t// Clone over any editor view styles, since we can't print the iframe\r\n\t\t\t\t\t\t// directly.\r\n\t\t\t\t\t\tvar i;\r\n\t\t\t\t\t\tfor(i = 0; i < styleNodes.length; i++){\r\n\t\t\t\t\t\t\tvar style = styleNodes[i].innerHTML;\r\n\t\t\t\t\t\t\tvar sNode = win.document.createElement(\"style\");\r\n\t\t\t\t\t\t\tsNode.appendChild(win.document.createTextNode(style));\r\n\t\t\t\t\t\t\twin.document.getElementsByTagName(\"head\")[0].appendChild(sNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\twin.print();\r\n\t\t\t\t\twin.close();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\t// Register this plugin.\r\n\t_Plugin.registry[\"print\"] = function(){\r\n\t\treturn new Print({command: \"print\"});\r\n\t};\r\n\r\n\treturn Print;\r\n});\r\n"]}