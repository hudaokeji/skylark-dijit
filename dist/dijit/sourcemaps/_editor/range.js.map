{"version":3,"sources":["_editor/range.js"],"names":["define","array","declare","lang","rangeapi","getIndex","node","parent","pnode","n","ret","retR","onode","i","parentNode","childNodes","unshift","length","nodeType","previousSibling","nextSibling","o","r","getNode","index","isArray","every","getCommonAncestor","n1","n2","root","ownerDocument","body","getAncestors","as","n1as","n2as","m","Math","min","com","getAncestor","regex","name","nodeName","toUpperCase","test","BlockTagNames","getBlockAncestor","blockContainer","block","blockNode","atBeginningOfContainer","container","offset","atBeginning","offsetAtBeginning","nodeValue","substr","cnode","atEndOfContainer","atEnd","offsetAtEnd","adjacentNoneTextNode","startnode","next","len","prop","create","win","window","getSelection","document","createRange","W3CRange","ignoreUpdate","s","ie","selection","_getCurrentSelection","cachedSelection","this","_ranges","addRange","internal","push","_select","rangeCount","removeAllRanges","getRangeAt","type","decomposeControlRange","decomposeTextRange","_initCurrentRange","isCollapsed","collapsed","range","firstnode","item","lastnode","startContainer","endContainer","getEndPoint","end","atmrange","duplicate","collapse","startOffset","lastNode","cmpstr","parentElement","calOffset","moveToElementText","compareEndPoints","prevnode","firstChild","prevnodeobj","lenoffset","setEndPoint","text","nextnode","tempNode","insertBefore","createTextNode","removeChild","contentEditable","move","console","error","tmpary","endOffset","htmlText","setRange","start","constructor","arguments","setStart","setEnd","commonAncestorContainer","_updateInternal","parseInt","_cachedBookmark","setStartAfter","_setPoint","setStartBefore","setEndAfter","setEndBefore","what","ext","pop","_getIERange","_body","createTextRange","getBookmark","select","deleteContents","pasteHTML","cloneRange","detach","setObject"],"mappings":"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","file":"../../_editor/range.js","sourcesContent":["define([\r\n\t\"dojo/_base/array\", // array.every\r\n\t\"dojo/_base/declare\", // declare\r\n\t\"dojo/_base/lang\" // lang.isArray\r\n], function(array, declare, lang){\r\n\r\n\t// module:\r\n\t//\t\tdijit/_editor/range\r\n\r\n\tvar rangeapi = {\r\n\t\t// summary:\r\n\t\t//\t\tW3C range API\r\n\r\n\t\tgetIndex: function(/*DomNode*/ node, /*DomNode*/ parent){\r\n\t\t\tvar ret = [], retR = [];\r\n\t\t\tvar onode = node;\r\n\r\n\t\t\tvar pnode, n;\r\n\t\t\twhile(node != parent){\r\n\t\t\t\tvar i = 0;\r\n\t\t\t\tpnode = node.parentNode;\r\n\t\t\t\twhile((n = pnode.childNodes[i++])){\r\n\t\t\t\t\tif(n === node){\r\n\t\t\t\t\t\t--i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//if(i>=pnode.childNodes.length){\r\n\t\t\t\t//console.debug(\"Error finding index of a node in dijit/range.getIndex()\");\r\n\t\t\t\t//}\r\n\t\t\t\tret.unshift(i);\r\n\t\t\t\tretR.unshift(i - pnode.childNodes.length);\r\n\t\t\t\tnode = pnode;\r\n\t\t\t}\r\n\r\n\t\t\t//normalized() can not be called so often to prevent\r\n\t\t\t//invalidating selection/range, so we have to detect\r\n\t\t\t//here that any text nodes in a row\r\n\t\t\tif(ret.length > 0 && onode.nodeType == 3){\r\n\t\t\t\tn = onode.previousSibling;\r\n\t\t\t\twhile(n && n.nodeType == 3){\r\n\t\t\t\t\tret[ret.length - 1]--;\r\n\t\t\t\t\tn = n.previousSibling;\r\n\t\t\t\t}\r\n\t\t\t\tn = onode.nextSibling;\r\n\t\t\t\twhile(n && n.nodeType == 3){\r\n\t\t\t\t\tretR[retR.length - 1]++;\r\n\t\t\t\t\tn = n.nextSibling;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn {o: ret, r:retR};\r\n\t\t},\r\n\r\n\t\tgetNode: function(/*Array*/ index, /*DomNode*/ parent){\r\n\t\t\tif(!lang.isArray(index) || index.length == 0){\r\n\t\t\t\treturn parent;\r\n\t\t\t}\r\n\t\t\tvar node = parent;\r\n\t\t\t//\tif(!node)debugger\r\n\t\t\tarray.every(index, function(i){\r\n\t\t\t\tif(i >= 0 && i < node.childNodes.length){\r\n\t\t\t\t\tnode = node.childNodes[i];\r\n\t\t\t\t}else{\r\n\t\t\t\t\tnode = null;\r\n\t\t\t\t\t//console.debug('Error: can not find node with index',index,'under parent node',parent );\r\n\t\t\t\t\treturn false; //terminate array.every\r\n\t\t\t\t}\r\n\t\t\t\treturn true; //carry on the every loop\r\n\t\t\t});\r\n\r\n\t\t\treturn node;\r\n\t\t},\r\n\r\n\t\tgetCommonAncestor: function(n1, n2, root){\r\n\t\t\troot = root || n1.ownerDocument.body;\r\n\t\t\tvar getAncestors = function(n){\r\n\t\t\t\tvar as = [];\r\n\t\t\t\twhile(n){\r\n\t\t\t\t\tas.unshift(n);\r\n\t\t\t\t\tif(n !== root){\r\n\t\t\t\t\t\tn = n.parentNode;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn as;\r\n\t\t\t};\r\n\t\t\tvar n1as = getAncestors(n1);\r\n\t\t\tvar n2as = getAncestors(n2);\r\n\r\n\t\t\tvar m = Math.min(n1as.length, n2as.length);\r\n\t\t\tvar com = n1as[0]; //at least, one element should be in the array: the root (BODY by default)\r\n\t\t\tfor(var i = 1; i < m; i++){\r\n\t\t\t\tif(n1as[i] === n2as[i]){\r\n\t\t\t\t\tcom = n1as[i]\r\n\t\t\t\t}else{\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn com;\r\n\t\t},\r\n\r\n\t\tgetAncestor: function(/*DomNode*/ node, /*RegEx?*/ regex, /*DomNode?*/ root){\r\n\t\t\troot = root || node.ownerDocument.body;\r\n\t\t\twhile(node && node !== root){\r\n\t\t\t\tvar name = node.nodeName.toUpperCase();\r\n\t\t\t\tif(regex.test(name)){\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t},\r\n\r\n\t\tBlockTagNames: /^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,\r\n\r\n\t\tgetBlockAncestor: function(/*DomNode*/ node, /*RegEx?*/ regex, /*DomNode?*/ root){\r\n\t\t\troot = root || node.ownerDocument.body;\r\n\t\t\tregex = regex || rangeapi.BlockTagNames;\r\n\t\t\tvar block = null, blockContainer;\r\n\t\t\twhile(node && node !== root){\r\n\t\t\t\tvar name = node.nodeName.toUpperCase();\r\n\t\t\t\tif(!block && regex.test(name)){\r\n\t\t\t\t\tblock = node;\r\n\t\t\t\t}\r\n\t\t\t\tif(!blockContainer && (/^(?:BODY|TD|TH|CAPTION)$/).test(name)){\r\n\t\t\t\t\tblockContainer = node;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tnode = node.parentNode;\r\n\t\t\t}\r\n\t\t\treturn {blockNode:block, blockContainer:blockContainer || node.ownerDocument.body};\r\n\t\t},\r\n\r\n\t\tatBeginningOfContainer: function(/*DomNode*/ container, /*DomNode*/ node, /*Int*/ offset){\r\n\t\t\tvar atBeginning = false;\r\n\t\t\tvar offsetAtBeginning = (offset == 0);\r\n\t\t\tif(!offsetAtBeginning && node.nodeType == 3){ //if this is a text node, check whether the left part is all space\r\n\t\t\t\tif(/^[\\s\\xA0]+$/.test(node.nodeValue.substr(0, offset))){\r\n\t\t\t\t\toffsetAtBeginning = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(offsetAtBeginning){\r\n\t\t\t\tvar cnode = node;\r\n\t\t\t\tatBeginning = true;\r\n\t\t\t\twhile(cnode && cnode !== container){\r\n\t\t\t\t\tif(cnode.previousSibling){\r\n\t\t\t\t\t\tatBeginning = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcnode = cnode.parentNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn atBeginning;\r\n\t\t},\r\n\r\n\t\tatEndOfContainer: function(/*DomNode*/ container, /*DomNode*/ node, /*Int*/ offset){\r\n\t\t\tvar atEnd = false;\r\n\t\t\tvar offsetAtEnd = (offset == (node.length || node.childNodes.length));\r\n\t\t\tif(!offsetAtEnd && node.nodeType == 3){ //if this is a text node, check whether the right part is all space\r\n\t\t\t\tif(/^[\\s\\xA0]+$/.test(node.nodeValue.substr(offset))){\r\n\t\t\t\t\toffsetAtEnd = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(offsetAtEnd){\r\n\t\t\t\tvar cnode = node;\r\n\t\t\t\tatEnd = true;\r\n\t\t\t\twhile(cnode && cnode !== container){\r\n\t\t\t\t\tif(cnode.nextSibling){\r\n\t\t\t\t\t\tatEnd = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcnode = cnode.parentNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn atEnd;\r\n\t\t},\r\n\r\n\t\tadjacentNoneTextNode: function(startnode, next){\r\n\t\t\tvar node = startnode;\r\n\t\t\tvar len = (0 - startnode.length) || 0;\r\n\t\t\tvar prop = next ? 'nextSibling' : 'previousSibling';\r\n\t\t\twhile(node){\r\n\t\t\t\tif(node.nodeType != 3){\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tlen += node.length;\r\n\t\t\t\tnode = node[prop];\r\n\t\t\t}\r\n\t\t\treturn [node,len];\r\n\t\t},\r\n\r\n\t\tcreate: function(/*Window?*/ win){\t// TODO: for 2.0, replace optional window param w/mandatory window or document param\r\n\t\t\twin = win || window;\r\n\t\t\tif(win.getSelection){\r\n\t\t\t\treturn win.document.createRange();\r\n\t\t\t}else{//IE\r\n\t\t\t\treturn new W3CRange();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgetSelection: function(/*Window*/ window, /*Boolean?*/ ignoreUpdate){\r\n\t\t\tif(window.getSelection){\r\n\t\t\t\treturn window.getSelection();\r\n\t\t\t}else{//IE\r\n\t\t\t\tvar s = new ie.selection(window);\r\n\t\t\t\tif(!ignoreUpdate){\r\n\t\t\t\t\ts._getCurrentSelection();\r\n\t\t\t\t}\r\n\t\t\t\treturn s;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// TODO: convert to has() test?   But remember IE9 issues with quirks vs. standards in main frame vs. iframe.\r\n\tif(!window.getSelection){\r\n\t\tvar ie = rangeapi.ie = {\r\n\t\t\tcachedSelection: {},\r\n\t\t\tselection: function(window){\r\n\t\t\t\tthis._ranges = [];\r\n\t\t\t\tthis.addRange = function(r, /*boolean*/ internal){\r\n\t\t\t\t\tthis._ranges.push(r);\r\n\t\t\t\t\tif(!internal){\r\n\t\t\t\t\t\tr._select();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.rangeCount = this._ranges.length;\r\n\t\t\t\t};\r\n\t\t\t\tthis.removeAllRanges = function(){\r\n\t\t\t\t\t//don't detach, the range may be used later\r\n\t\t\t\t\t//\t\t\t\tfor(var i=0;i<this._ranges.length;i++){\r\n\t\t\t\t\t//\t\t\t\t\tthis._ranges[i].detach();\r\n\t\t\t\t\t//\t\t\t\t}\r\n\t\t\t\t\tthis._ranges = [];\r\n\t\t\t\t\tthis.rangeCount = 0;\r\n\t\t\t\t};\r\n\t\t\t\tvar _initCurrentRange = function(){\r\n\t\t\t\t\tvar r = window.document.selection.createRange();\r\n\t\t\t\t\tvar type = window.document.selection.type.toUpperCase();\r\n\t\t\t\t\tif(type == \"CONTROL\"){\r\n\t\t\t\t\t\t//TODO: multiple range selection(?)\r\n\t\t\t\t\t\treturn new W3CRange(ie.decomposeControlRange(r));\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn new W3CRange(ie.decomposeTextRange(r));\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tthis.getRangeAt = function(i){\r\n\t\t\t\t\treturn this._ranges[i];\r\n\t\t\t\t};\r\n\t\t\t\tthis._getCurrentSelection = function(){\r\n\t\t\t\t\tthis.removeAllRanges();\r\n\t\t\t\t\tvar r = _initCurrentRange();\r\n\t\t\t\t\tif(r){\r\n\t\t\t\t\t\tthis.addRange(r, true);\r\n\t\t\t\t\t\tthis.isCollapsed = r.collapsed;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.isCollapsed = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tdecomposeControlRange: function(range){\r\n\t\t\t\tvar firstnode = range.item(0), lastnode = range.item(range.length - 1);\r\n\t\t\t\tvar startContainer = firstnode.parentNode, endContainer = lastnode.parentNode;\r\n\t\t\t\tvar startOffset = rangeapi.getIndex(firstnode, startContainer).o[0];\r\n\t\t\t\tvar endOffset = rangeapi.getIndex(lastnode, endContainer).o[0] + 1;\r\n\t\t\t\treturn [startContainer, startOffset,endContainer, endOffset];\r\n\t\t\t},\r\n\t\t\tgetEndPoint: function(range, end){\r\n\t\t\t\tvar atmrange = range.duplicate();\r\n\t\t\t\tatmrange.collapse(!end);\r\n\t\t\t\tvar cmpstr = 'EndTo' + (end ? 'End' : 'Start');\r\n\t\t\t\tvar parentNode = atmrange.parentElement();\r\n\r\n\t\t\t\tvar startnode, startOffset, lastNode;\r\n\t\t\t\tif(parentNode.childNodes.length > 0){\r\n\t\t\t\t\tarray.every(parentNode.childNodes, function(node, i){\r\n\t\t\t\t\t\tvar calOffset;\r\n\t\t\t\t\t\tif(node.nodeType != 3){\r\n\t\t\t\t\t\t\tatmrange.moveToElementText(node);\r\n\r\n\t\t\t\t\t\t\tif(atmrange.compareEndPoints(cmpstr, range) > 0){\r\n\t\t\t\t\t\t\t\t//startnode = node.previousSibling;\r\n\t\t\t\t\t\t\t\tif(lastNode && lastNode.nodeType == 3){\r\n\t\t\t\t\t\t\t\t\t//where shall we put the start? in the text node or after?\r\n\t\t\t\t\t\t\t\t\tstartnode = lastNode;\r\n\t\t\t\t\t\t\t\t\tcalOffset = true;\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tstartnode = parentNode;\r\n\t\t\t\t\t\t\t\t\tstartOffset = i;\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tif(i == parentNode.childNodes.length - 1){\r\n\t\t\t\t\t\t\t\t\tstartnode = parentNode;\r\n\t\t\t\t\t\t\t\t\tstartOffset = parentNode.childNodes.length;\r\n\t\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tif(i == parentNode.childNodes.length - 1){//at the end of this node\r\n\t\t\t\t\t\t\t\tstartnode = node;\r\n\t\t\t\t\t\t\t\tcalOffset = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//\t\t\ttry{\r\n\t\t\t\t\t\tif(calOffset && startnode){\r\n\t\t\t\t\t\t\tvar prevnode = rangeapi.adjacentNoneTextNode(startnode)[0];\r\n\t\t\t\t\t\t\tif(prevnode){\r\n\t\t\t\t\t\t\t\tstartnode = prevnode.nextSibling;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tstartnode = parentNode.firstChild; //firstChild must be a text node\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar prevnodeobj = rangeapi.adjacentNoneTextNode(startnode);\r\n\t\t\t\t\t\t\tprevnode = prevnodeobj[0];\r\n\t\t\t\t\t\t\tvar lenoffset = prevnodeobj[1];\r\n\t\t\t\t\t\t\tif(prevnode){\r\n\t\t\t\t\t\t\t\tatmrange.moveToElementText(prevnode);\r\n\t\t\t\t\t\t\t\tatmrange.collapse(false);\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tatmrange.moveToElementText(parentNode);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tatmrange.setEndPoint(cmpstr, range);\r\n\t\t\t\t\t\t\tstartOffset = atmrange.text.length - lenoffset;\r\n\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//\t\t\t}catch(e){ debugger }\r\n\t\t\t\t\t\tlastNode = node;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}else{\r\n\t\t\t\t\tstartnode = parentNode;\r\n\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//if at the end of startnode and we are dealing with start container, then\r\n\t\t\t\t//move the startnode to nextSibling if it is a text node\r\n\t\t\t\t//TODO: do this for end container?\r\n\t\t\t\tif(!end && startnode.nodeType == 1 && startOffset == startnode.childNodes.length){\r\n\t\t\t\t\tvar nextnode = startnode.nextSibling;\r\n\t\t\t\t\tif(nextnode && nextnode.nodeType == 3){\r\n\t\t\t\t\t\tstartnode = nextnode;\r\n\t\t\t\t\t\tstartOffset = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn [startnode, startOffset];\r\n\t\t\t},\r\n\t\t\tsetEndPoint: function(range, container, offset){\r\n\t\t\t\t//text node\r\n\t\t\t\tvar atmrange = range.duplicate(), node, len;\r\n\t\t\t\tif(container.nodeType != 3){ //normal node\r\n\t\t\t\t\tif(offset > 0){\r\n\t\t\t\t\t\tnode = container.childNodes[offset - 1];\r\n\t\t\t\t\t\tif(node){\r\n\t\t\t\t\t\t\tif(node.nodeType == 3){\r\n\t\t\t\t\t\t\t\tcontainer = node;\r\n\t\t\t\t\t\t\t\toffset = node.length;\r\n\t\t\t\t\t\t\t\t//pass through\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\tif(node.nextSibling && node.nextSibling.nodeType == 3){\r\n\t\t\t\t\t\t\t\t\tcontainer = node.nextSibling;\r\n\t\t\t\t\t\t\t\t\toffset = 0;\r\n\t\t\t\t\t\t\t\t\t//pass through\r\n\t\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\t\tatmrange.moveToElementText(node.nextSibling ? node : container);\r\n\t\t\t\t\t\t\t\t\tvar parent = node.parentNode;\r\n\t\t\t\t\t\t\t\t\tvar tempNode = parent.insertBefore(node.ownerDocument.createTextNode(' '), node.nextSibling);\r\n\t\t\t\t\t\t\t\t\tatmrange.collapse(false);\r\n\t\t\t\t\t\t\t\t\tparent.removeChild(tempNode);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tatmrange.moveToElementText(container);\r\n\t\t\t\t\t\tatmrange.collapse(true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(container.nodeType == 3){\r\n\t\t\t\t\tvar prevnodeobj = rangeapi.adjacentNoneTextNode(container);\r\n\t\t\t\t\tvar prevnode = prevnodeobj[0];\r\n\t\t\t\t\tlen = prevnodeobj[1];\r\n\t\t\t\t\tif(prevnode){\r\n\t\t\t\t\t\tatmrange.moveToElementText(prevnode);\r\n\t\t\t\t\t\tatmrange.collapse(false);\r\n\t\t\t\t\t\t//if contentEditable is not inherit, the above collapse won't make the end point\r\n\t\t\t\t\t\t//in the correctly position: it always has a -1 offset, so compensate it\r\n\t\t\t\t\t\tif(prevnode.contentEditable != 'inherit'){\r\n\t\t\t\t\t\t\tlen++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tatmrange.moveToElementText(container.parentNode);\r\n\t\t\t\t\t\tatmrange.collapse(true);\r\n\r\n\t\t\t\t\t\t// Correct internal cursor position\r\n\t\t\t\t\t\t// http://bugs.dojotoolkit.org/ticket/15578\r\n\t\t\t\t\t\tatmrange.move('character', 1);\r\n\t\t\t\t\t\tatmrange.move('character', -1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toffset += len;\r\n\t\t\t\t\tif(offset > 0){\r\n\t\t\t\t\t\tif(atmrange.move('character', offset) != offset){\r\n\t\t\t\t\t\t\tconsole.error('Error when moving!');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn atmrange;\r\n\t\t\t},\r\n\t\t\tdecomposeTextRange: function(range){\r\n\t\t\t\tvar tmpary = ie.getEndPoint(range);\r\n\t\t\t\tvar startContainer = tmpary[0], startOffset = tmpary[1];\r\n\t\t\t\tvar endContainer = tmpary[0], endOffset = tmpary[1];\r\n\r\n\t\t\t\tif(range.htmlText.length){\r\n\t\t\t\t\tif(range.htmlText == range.text){ //in the same text node\r\n\t\t\t\t\t\tendOffset = startOffset + range.text.length;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\ttmpary = ie.getEndPoint(range, true);\r\n\t\t\t\t\t\tendContainer = tmpary[0],endOffset = tmpary[1];\r\n\t\t\t\t\t\t//\t\t\t\t\tif(startContainer.tagName == \"BODY\"){\r\n\t\t\t\t\t\t//\t\t\t\t\t\tstartContainer = startContainer.firstChild;\r\n\t\t\t\t\t\t//\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn [startContainer, startOffset, endContainer, endOffset];\r\n\t\t\t},\r\n\t\t\tsetRange: function(range, startContainer, startOffset, endContainer, endOffset, collapsed){\r\n\t\t\t\tvar start = ie.setEndPoint(range, startContainer, startOffset);\r\n\r\n\t\t\t\trange.setEndPoint('StartToStart', start);\r\n\t\t\t\tif(!collapsed){\r\n\t\t\t\t\tvar end = ie.setEndPoint(range, endContainer, endOffset);\r\n\t\t\t\t}\r\n\t\t\t\trange.setEndPoint('EndToEnd', end || start);\r\n\r\n\t\t\t\treturn range;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar W3CRange = rangeapi.W3CRange = declare(null, {\r\n\t\t\tconstructor: function(){\r\n\t\t\t\tif(arguments.length>0){\r\n\t\t\t\t\tthis.setStart(arguments[0][0],arguments[0][1]);\r\n\t\t\t\t\tthis.setEnd(arguments[0][2],arguments[0][3]);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.commonAncestorContainer = null;\r\n\t\t\t\t\tthis.startContainer = null;\r\n\t\t\t\t\tthis.startOffset = 0;\r\n\t\t\t\t\tthis.endContainer = null;\r\n\t\t\t\t\tthis.endOffset = 0;\r\n\t\t\t\t\tthis.collapsed = true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t_updateInternal: function(){\r\n\t\t\t\tif(this.startContainer !== this.endContainer){\r\n\t\t\t\t\tthis.commonAncestorContainer = rangeapi.getCommonAncestor(this.startContainer, this.endContainer);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.commonAncestorContainer = this.startContainer;\r\n\t\t\t\t}\r\n\t\t\t\tthis.collapsed = (this.startContainer === this.endContainer) && (this.startOffset == this.endOffset);\r\n\t\t\t},\r\n\t\t\tsetStart: function(node, offset){\r\n\t\t\t\toffset=parseInt(offset);\r\n\t\t\t\tif(this.startContainer === node && this.startOffset == offset){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdelete this._cachedBookmark;\r\n\r\n\t\t\t\tthis.startContainer = node;\r\n\t\t\t\tthis.startOffset = offset;\r\n\t\t\t\tif(!this.endContainer){\r\n\t\t\t\t\tthis.setEnd(node, offset);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._updateInternal();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsetEnd: function(node, offset){\r\n\t\t\t\toffset=parseInt(offset);\r\n\t\t\t\tif(this.endContainer === node && this.endOffset == offset){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdelete this._cachedBookmark;\r\n\r\n\t\t\t\tthis.endContainer = node;\r\n\t\t\t\tthis.endOffset = offset;\r\n\t\t\t\tif(!this.startContainer){\r\n\t\t\t\t\tthis.setStart(node, offset);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis._updateInternal();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsetStartAfter: function(node, offset){\r\n\t\t\t\tthis._setPoint('setStart', node, offset, 1);\r\n\t\t\t},\r\n\t\t\tsetStartBefore: function(node, offset){\r\n\t\t\t\tthis._setPoint('setStart', node, offset, 0);\r\n\t\t\t},\r\n\t\t\tsetEndAfter: function(node, offset){\r\n\t\t\t\tthis._setPoint('setEnd', node, offset, 1);\r\n\t\t\t},\r\n\t\t\tsetEndBefore: function(node, offset){\r\n\t\t\t\tthis._setPoint('setEnd', node, offset, 0);\r\n\t\t\t},\r\n\t\t\t_setPoint: function(what, node, offset, ext){\r\n\t\t\t\tvar index = rangeapi.getIndex(node, node.parentNode).o;\r\n\t\t\t\tthis[what](node.parentNode, index.pop()+ext);\r\n\t\t\t},\r\n\t\t\t_getIERange: function(){\r\n\t\t\t\tvar r = (this._body || this.endContainer.ownerDocument.body).createTextRange();\r\n\t\t\t\tie.setRange(r, this.startContainer, this.startOffset, this.endContainer, this.endOffset, this.collapsed);\r\n\t\t\t\treturn r;\r\n\t\t\t},\r\n\t\t\tgetBookmark: function(){\r\n\t\t\t\tthis._getIERange();\r\n\t\t\t\treturn this._cachedBookmark;\r\n\t\t\t},\r\n\t\t\t_select: function(){\r\n\t\t\t\tvar r = this._getIERange();\r\n\t\t\t\tr.select();\r\n\t\t\t},\r\n\t\t\tdeleteContents: function(){\r\n\t\t\t\tvar s = this.startContainer, r = this._getIERange();\r\n\t\t\t\tif(s.nodeType === 3 && !this.startOffset){\r\n\t\t\t\t\t//if the range starts at the beginning of a\r\n\t\t\t\t\t//text node, move it to before the textnode\r\n\t\t\t\t\t//to make sure the range is still valid\r\n\t\t\t\t\t//after deleteContents() finishes\r\n\t\t\t\t\tthis.setStartBefore(s);\r\n\t\t\t\t}\r\n\t\t\t\tr.pasteHTML('');\r\n\t\t\t\tthis.endContainer = this.startContainer;\r\n\t\t\t\tthis.endOffset = this.startOffset;\r\n\t\t\t\tthis.collapsed = true;\r\n\t\t\t},\r\n\t\t\tcloneRange: function(){\r\n\t\t\t\tvar r = new W3CRange([this.startContainer,this.startOffset,\r\n\t\t\t\t\tthis.endContainer,this.endOffset]);\r\n\t\t\t\tr._body = this._body;\r\n\t\t\t\treturn r;\r\n\t\t\t},\r\n\t\t\tdetach: function(){\r\n\t\t\t\tthis._body = null;\r\n\t\t\t\tthis.commonAncestorContainer = null;\r\n\t\t\t\tthis.startContainer = null;\r\n\t\t\t\tthis.startOffset = 0;\r\n\t\t\t\tthis.endContainer = null;\r\n\t\t\t\tthis.endOffset = 0;\r\n\t\t\t\tthis.collapsed = true;\r\n\t\t\t}\r\n\t\t});\r\n\t} //if(!window.getSelection)\r\n\r\n\t// remove for 2.0\r\n\tlang.setObject(\"dijit.range\", rangeapi);\r\n\r\n\treturn rangeapi;\r\n});\r\n"]}