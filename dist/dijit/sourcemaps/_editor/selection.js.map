{"version":3,"sources":["_editor/selection.js"],"names":["define","dom","lang","has","win","dijit","selection","getType","doc","getSelection","oSel","stype","global","e","rangeCount","oRange","getRangeAt","startContainer","endContainer","endOffset","startOffset","nodeType","type","toLowerCase","getSelectedText","toString","_editor","createRange","text","getSelectedHtml","i","html","frag","cloneContents","div","createElement","appendChild","innerHTML","htmlText","getSelectedElement","anchorNode","childNodes","anchorOffset","range","item","getParentElement","p","this","parentNode","r","collapse","parentElement","node","hasAncestorElement","tagName","getAncestorElement","apply","arguments","getParentOfType","isTag","tags","_nlc","length","_tlc","String","beginning","removeAllRanges","collapseToStart","collapseToEnd","select","remove","sel","deleteFromDocument","clear","selectElementChildren","element","nochangefocus","byId","setStart","setEnd","addRange","selectAllChildren","ownerDocument","body","createTextRange","moveToElementText","selectElement","selectNode","tg","createControlRange","addElement","inSelection","newRange","compareBoundaryPoints","START_TO_END","e1","e2","compareEndPoints","setObject"],"mappings":"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","file":"../../_editor/selection.js","sourcesContent":["define([\r\n\t\"dojo/dom\", // dom.byId\r\n\t\"dojo/_base/lang\",\r\n\t\"dojo/sniff\", // has(\"ie\") has(\"opera\")\r\n\t\"dojo/_base/window\", // win.body win.doc win.doc.createElement win.doc.selection win.doc.selection.createRange win.doc.selection.type.toLowerCase win.global win.global.getSelection\r\n\t\"../main\"\t\t// for exporting symbols to dijit._editor.selection\r\n], function(dom, lang, has, win, dijit){\r\n\r\n// module:\r\n//\t\tdijit/_editor/selection\r\n\r\nvar selection = {\r\n\t// summary:\r\n\t//\t\tDeprecated text selection API.  Will be removed in 2.0.  New code should use dijit/selection.\r\n\r\n\tgetType: function(){\r\n\t\t// summary:\r\n\t\t//\t\tGet the selection type (like win.doc.select.type in IE).\r\n\t\tif(win.doc.getSelection){\r\n\t\t\t// W3C path\r\n\t\t\tvar stype = \"text\";\r\n\r\n\t\t\t// Check if the actual selection is a CONTROL (IMG, TABLE, HR, etc...).\r\n\t\t\tvar oSel;\r\n\t\t\ttry{\r\n\t\t\t\toSel = win.global.getSelection();\r\n\t\t\t}catch(e){ /*squelch*/ }\r\n\r\n\t\t\tif(oSel && oSel.rangeCount == 1){\r\n\t\t\t\tvar oRange = oSel.getRangeAt(0);\r\n\t\t\t\tif(\t(oRange.startContainer == oRange.endContainer) &&\r\n\t\t\t\t\t((oRange.endOffset - oRange.startOffset) == 1) &&\r\n\t\t\t\t\t(oRange.startContainer.nodeType != 3 /* text node*/)\r\n\t\t\t\t){\r\n\t\t\t\t\tstype = \"control\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn stype; //String\r\n\t\t}else{\r\n\t\t\t// IE6-8\r\n\t\t\treturn win.doc.selection.type.toLowerCase();\r\n\t\t}\r\n\t},\r\n\r\n\tgetSelectedText: function(){\r\n\t\t// summary:\r\n\t\t//\t\tReturn the text (no html tags) included in the current selection or null if no text is selected\r\n\t\tif(win.doc.getSelection){\r\n\t\t\t// W3C path\r\n\t\t\tvar selection = win.global.getSelection();\r\n\t\t\treturn selection ? selection.toString() : \"\"; //String\r\n\t\t}else{\r\n\t\t\t// IE6-8\r\n\t\t\tif(dijit._editor.selection.getType() == 'control'){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\treturn win.doc.selection.createRange().text;\r\n\t\t}\r\n\t},\r\n\r\n\tgetSelectedHtml: function(){\r\n\t\t// summary:\r\n\t\t//\t\tReturn the html text of the current selection or null if unavailable\r\n\t\tif(win.doc.getSelection){\r\n\t\t\t// W3C path\r\n\t\t\tvar selection = win.global.getSelection();\r\n\t\t\tif(selection && selection.rangeCount){\r\n\t\t\t\tvar i;\r\n\t\t\t\tvar html = \"\";\r\n\t\t\t\tfor(i = 0; i < selection.rangeCount; i++){\r\n\t\t\t\t\t//Handle selections spanning ranges, such as Opera\r\n\t\t\t\t\tvar frag = selection.getRangeAt(i).cloneContents();\r\n\t\t\t\t\tvar div = win.doc.createElement(\"div\");\r\n\t\t\t\t\tdiv.appendChild(frag);\r\n\t\t\t\t\thtml += div.innerHTML;\r\n\t\t\t\t}\r\n\t\t\t\treturn html; //String\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}else{\r\n\t\t\t// IE6-8\r\n\t\t\tif(dijit._editor.selection.getType() == 'control'){\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\treturn win.doc.selection.createRange().htmlText;\r\n\t\t}\r\n\t},\r\n\r\n\tgetSelectedElement: function(){\r\n\t\t// summary:\r\n\t\t//\t\tRetrieves the selected element (if any), just in the case that\r\n\t\t//\t\ta single element (object like and image or a table) is\r\n\t\t//\t\tselected.\r\n\t\tif(dijit._editor.selection.getType() == \"control\"){\r\n\t\t\tif(win.doc.getSelection){\r\n\t\t\t\t// W3C path\r\n\t\t\t\tvar selection = win.global.getSelection();\r\n\t\t\t\treturn selection.anchorNode.childNodes[ selection.anchorOffset ];\r\n\t\t\t}else{\r\n\t\t\t\t// IE6-8\r\n\t\t\t\tvar range = win.doc.selection.createRange();\r\n\t\t\t\tif(range && range.item){\r\n\t\t\t\t\treturn win.doc.selection.createRange().item(0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tgetParentElement: function(){\r\n\t\t// summary:\r\n\t\t//\t\tGet the parent element of the current selection\r\n\t\tif(dijit._editor.selection.getType() == \"control\"){\r\n\t\t\tvar p = this.getSelectedElement();\r\n\t\t\tif(p){ return p.parentNode; }\r\n\t\t}else{\r\n\t\t\tif(win.doc.getSelection){\r\n\t\t\t\tvar selection = win.global.getSelection();\r\n\t\t\t\tif(selection){\r\n\t\t\t\t\tvar node = selection.anchorNode;\r\n\t\t\t\t\twhile(node && (node.nodeType != 1)){ // not an element\r\n\t\t\t\t\t\tnode = node.parentNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn node;\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tvar r = win.doc.selection.createRange();\r\n\t\t\t\tr.collapse(true);\r\n\t\t\t\treturn r.parentElement();\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\thasAncestorElement: function(/*String*/ tagName /* ... */){\r\n\t\t// summary:\r\n\t\t//\t\tCheck whether current selection has a  parent element which is\r\n\t\t//\t\tof type tagName (or one of the other specified tagName)\r\n\t\t// tagName: String\r\n\t\t//\t\tThe tag name to determine if it has an ancestor of.\r\n\t\treturn this.getAncestorElement.apply(this, arguments) != null; //Boolean\r\n\t},\r\n\r\n\tgetAncestorElement: function(/*String*/ tagName /* ... */){\r\n\t\t// summary:\r\n\t\t//\t\tReturn the parent element of the current selection which is of\r\n\t\t//\t\ttype tagName (or one of the other specified tagName)\r\n\t\t// tagName: String\r\n\t\t//\t\tThe tag name to determine if it has an ancestor of.\r\n\t\tvar node = this.getSelectedElement() || this.getParentElement();\r\n\t\treturn this.getParentOfType(node, arguments); //DOMNode\r\n\t},\r\n\r\n\tisTag: function(/*DomNode*/ node, /*String[]*/ tags){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to determine if a node is one of an array of tags.\r\n\t\t// node:\r\n\t\t//\t\tThe node to inspect.\r\n\t\t// tags:\r\n\t\t//\t\tAn array of tag name strings to check to see if the node matches.\r\n\t\tif(node && node.tagName){\r\n\t\t\tvar _nlc = node.tagName.toLowerCase();\r\n\t\t\tfor(var i=0; i<tags.length; i++){\r\n\t\t\t\tvar _tlc = String(tags[i]).toLowerCase();\r\n\t\t\t\tif(_nlc == _tlc){\r\n\t\t\t\t\treturn _tlc; // String\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn \"\";\r\n\t},\r\n\r\n\tgetParentOfType: function(/*DomNode*/ node, /*String[]*/ tags){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to locate a parent node that matches one of a set of tags\r\n\t\t// node:\r\n\t\t//\t\tThe node to inspect.\r\n\t\t// tags:\r\n\t\t//\t\tAn array of tag name strings to check to see if the node matches.\r\n\t\twhile(node){\r\n\t\t\tif(this.isTag(node, tags).length){\r\n\t\t\t\treturn node; // DOMNode\r\n\t\t\t}\r\n\t\t\tnode = node.parentNode;\r\n\t\t}\r\n\t\treturn null;\r\n\t},\r\n\r\n\tcollapse: function(/*Boolean*/ beginning){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to collapse (clear), the current selection\r\n\t\t// beginning: Boolean\r\n\t\t//\t\tIndicates whether to collapse the cursor to the beginning of the selection or end.\r\n\t\tif(win.doc.getSelection){\r\n\t\t\t// W3C path\r\n\t\t\tvar selection = win.global.getSelection();\r\n\t\t\tif(selection.removeAllRanges){ // Mozilla\r\n\t\t\t\tif(beginning){\r\n\t\t\t\t\tselection.collapseToStart();\r\n\t\t\t\t}else{\r\n\t\t\t\t\tselection.collapseToEnd();\r\n\t\t\t\t}\r\n\t\t\t}else{ // Safari\r\n\t\t\t\t// pulled from WebCore/ecma/kjs_window.cpp, line 2536\r\n\t\t\t\tselection.collapse(beginning);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t// IE6-8\r\n\t\t\tvar range = win.doc.selection.createRange();\r\n\t\t\trange.collapse(beginning);\r\n\t\t\trange.select();\r\n\t\t}\r\n\t},\r\n\r\n\tremove: function(){\r\n\t\t// summary:\r\n\t\t//\t\tFunction to delete the currently selected content from the document.\r\n\t\tvar sel = win.doc.selection;\r\n\t\tif(win.doc.getSelection){\r\n\t\t\t// W3C path\r\n\t\t\tsel = win.global.getSelection();\r\n\t\t\tsel.deleteFromDocument();\r\n\t\t\treturn sel; //Selection\r\n\t\t}else{\r\n\t\t\t// IE6-8\r\n\t\t\tif(sel.type.toLowerCase() != \"none\"){\r\n\t\t\t\tsel.clear();\r\n\t\t\t}\r\n\t\t\treturn sel; //Selection\r\n\t\t}\r\n\t},\r\n\r\n\tselectElementChildren: function(/*DomNode*/ element, /*Boolean?*/ nochangefocus){\r\n\t\t// summary:\r\n\t\t//\t\tclear previous selection and select the content of the node\r\n\t\t//\t\t(excluding the node itself)\r\n\t\t// element: DOMNode\r\n\t\t//\t\tThe element you wish to select the children content of.\r\n\t\t// nochangefocus: Boolean\r\n\t\t//\t\tIndicates if the focus should change or not.\r\n\t\tvar doc = win.doc;\r\n\t\tvar range;\r\n\t\telement = dom.byId(element);\r\n\t\tif(win.doc.getSelection){\r\n\t\t\t// W3C\r\n\t\t\tvar selection = win.global.getSelection();\r\n\t\t\tif(has(\"opera\")){\r\n\t\t\t\t//Opera's selectAllChildren doesn't seem to work right\r\n\t\t\t\t//against <body> nodes and possibly others ... so\r\n\t\t\t\t//we use the W3C range API\r\n\t\t\t\tif(selection.rangeCount){\r\n\t\t\t\t\trange = selection.getRangeAt(0);\r\n\t\t\t\t}else{\r\n\t\t\t\t\trange = doc.createRange();\r\n\t\t\t\t}\r\n\t\t\t\trange.setStart(element, 0);\r\n\t\t\t\trange.setEnd(element,(element.nodeType == 3) ? element.length : element.childNodes.length);\r\n\t\t\t\tselection.addRange(range);\r\n\t\t\t}else{\r\n\t\t\t\tselection.selectAllChildren(element);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t// IE6-8\r\n\t\t\trange = element.ownerDocument.body.createTextRange();\r\n\t\t\trange.moveToElementText(element);\r\n\t\t\tif(!nochangefocus){\r\n\t\t\t\ttry{\r\n\t\t\t\t\trange.select(); // IE throws an exception here if the widget is hidden.  See #5439\r\n\t\t\t\t}catch(e){ /* squelch */}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tselectElement: function(/*DomNode*/ element, /*Boolean?*/ nochangefocus){\r\n\t\t// summary:\r\n\t\t//\t\tclear previous selection and select element (including all its children)\r\n\t\t// element: DOMNode\r\n\t\t//\t\tThe element to select.\r\n\t\t// nochangefocus: Boolean\r\n\t\t//\t\tBoolean indicating if the focus should be changed.  IE only.\r\n\t\tvar range;\r\n\t\telement = dom.byId(element);\t// TODO: remove for 2.0 or sooner, spec listed above doesn't allow for string\r\n\t\tvar doc = element.ownerDocument;\r\n\t\tvar global = win.global;\t// TODO: use winUtils.get(doc)?\r\n\t\tif(doc.getSelection){\r\n\t\t\t// W3C path\r\n\t\t\tvar selection = global.getSelection();\r\n\t\t\trange = doc.createRange();\r\n\t\t\tif(selection.removeAllRanges){ // Mozilla\r\n\t\t\t\t// FIXME: does this work on Safari?\r\n\t\t\t\tif(has(\"opera\")){\r\n\t\t\t\t\t//Opera works if you use the current range on\r\n\t\t\t\t\t//the selection if present.\r\n\t\t\t\t\tif(selection.getRangeAt(0)){\r\n\t\t\t\t\t\trange = selection.getRangeAt(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\trange.selectNode(element);\r\n\t\t\t\tselection.removeAllRanges();\r\n\t\t\t\tselection.addRange(range);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\t// IE6-8\r\n\t\t\ttry{\r\n\t\t\t\tvar tg = element.tagName ? element.tagName.toLowerCase() : \"\";\r\n\t\t\t\tif(tg === \"img\" || tg === \"table\"){\r\n\t\t\t\t\trange = win.body(doc).createControlRange();\r\n\t\t\t\t}else{\r\n\t\t\t\t\trange = win.body(doc).createRange();\r\n\t\t\t\t}\r\n\t\t\t\trange.addElement(element);\r\n\t\t\t\tif(!nochangefocus){\r\n\t\t\t\t\trange.select();\r\n\t\t\t\t}\r\n\t\t\t}catch(e){\r\n\t\t\t\tthis.selectElementChildren(element, nochangefocus);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tinSelection: function(node){\r\n\t\t// summary:\r\n\t\t//\t\tThis function determines if 'node' is\r\n\t\t//\t\tin the current selection.\r\n\t\t// tags:\r\n\t\t//\t\tpublic\r\n\t\tif(node){\r\n\t\t\tvar newRange;\r\n\t\t\tvar doc = win.doc;\r\n\t\t\tvar range;\r\n\r\n\t\t\tif(win.doc.getSelection){\r\n\t\t\t\t// WC3\r\n\t\t\t\tvar sel = win.global.getSelection();\r\n\t\t\t\tif(sel && sel.rangeCount > 0){\r\n\t\t\t\t\trange = sel.getRangeAt(0);\r\n\t\t\t\t}\r\n\t\t\t\tif(range && range.compareBoundaryPoints && doc.createRange){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tnewRange = doc.createRange();\r\n\t\t\t\t\t\tnewRange.setStart(node, 0);\r\n\t\t\t\t\t\tif(range.compareBoundaryPoints(range.START_TO_END, newRange) === 1){\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}catch(e){ /* squelch */}\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\t// IE6-8, so we can't use the range object as the pseudo\r\n\t\t\t\t// range doesn't implement the boundary checking, we have to\r\n\t\t\t\t// use IE specific crud.\r\n\t\t\t\trange = doc.selection.createRange();\r\n\t\t\t\ttry{\r\n\t\t\t\t\tnewRange = node.ownerDocument.body.createControlRange();\r\n\t\t\t\t\tif(newRange){\r\n\t\t\t\t\t\tnewRange.addElement(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}catch(e1){\r\n\t\t\t\t\ttry{\r\n\t\t\t\t\t\tnewRange = node.ownerDocument.body.createTextRange();\r\n\t\t\t\t\t\tnewRange.moveToElementText(node);\r\n\t\t\t\t\t}catch(e2){/* squelch */}\r\n\t\t\t\t}\r\n\t\t\t\tif(range && newRange){\r\n\t\t\t\t\t// We can finally compare similar to W3C\r\n\t\t\t\t\tif(range.compareEndPoints(\"EndToStart\", newRange) === 1){\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false; // Boolean\r\n\t}\r\n};\r\n\r\n\r\nlang.setObject(\"dijit._editor.selection\", selection);\r\n\r\nreturn selection;\r\n});\r\n"]}